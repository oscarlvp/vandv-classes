<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Oscar Luis Vera-PÃ©rez">
<title>Validation and Verification : Course Notes</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Validation and Verification : Course Notes</h1>
<div class="details">
<span id="author" class="author">Oscar Luis Vera-PÃ©rez</span><br>
<span id="email" class="email"><a href="mailto:oscarlvp@gmail.com">oscarlvp@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_note_about_the_notes">Note about the notes</a></li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_what_is_a_bug">1.1. What is a bug?</a>
<ul class="sectlevel3">
<li><a href="#_local_bugs_and_some_famous_cases">1.1.1. Local bugs and some famous cases</a>
<ul class="sectlevel4">
<li><a href="#_the_case_of_zune">The case of Zune</a></li>
<li><a href="#_heartbleed">Heartbleed</a></li>
<li><a href="#_other_interesting_examples">Other interesting examples</a></li>
</ul>
</li>
<li><a href="#_global_bugs_and_famous_cases">1.1.2. Global bugs and famous cases</a>
<ul class="sectlevel4">
<li><a href="#_race_conditions_and_the_northeast_blackout_of_2003">Race conditions and the Northeast blackout of 2003</a></li>
<li><a href="#_ariane_5">Ariane 5</a></li>
<li><a href="#_the_mars_climate_orbiter">The Mars Climate Orbiter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_why_is_it_so_hard_to_build_correct_software">1.2. Why is it so hard to build correct software?</a></li>
<li><a href="#_how_to_build_reliable_software">1.3. How to build reliable software?</a>
<ul class="sectlevel3">
<li><a href="#_fault_tolerance">1.3.1. Fault-tolerance</a></li>
<li><a href="#_constructive_approach">1.3.2. Constructive approach</a></li>
<li><a href="#_analytical_approach">1.3.3. Analytical approach</a></li>
<li><a href="#_modern_practices_cicd_and_devops">1.3.4. Modern practices: CI/CD and DevOps</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_code_quality_and_static_analysis">2. Code quality and static analysis</a>
<ul class="sectlevel2">
<li><a href="#_code_quality">2.1. Code quality</a>
<ul class="sectlevel3">
<li><a href="#_coding_guidelines">2.1.1. Coding guidelines</a>
<ul class="sectlevel4">
<li><a href="#_naming_conventions">Naming conventions</a></li>
<li><a href="#_indentation">Indentation</a></li>
<li><a href="#_framework_and_company_specific_guidelines">Framework and company specific guidelines</a></li>
<li><a href="#_should_conventions_be_always_enforced">Should conventions be always enforced?</a></li>
</ul>
</li>
<li><a href="#_code_smells_and_antipatterns">2.1.2. Code Smells and AntiPatterns</a></li>
<li><a href="#_code_metrics">2.1.3. Code Metrics</a>
<ul class="sectlevel4">
<li><a href="#_lines_of_code">Lines of Code</a></li>
<li><a href="#cyclomatic-section">Cyclomatic Comprexity</a></li>
<li><a href="#_coupling_between_objects_or_class_coupling">Coupling between objects or class coupling</a></li>
<li><a href="#_class_cohesion">Class cohesion</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_static_analysis">2.2. Static analysis</a>
<ul class="sectlevel3">
<li><a href="#_implementing_a_static_analysis">2.2.1. Implementing a static analysis</a>
<ul class="sectlevel4">
<li><a href="#_using_javaparser">Using JavaParser</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tools_for_static_analysis">2.3. Tools for static analysis</a>
<ul class="sectlevel3">
<li><a href="#_using_and_extending_pmd">2.3.1. Using and extending PMD</a></li>
</ul>
</li>
<li><a href="#_static_analysis_in_the_development_process">2.4. Static analysis in the development process</a></li>
</ul>
</li>
<li><a href="#_software_testing">3. Software Testing</a>
<ul class="sectlevel2">
<li><a href="#_levels_of_testing">3.1. Levels of testing</a></li>
<li><a href="#_test_automation_frameworks_junit">3.2. Test automation frameworks: JUnit</a></li>
<li><a href="#_best_practices_and_antipatterns_in_testing">3.3. Best practices and antipatterns in testing</a>
<ul class="sectlevel3">
<li><a href="#_test_smells">3.3.1. Test smells</a></li>
<li><a href="#_real_examples_of_good_testing_practices">3.3.2. Real examples of good testing practices</a></li>
</ul>
</li>
<li><a href="#_test_design">3.4. Test design</a>
<ul class="sectlevel3">
<li><a href="#_reachability_infection_propagation_revealability">3.4.1. Reachability, Infection, Propagation, Revealability</a></li>
<li><a href="#_coverage_criteria_for_test_qualification">3.4.2. Coverage criteria for test qualification</a>
<ul class="sectlevel4">
<li><a href="#_input_space_partitioning">Input space partitioning</a></li>
<li><a href="#_structural_coverage">Structural coverage</a></li>
<li><a href="#_logic_coverage">Logic coverage</a></li>
<li><a href="#_mutation_testing">Mutation testing</a></li>
<li><a href="#_coverage_criteria_in_practice">Coverage criteria in practice</a></li>
</ul>
</li>
<li><a href="#_test_doubles">3.4.3. Test doubles</a>
<ul class="sectlevel4">
<li><a href="#_mocking_frameworks_mockito">Mocking frameworks: Mockito</a></li>
<li><a href="#_best_practices_and_misuses">Best practices and misuses</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_the_role_of_testability">3.5. The role of testability</a></li>
<li><a href="#_test_driven_development">3.6. Test Driven Development</a></li>
</ul>
</li>
<li><a href="#_fuzzing">4. Fuzzing</a>
<ul class="sectlevel2">
<li><a href="#_what_to_observe">4.1. What to observe?</a></li>
<li><a href="#_how_to_generate_random_inputs">4.2. How to generate random inputs?</a></li>
<li><a href="#_libraries_tools_and_practice">4.3. Libraries, tools and practice</a></li>
</ul>
</li>
<li><a href="#_graphical_user_interface_testing">5. Graphical User Interface testing</a>
<ul class="sectlevel2">
<li><a href="#_writing_test_scripts">5.1. Writing test scripts</a>
<ul class="sectlevel3">
<li><a href="#_page_object_model">5.1.1. Page Object Model</a></li>
</ul>
</li>
<li><a href="#_fully_automated_gui_testing">5.2. Fully automated GUI testing</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_note_about_the_notes">Note about the notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These course notes have been initially inspired from the (inherited and redefined) conferences taught by Jean-Marc JÃ©zÃ©quel, Yves Le Traon, Benoit Baudry and Benoit Combemale, who also provided feedback and proofread the material.</p>
</div>
<div class="paragraph">
<p>The initial content has been enriched with materials from the <a href="https://cs.gmu.edu/~offutt/softwaretest/">"Introduction to Software Testing"</a> book written by Paul Ammann and Jeff Offutt, <a href="https://www.fuzzingbook.org/">"The Fuzzing Book"</a> by Andreas Zeller, Rahul Gopinath, Marcel BÃ¶hme, Gordon Fraser, and Christian Holler and the <a href="https://www.youtube.com/playlist?list=PL3bOx_OjZk8EvOo3un0xeGpXlqGT2YQXa">online material on GUI testing</a> published by Tanja Vos.
Many other bibliographical sources and materials were also used and appear in the <a href="#_references">References</a> section.</p>
</div>
<div class="paragraph">
<p>As part of the course, students had to complete a set of exercises for each topic. These exercises can be consulted in the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/validation-and-verification-istic/2020-tp1-introduction">Introduction</a></p>
</li>
<li>
<p><a href="https://github.com/validation-and-verification-istic/2020-tp2-static-analysis">Code quality and static analysis</a></p>
</li>
<li>
<p><a href="https://github.com/validation-and-verification-istic/2020-tp3-testing">Testing</a></p>
</li>
<li>
<p><a href="https://github.com/validation-and-verification-istic/2020-tp4-fuzzing">Fuzzing</a></p>
</li>
<li>
<p><a href="https://github.com/validation-and-verification-istic/2020-tp5-gui">GUI testing</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, students had to complete a project in which they were given the source code of a faulty file compression application. The students had to put in practice what they learned to find and correct the faults and to improve the quality of the application code. Details of the project can be found <a href="https://github.com/validation-and-verification-istic/2020-project-squeezer">here</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
These notes are and will always be a work in progress. Any feedback is welcome. They are distributed under the Creative Commons Zero v1.0 Universal license.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Software has become omnipresent in our daily lives. Some people say that &#8220;software is eating the world&#8221; <a href="#andreessen2011why">(1)</a>. Nowadays, we depend more and more on the Internet and the Web. They are powered by complex interconnected software systems. We trust software to predict the weather, to guard our bank accounts and to order pizza. Through software we communicate with other people and share our photos. We use streaming services to watch films and listen to music.</p>
</div>
<div class="paragraph">
<p>Due to its widespread presence there are consequences when software is not properly developed. In some cases, a software failure has no other repercussion than a hilarious "blue screen of death" in an advertising screen. But, software issues may also cost important amounts of money, they may undermine the reputation of companies and, in some extreme cases, they might even cost human lives.</p>
</div>
<div class="paragraph">
<p>We need to verify software, in other words, we need to check whether software works as expected. This course will briefly introduce some of the most relevant techniques and tools to achieve that goal.</p>
</div>
<div class="sect2">
<h3 id="_what_is_a_bug">1.1. What is a bug?</h3>
<div class="paragraph">
<p>We say that a software has a <em>bug</em> when its behavior produces unexpected results. The term <em>bug</em> has been usually attributed to Grace Hooper. She was involved in the programming and operation of the Mark II, an electromechanical computer of 23 tons and the size of a room. She was also the creator of the first compiler and the only woman to be ranked admiral in the U.S. Navy. Her group traced a computer malfunction to a moth in one of the relays of the machine. This is the first documented case of a computer "bug". The moth was included in one of the notebooks that were used to log the computer&#8217;s operation. It can be seen nowadays at the Smithsonian Institution&#8217;s National Museum of American History in Washington D.C <a href="#img-bug">Figure 1</a>. However, Thomas Alva Edison already used the term for something similar in his inventions <a href="#wikipedia2020bug">(2)</a>.</p>
</div>
<div id="img-bug" class="imageblock text-center">
<div class="content">
<img src="images/first-bug.jpg" alt="First bug" width="300">
</div>
<div class="title">Figure 1. First known case of an actual bug! <em>Photo taken from Wikipedia.</em></div>
</div>
<div class="paragraph">
<p>When they develop a product, software engineers should follow a set of requirements which is called the product specification. In whatever format it is presented, the specification should describe the features of the product (functional requirements): <em>e.g.</em>: the program should open a document, save it, etc. and its constraints (non-functional requirements): <em>e.g.</em>: should be secure, easy to use, fast <a href="#mancoridis2018slides">(5)</a>.</p>
</div>
<div class="paragraph">
<p>A bug appears when the software does not match the requirements. Maybe the program does not perform correctly a functional requirement <em>e.g.</em>  the window closes when the maximize button is pressed. Also, bugs can make a program violate non-functional requirement <em>e.g.</em> there is a lag between the moment the user types something and the moment the text appears on the screen.</p>
</div>
<div class="paragraph">
<p>Bugs or <em>faults</em> are produced by human mistakes in the development process. A fault induces a wrong state or <em>error</em> during the execution of the software. When the error produces an incorrect behavior of the program we see a <em>failure</em>.</p>
</div>
<div class="paragraph">
<p>We define <em>faults</em>, <em>errors</em> and <em>failures</em> as follows <a href="#moller1993empirical">(6)</a>, <a href="#ghahrai2018error">(3)</a>, <a href="#amman2017introduction">(4)</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Software Fault, Software Defect, Bug</dt>
<dd>
<p>a manifestation of a human mistake in software. It is a static flaw or imperfection found within the code.</p>
</dd>
<dt class="hdlist1">Software Error</dt>
<dd>
<p>An incorrect internal state of the program during execution and produced by a <em>fault</em>.</p>
</dd>
<dt class="hdlist1">Software Failure</dt>
<dd>
<p>a deviation of the software from its expected delivery or service.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A mistake leads to a fault, a fault leads to a software error which leads to a failure when the software is executed. A failure is the manifestation of a bug.</p>
</div>
<div class="paragraph">
<p><a href="#fault-example">Listing 1</a> shows a recursive implementation of a binary search over an ordered array. Given an ordered array and a number, the <code>search</code> method returns the position of the number in the array or -1. The private overload of the method uses two auxiliary parameters to delimit the slice of the array that is inspected on each call. The initial slice is the entire array. When the method is invoked, it compares the element in the middle of the slice with the number given as input. If they are equal, then the position in the middle is returned, otherwise the method is invoked with the first half or the second half of the slice.</p>
</div>
<div id="fault-example" class="listingblock">
<div class="title">Listing 1. Example of a bug or fault in a binary search implementation. The bug provokes an infinite recursion that leads to a stack overflow exception.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">search</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">return</span> <span class="tok-n">search</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">element</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">search</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">element</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">first</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">last</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">last</span> <span class="tok-o">&lt;</span> <span class="tok-n">first</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-kt">int</span> <span class="tok-n">middle</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">first</span> <span class="tok-o">+</span> <span class="tok-n">last</span><span class="tok-o">)/</span><span class="tok-mi">2</span><span class="tok-o">;</span>
  <span class="tok-kt">int</span> <span class="tok-n">median</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">middle</span><span class="tok-o">];</span>
  <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">element</span> <span class="tok-o">==</span> <span class="tok-n">median</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">middle</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">element</span> <span class="tok-o">&lt;</span> <span class="tok-n">median</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">search</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">element</span><span class="tok-o">,</span> <span class="tok-n">first</span><span class="tok-o">,</span> <span class="tok-n">middle</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
  <span class="tok-k">return</span> <span class="tok-n">search</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">element</span><span class="tok-o">,</span> <span class="tok-n">middle</span><span class="tok-o">,</span> <span class="tok-n">last</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The correct invocation should use <code>last + 1</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This implementation has a fault. The second recursive invocation of search: <code>search(array, element, half, last)</code> should use <code>half + 1</code> instead of <code>half</code>. This fault does not always produce an error. For example, <code>search(new int[]{0, 6, 8, 10}, 6)</code> produces the right result. However, <code>search(new []{0, 6, 8, 10}, 10)</code>, leads to an invocation where <code>first=9</code> and <code>last=10</code>. For this invocation <code>middle=9</code> and once the comparisons are done, the same method is invoked again with the same parameters, this is the error produced by the initial fault. As method is invoked again with the same parameters, it produces an infinite recursion that is manifested through a stack overflow exception. This exception is the failure that evidences the initial fault.</p>
</div>
<div class="paragraph">
<p>A failure may come from very different sources. Some of them could be traced to a very localized and specific part of the code, as in the example before. These are considered as <em>local bugs</em>. Others may be produced by the interaction of different components of the system and have a global scope. These are considered as <em>global bugs</em>. The following sections describe famous local and global bugs.</p>
</div>
<div class="sect3">
<h4 id="_local_bugs_and_some_famous_cases">1.1.1. Local bugs and some famous cases</h4>
<div class="paragraph">
<p>Local bugs can be traced to very specific locations in the code. They can be originated from multiple types of errors such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Omission of potential cases <em>e.g.</em> not considering that negative numbers could be used in certain operations.</p>
</li>
<li>
<p>Lacks of checks <em>e.g.</em> check if the parameter is <code>null</code> or the divisor must be other than zero.</p>
</li>
<li>
<p>Wrong conditions <em>e.g.</em> using the wrong comparison operator.</p>
</li>
<li>
<p>Wrong approximations <em>e.g.</em> wrong values due to type conversions or using the wrong partial results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the next sections we present some famous local bugs and briefly inspect their causes.</p>
</div>
<div class="sect4">
<h5 id="_the_case_of_zune">The case of Zune</h5>
<div class="paragraph">
<p><em>Zune 30</em>, was released to the public in November 2006. It was the first portable media player released by Microsoft. Suddenly, on December 31<sup>st</sup> 2008, all Zune devices hung and stopped working. The problem was traced back to a piece of code in the firmware equivalent to <a href="#zune-bug">Listing 2</a>.</p>
</div>
<div id="zune-bug" class="listingblock">
<div class="title">Listing 2. Bug in Zune 30</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">days</span> <span class="tok-o">&gt;</span> <span class="tok-mi">365</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">IsLeapYear</span><span class="tok-o">(</span><span class="tok-n">year</span><span class="tok-o">))</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">days</span> <span class="tok-o">&gt;</span> <span class="tok-mi">366</span><span class="tok-o">)</span> <span class="tok-o">{</span>   <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="tok-n">days</span> <span class="tok-o">-=</span> <span class="tok-mi">366</span><span class="tok-o">;</span>    <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="tok-n">year</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>      <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-n">days</span> <span class="tok-o">-=</span> <span class="tok-mi">365</span><span class="tok-o">;</span>
        <span class="tok-n">year</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>On December 31<sup>st</sup>, 2008 <code>year</code> was 2008 and <code>days</code> 366 so <code>isLeapYear(year)</code> evaluated to <code>true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since <code>days</code> was 366 <code>days &gt; 366</code> evaluated to <code>false</code>. This is the fault, it should have been <code>&gt;=</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is not executed, therefore the value of <code>days</code> does not change.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This is not executed, therefore the value of <code>year</code> does not change.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The values of <code>days</code> and <code>years</code> do not change which produced a wrong internal state and thus the error. The software enters an infinite loop and the devices become non-responsive.</p>
</div>
<div class="paragraph">
<p>By the next day, <code>days</code> would be 367 and the code would run perfectly. So Zune devices stop working on December 31<sup>st</sup> of every leap year.</p>
</div>
<div class="paragraph">
<p>The issue was not on Microsoft&#8217;s part. The code was written by another company for the clock chip. This bug is also an example of insufficient testing. Having tested the code with the right date, the bug could have been fixed before the release of the product.</p>
</div>
</div>
<div class="sect4">
<h5 id="_heartbleed">Heartbleed</h5>
<div class="paragraph">
<p><strong>Heartbleed</strong> is a software vulnerability disclosed in April 2014 that granted attackers access to sensitive information. It was caused by a flaw in OpenSSL, an open source code library implementing the Transport Layer Security and Secure Sockets Layer protocols.</p>
</div>
<div class="paragraph">
<p>As part of these protocols, a computer should send a <strong>heartbeat</strong>, an encrypted message that the receiver should replay back, to keep the connection alive. The <strong>heartbeat</strong> contains information about its own length. The code for the receiver never verified that the message had the specified length. To answer, it should allocate a memory buffer to store the content of the <strong>heartbeat</strong>. If the message was longer, then there is a buffer overflow and the computer would send more data than requested <a href="#fruhlinger2017what">(7)</a>.</p>
</div>
<div class="paragraph">
<p>The webcomic <a href="https://xkcd.com/">XKCD</a> explains this vulnerability in a very intuitive manner. See <a href="#heartbleed-xkcd">Figure 2</a>.</p>
</div>
<div id="heartbleed-xkcd" class="imageblock text-center">
<div class="content">
<img src="images/heartbleed.png" alt="Heartbleed" width="400">
</div>
<div class="title">Figure 2. Heartbleed explanation by XKCD <a href="https://xkcd.com/1354/" class="bare">https://xkcd.com/1354/</a></div>
</div>
<div class="paragraph">
<p>In <a href="#heartbleed-source">Listing 3</a> you can see a fragment of the code containing the bug.</p>
</div>
<div id="heartbleed-source" class="listingblock">
<div class="title">Listing 3. Heartbleed source code</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><span></span><span class="tok-p">...</span>
<span class="tok-n">n2s</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">,</span> <span class="tok-n">payload</span><span class="tok-p">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">...</span>
<span class="tok-n">buffer</span> <span class="tok-o">=</span> <span class="tok-n">OPENSSL_malloc</span><span class="tok-p">(</span><span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-mi">2</span> <span class="tok-o">+</span> <span class="tok-n">payload</span> <span class="tok-o">+</span> <span class="tok-n">padding</span><span class="tok-p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">bp</span> <span class="tok-o">=</span> <span class="tok-n">buffer</span><span class="tok-p">;</span>
<span class="tok-p">...</span>
<span class="tok-n">memcpy</span><span class="tok-p">(</span><span class="tok-n">bp</span><span class="tok-p">,</span> <span class="tok-n">pl</span><span class="tok-p">,</span> <span class="tok-n">payload</span><span class="tok-p">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-p">...</span>
<span class="tok-n">s</span><span class="tok-o">-&gt;</span><span class="tok-n">msg_callback</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">s</span><span class="tok-o">-&gt;</span><span class="tok-n">version</span><span class="tok-p">,</span> <span class="tok-n">TLS1_RT_HEARTBEAT</span><span class="tok-p">,</span>  <i class="conum" data-value="4"></i><b>(4)</b>
	<span class="tok-n">buffer</span><span class="tok-p">,</span> <span class="tok-mi">3</span> <span class="tok-o">+</span> <span class="tok-n">payload</span> <span class="tok-o">+</span> <span class="tok-n">padding</span><span class="tok-p">,</span>
	<span class="tok-n">s</span><span class="tok-p">,</span> <span class="tok-n">s</span><span class="tok-o">-&gt;</span><span class="tok-n">msg_callback_arg</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Read payload length into <code>payload</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Allocate memory.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Copy the payload and extra information as <code>payload</code> maybe larger than required.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Send the data back.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_other_interesting_examples">Other interesting examples</h5>
<div class="paragraph">
<p>The USS Yorktown (CG-48) cruiser was selected in 1996 as the testbed for the <em>Smart Ship</em> program. The ship was equipped with a network of several 200 MHz Pentium processors. The computers abroad the ship ran Windows NT 4.0 and executed applications to run the control center, monitor the engines and navigate the ship. In September 21<sup>st</sup> 1997 a crew member entered a zero into a database field causing a division by zero that resulted in a buffer overflow, which, in turn, made the propulsion system fail. The ship was dead for several hours and had to be towed back to port <a href="#slabodking1998software">(8)</a>.</p>
</div>
<div class="paragraph">
<p>The <em>Patriot</em> missile defense system was able to track the trajectory of enemy projectiles and intercept them. The system stored the clock time in an integer that was converted to a fixed point number and multiplied by 1/10 to produce the time in seconds for the tracking estimation. The computation was performed in a 24-bit fixed point register and the time value was truncated. This would produce an error proportional to the uptime of the system (<em>i.e.</em> it grows in time). Apart from that, the system was updated several times to improve the conversion routine, but the patch was not placed in all the required code locations. On February 25<sup>th</sup>, 1991 one of these Patriot batteries failed to intercept an Iraqi Scud missile. The battery had been up for 100 hours and the chopping error was around 0.34 seconds. Since a Scud travels at 1.676 m/s it reaches more than a half kilometer in this time. The Scud struck an American Army barracks killing 28 soldiers and injuring around 100 other people <a href="#arnold2000patriot">(9)</a>.</p>
</div>
<div class="paragraph">
<p>The Chemical Bank deducted by error about $15 million from more than 100000 customers in one night. The problem was caused by a line of code that should not be executed until further changes were made to the system. This line sent a copy of every ATM transaction to the machine processing paper checks, so all transactions were deducted twice <a href="#hansell1994glitch">(10)</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_global_bugs_and_famous_cases">1.1.2. Global bugs and famous cases</h4>
<div class="paragraph">
<p>Rather than coming from a specific and localized error, some failures may emerge from the interactions of the modules that compose a system. This evidences that the whole is more than the mere sum of its parts.</p>
</div>
<div class="paragraph">
<p>Some sources of global bugs could be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Wrong assumptions about third party components.</p>
</li>
<li>
<p>Errors in the reuse of code. For example, using the code in an environment or an architecture for which it was not designed.</p>
</li>
<li>
<p>Concurrency bugs, that lead to race conditions and deadlocks by incorrectly assuming certain order of execution.</p>
</li>
<li>
<p>Improbable or unforeseen interactions between hardware, software and users.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_race_conditions_and_the_northeast_blackout_of_2003">Race conditions and the Northeast blackout of 2003</h5>
<div class="paragraph">
<p>A race condition appears when the output of a system depends on the sequence or timing of other uncontrollable events. This may lead to a bug when the effects of this assumption are not carefully considered. For example, in a multithreaded application, a piece of code may be (wrongly) assumed to run before another.</p>
</div>
<div class="paragraph">
<p>The code in <a href="#race-condition">Listing 4</a> shows a simplified example of a race condition.</p>
</div>
<div id="race-condition" class="listingblock">
<div class="title">Listing 4. Example of race condition</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleApplet</span> <span class="tok-kd">extends</span> <span class="tok-n">Applet</span> <span class="tok-o">{</span>

    <span class="tok-n">Image</span> <span class="tok-n">art</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-n">art</span> <span class="tok-o">=</span> <span class="tok-n">getImage</span><span class="tok-o">(</span><span class="tok-n">getDocumentBase</span><span class="tok-o">(),</span> <span class="tok-n">getParameter</span><span class="tok-o">(</span><span class="tok-s">&quot;img&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">paint</span><span class="tok-o">(</span><span class="tok-n">Graphics</span> <span class="tok-n">g</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">drawImage</span><span class="tok-o">(</span><span class="tok-n">art</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>init</code> initializes <code>art</code>, if it is not invoked, then <code>art</code> is <code>null</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>paint</code> could be invoked before invoking <code>init</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If <code>paint</code> is invoked before <code>init</code> <code>art</code> is <code>null</code> which produces an error in this line.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To prevent this race condition, the code of <code>paint</code> should not assume that <code>art</code> will always point to an instance. To deal with this race condition it is enough to check if <code>art</code> is <code>null</code> or not.</p>
</div>
<div class="paragraph">
<p>On August 14<sup>th</sup>, 2003 the alarm of FirstEnergy, an electric utility in Akron, Ohio, should have alerted about an overload in the electricity transmission lines. A race condition stalled the alarm and the primary sever went down. A backup server started processing all demands and also went down after 13 minutes. With both servers down, the information being shown in the screens passed from a refresh rate of 1 to 3 seconds to 59 seconds. The operators were not aware of the actual condition of the grid and the system collapsed affecting an estimated of 50 million people.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You may find an image circulating the Internet that is supposed to show a satellite view of this blackout. The image is in fact fake.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ariane_5">Ariane 5</h5>
<div class="paragraph">
<p>The <em>Ariane 5</em> test launch is one of the most referenced examples of the impact that a software bug can have. On June 4<sup>th</sup> 1996, the rocket was launched by the European Space Agency from the French Guiana. After 40 seconds and at an altitude of more than 3700 meters the rocket exploded.</p>
</div>
<div class="paragraph">
<p>In <a href="#jezequel1997design">(11)</a> the authors explain that, before liftoff, certain computations are performed to align the Inertial Reference System (SRI). These computations should cease at -9 seconds from the launching sequence. But, since there is a chance that a countdown could be put on hold and because resetting the SRI could take several hours, it was better to let the computation proceed than to stop it. The SRI continues for 50 seconds after the start of flight mode. After takeoff this computation is useless. Yet they caused an exception which was not caught, and produced the explosion of the rocket.</p>
</div>
<div class="paragraph">
<p>Part of the software was reused from <em>Ariane 4</em>. It used 16-bit floating point numbers, while <em>Ariane 5</em> used 64-bit. The conversion of a greater value caused the exception. The fact that this module used 16-bit floating point numbers was not documented in the code. The trajectory of <em>Ariane 5</em> differed from that of <em>Ariane 4</em>. The former had considerably higher horizontal velocities that produced values above the initial range. This was the first launch after a decade of development with an estimated cost of $7 billion plus the rocket and cargo estimated in $500 million.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_mars_climate_orbiter">The Mars Climate Orbiter</h5>
<div class="paragraph">
<p>The Mars Climate Orbiter probe crashed when entering the orbit of Mars. The cause was tracked to the fact that one development team was using the metric units and another team was using the Imperial Unit System. The loss was estimated in US$235.9 million <a href="#ceguerra2001software">(12)</a>. The subject is still inspiration of many memes cruel jokes.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_is_it_so_hard_to_build_correct_software">1.2. Why is it so hard to build correct software?</h3>
<div class="paragraph">
<p>Software inevitably fails. The causes for this are widely varied as we have seen from the previous examples. No domain related to software escapes from this fact. A failure can have multiple consequences even human lives. But why is it to hard to build correct software?</p>
</div>
<div class="paragraph">
<p>First of all, programs are very complex artifacts, even those we may consider simple or trivial.</p>
</div>
<div class="paragraph">
<p>Consider the code presented in <a href="#collatz">Listing 5</a>.</p>
</div>
<div id="collatz" class="listingblock">
<div class="title">Listing 5. Will the alarm sound for all given inputs?</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">void</span> <span class="tok-nf">alert</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">countdown</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">);</span>
  <span class="tok-n">soundAlarm</span><span class="tok-o">();</span>
<span class="tok-o">}</span>

<span class="tok-kt">void</span> <span class="tok-nf">countdown</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">while</span><span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
      <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">n</span> <span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">;</span>
    <span class="tok-k">else</span>
      <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-o">*</span> <span class="tok-n">n</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Is it possible to show that the alarm will sound for every value of <code>n</code>?
For this particular example one could attempt to devise a formal proof. But good luck with that! Mathematicians have been trying to do it since 1937 with no success. <code>countdown</code> is, in fact, an implementation of what is known as the <a href="https://en.wikipedia.org/wiki/Collatz_conjecture">Collatz  conjecture</a>.</p>
</div>
<div class="paragraph">
<p>One could also try to verify the program for every possible input, but this is impossible in the general case.
For this particular example, let us assume that <code>n</code> is a 32-bits unsigned integer, then we have 2<sup>32</sup> possible inputs, that is <code>4294967296</code> cases for a very simple code of barely 7 lines of code. If the computation of every input takes on average <code>2.78e-06</code> seconds, then we will spend 3 hours finding out the result, if the function stops for every input. 3 hours for barely 7 lines of code!</p>
</div>
<div class="paragraph">
<p>Determining if a procedure halts when given a specific input is known as the <strong>Halting Problem</strong> <a href="#turing1936computable">(14)</a>. The general case of this problem is undecidable. This means that, in general, we can not known for a given procedure if it will halt when processing a given input.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s prove it. Suppose that it is possible to write a function <code>halts</code> that tells whether a given function <code>f</code> halts when given an input <code>x</code>. That is, <code>halts</code> returns <code>true</code> if <code>f(x)</code> halts (<a href="#halts-func">Listing 6</a>) and <code>false</code> otherwise.</p>
</div>
<div id="halts-func" class="listingblock">
<div class="title">Listing 6. A supposed function that, given a function <code>f</code> and an input <code>x</code> for <code>f</code>, returns <code>true</code> if the invocation of <code>f(x)</code> halts.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span></span><span class="tok-kd">function</span> <span class="tok-nx">halts</span><span class="tok-p">(</span><span class="tok-nx">f</span><span class="tok-p">,</span> <span class="tok-nx">x</span><span class="tok-p">)</span><span class="tok-o">:</span>
    <span class="tok-p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>halts</code> function exists, then we can create a procedure, <code>confused</code>, that will loop forever if <code>halts</code> returns <code>true</code> (<a href="#confused-proc">Listing 7</a>).</p>
</div>
<div id="confused-proc" class="listingblock">
<div class="title">Listing 7. A procedure that does not halt when <code>halts(f, f)</code> is <code>true</code>, otherwise it does halt.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="javascript"><span></span><span class="tok-kd">function</span> <span class="tok-nx">confused</span><span class="tok-p">(</span><span class="tok-nx">f</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-nx">halts</span><span class="tok-p">(</span><span class="tok-nx">f</span><span class="tok-p">,</span> <span class="tok-nx">f</span><span class="tok-p">))</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">)</span> <span class="tok-p">{}</span>
  <span class="tok-k">else</span>
    <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we try to compute <code>confused(confused)</code>, <code>halts(f, f)</code> is equivalent to <code>halts(confused, confused)</code>. If this evaluates to <code>true</code>, then it means that <code>confused(consfused)</code> halts, but then the procedure enters in an infinite loop and so, in fact, <code>confused(confused)</code>, which is what we are evaluating in the first time, does not halt. On the other hand, if the condition is <code>false</code>, it means that <code>confused(confused)</code> does not halt, but then, the procedure halts.</p>
</div>
<div class="paragraph">
<p>Therefore, <code>confused(confused)</code> halts if and only if <code>confused(confused)</code> does not halt, which is a contradiction, so <code>halts</code> can not exist. This means that, in the general case, we can not prove that a program will halt when processing a given input. Of course, there are specific cases in which this is possible, but it can not be done for all existing procedures.</p>
</div>
<div class="paragraph">
<p>Proving the correctness of a program is a very difficult task. There are formal methods to try to achieve this, but they rely on mathematical models of the real world that might make unrealistic assumptions and, as abstractions, are different from the real machines in which programs execute.</p>
</div>
<div class="paragraph">
<p>Software is, of course, much more complex than the small functions we have seen so far. As an example, notice that the number of lines of code has increased exponentially in time (though not always in sync with the complexity of the task that the program should achieve), just take a look at the following <a href="#loc">comparison</a>:</p>
</div>
<div id="loc" class="imageblock text-center">
<div class="content">
<img src="images/loc.jpg" alt="Lines of code" width="600">
</div>
<div class="title">Figure 3. Comparison in lines of code. Image taken from <a href="#johnson2012curiosity">(13)</a></div>
</div>
<div class="paragraph">
<p>The software of the Apollo 11 Guidance Computer had 145,000 lines of code, while NASA&#8217;s Curiosity rover was programmed with 2.5M lines of code. The infamous Clippy on the other hand, had more than 100M lines of code.</p>
</div>
<div class="paragraph">
<p>Projects such as the Linux Kernel, have triplicated their size in 10 years:</p>
</div>
<div id="kernel" class="imageblock text-center">
<div class="content">
<img src="images/kernel.png" alt="LOCs Linux kernel" width="600">
</div>
<div class="title">Figure 4. Increment of lines of code in the Linux kernel.</div>
</div>
<div class="paragraph">
<p>Firefox contains more than 36M lines of code and Chromium more than 18M. More statistics can be found <a href="https://www.openhub.net/">here</a>.</p>
</div>
<div class="paragraph">
<p>The complexity of software does not come only from its size. For example, in both, Firefox and Chromium developers use more than 15 different programming languages at the same time.</p>
</div>
<div class="paragraph">
<p>Open source software also grows in complexity as the number of contributors increases. The Firefox project, for example, have had 6477 contributors and 996214 commits as of February 2018.</p>
</div>
<div class="paragraph">
<p>Also, most software is expected to run in multiple execution platforms, (including hardware, operating system, &#8230;&#8203;). Probably the most dramatic scenario in this sense comes from the mobile world. By August 2015 the OpenSignal company reported the existence of 24,093 different Android devices from 1294 distinct brands <a href="#opensignal2015android">(16)</a>. Android applications are expected to run correctly in all of them.</p>
</div>
<div class="paragraph">
<p>Software is also present in systems with real-time computing constraints and sometimes implementing critical functionalities. For example, mp3 players, microwave ovens, GPS devices, medical equipment for vital sign monitoring, avionics (inertial guiding systems), automobiles, fire security systems and the list may go on. As a side note, a car nowadays contains more than 100M lines of code (mostly devoted to the entertainment system), and hundreds of electronic control units (ECU).</p>
</div>
<div class="paragraph">
<p>On top of that, software is not a static artifact that we release in production and leave as it is. It needs to be maintained over time. For example, Windows 95, was released to manufacturing on August 15<sup>th</sup>, 1995, it latest release was published on November 26<sup>th</sup> 1997. However, its mainstream support ended on December 31<sup>st</sup>, 2000 while the extended support ended on December 31<sup>st</sup>, 2001, that is five and six years after its latest release. On its side, Windows 7 was released to manufacturing in July 22<sup>nd</sup>, 2009, support ended on January 14<sup>th</sup>, 2020 and the extended support for professional users should end on January 10<sup>th</sup> 2023 while most of us are not using it nowadays.</p>
</div>
<div class="paragraph">
<p>The COBOL language appeared in 1959. It was estimated that, in 1997, around 80% of business transactions ran in COBOL. Even today, it is even said that more than 220 billions lines of COBOL are in use <a href="#trikha2020inevitable">(17)</a>. Migrating these legacy systems may be risky. In 2012 the Commonwealth Bank of Australia replaced its core banking platform to modernize their systems. The change ended up costing around 750 million dollars, which is why many banks have opted to keep their COBOL systems working. Today there are 75-, 60-years-old consultants providing support for COBOL systems in banks <a href="#cnbc2017banks">(18)</a>. In the recent Covid-19 crisis, the state of New Jersey in the U. S. requested COBOL programmers to deal with the 40-years old system to handle the huge amount of unemployment claims they received <a href="#leswing2020bnew">(19)</a>.</p>
</div>
<div class="paragraph">
<p>The software development process itself could be sometimes rather complex. There are many methodologies about how to build software, and they could even change during the creation of a new product.</p>
</div>
<div class="paragraph">
<p>So, the complexity of software may come from its requirements, its size as it can be huge, the number of technologies involved on its development as tens of languages and frameworks can be used at the same time, the number of people working on its implementation that could even be hundreds, the diversity of platforms in which it must run and even the development process.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_build_reliable_software">1.3. How to build reliable software?</h3>
<div class="paragraph">
<p>This is a difficult question and there is no easy answer. Systematically validating and verifying software as it is being built and maintained can lead to fewer bugs. <strong>Verification</strong> is the process in which we answer <em>Are building the product right?</em>, that is if the software conforms to its specification. <strong>Validation</strong> answers <em>Are we building the right product?</em>. In this sense  we check that the implemented product meets the expectation of the user <em>i.e.</em>, whether the specification captures the customer&#8217;s needs.</p>
</div>
<div class="paragraph">
<p>There are three main general approaches to construct reliable software:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Fault-tolerance</dt>
<dd>
<p>Admits the presence of errors and enhance the software with fault-tolerance mechanisms.</p>
</dd>
<dt class="hdlist1">Constructive approach</dt>
<dd>
<p>Involves formal modeling. It guarantees the reliability and correctness by construction.</p>
</dd>
<dt class="hdlist1">Analytical approach</dt>
<dd>
<p>Involves techniques to analyze the program in order to detect and fix errors.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_fault_tolerance">1.3.1. Fault-tolerance</h4>
<div class="paragraph">
<p>This approach assumes that it is impossible to prevent the occurrence of bugs in production. So, it enhances the system with mechanisms to deal with them.</p>
</div>
<div class="paragraph">
<p><em>N-version programming</em> is an example of this approach. With an initial and rigorous specification, two or more versions of the same system are developed by different development teams (usually with different backgrounds, and using different tools and methods to build the system). In production, these versions are executed in parallel. The actual output of the entire system is an agreement of the results obtained from all versions.</p>
</div>
<div class="paragraph">
<p>Another example is <em>Chaos engineering</em> popularized by Netflix with its Simian Army. The main concept is to perform a controlled experiment in production to study how the entire system behaves under unexpected conditions. For example, in Netflix, they would simulate random server shutdowns to see how the system responds to this phenomenon <a href="#netflix2011">(24)</a>. This is a form of <em>testing in production</em>. Main challenges are to design the experiments in a way that the system does not actually fail and to pick the system properties to observe. In the case of Netflix, they want to preserve the availability of the content even when the quality has to be reduced.</p>
</div>
<div class="paragraph">
<p>Finally, approximate computing techniques <a href="#mittal2016survey">(20)</a> can be also applied to deal with a trade-off between accuracy and performance in a changing environment (<em>e.g.</em>, time-varying bandwidth), when a <em>good enough</em> result is better than nothing <a href="#hardesty2010when">(21)</a>. For example, Loop Perforation <a href="#misailovic2010quality">(22)</a>, which transforms loops to perform fewer iterations than the original loop, is used to keep the system running in a degraded environment, with a good enough result (<em>e.g.</em>, dynamically adapting the video quality according to the actual bandwidth).</p>
</div>
</div>
<div class="sect3">
<h4 id="_constructive_approach">1.3.2. Constructive approach</h4>
<div class="paragraph">
<p>This approach tries to guarantee the absence of bugs by construction. It involves the manual or automatic formal proof of all the components of the system, and their final integration. It is usually based on logical modeling and reasoning and it is used on specific parts of critical software.</p>
</div>
<div class="paragraph">
<p>The constructive approach may use tools such as <a href="https://coq.inria.fr/">Coq</a>, a system to express assertions and mechanically check formal proofs or <a href="https://isabelle.in.tum.de/overview.html">Isabelle</a> an interactive theorem prover. <a href="#coq-example">Listing 8</a> shows how to use Coq to proof that the depth of any interior node in a tree is greater than 0.</p>
</div>
<div id="coq-example" class="listingblock">
<div class="title">Listing 8. Small example of a proof achieved with the help of Coq. Taken from <a href="https://github.com/coq/coq/wiki/Quick-Reference-for-Beginners" class="bare">https://github.com/coq/coq/wiki/Quick-Reference-for-Beginners</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="coq"><span></span><span class="tok-kn">Module</span> <span class="tok-n">TreeExample</span><span class="tok-o">.</span>

  <span class="tok-kn">Inductive</span> <span class="tok-n">tree</span> <span class="tok-o">:</span> <span class="tok-kt">Type</span> <span class="tok-o">:=</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-o">|</span> <span class="tok-n">Leaf</span> <span class="tok-o">:</span> <span class="tok-n">tree</span>
  <span class="tok-o">|</span> <span class="tok-n">Node</span> <span class="tok-o">:</span> <span class="tok-n">tree</span> <span class="tok-o">-&gt;</span> <span class="tok-n">tree</span> <span class="tok-o">-&gt;</span> <span class="tok-n">tree</span>
  <span class="tok-o">.</span>

  <span class="tok-kn">Check</span> <span class="tok-n">Node</span><span class="tok-o">.</span>

  <span class="tok-kn">Definition</span> <span class="tok-n">small_tree</span> <span class="tok-o">:</span> <span class="tok-n">tree</span> <span class="tok-o">:=</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">Node</span> <span class="tok-o">(</span><span class="tok-n">Node</span> <span class="tok-n">Leaf</span> <span class="tok-n">Leaf</span><span class="tok-o">)</span> <span class="tok-n">Leaf</span><span class="tok-o">.</span>

  <span class="tok-c">(* small_tree tree looks like:</span>
<span class="tok-c">          x</span>
<span class="tok-c">         / \</span>
<span class="tok-c">        x   x</span>
<span class="tok-c">       / \</span>
<span class="tok-c">      x   x</span>
<span class="tok-c">   *)</span>

  <span class="tok-kn">Definition</span> <span class="tok-n">is_leaf</span> <span class="tok-o">(</span><span class="tok-n">t</span> <span class="tok-o">:</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">:</span> <span class="tok-kt">bool</span> <span class="tok-o">:=</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-k">match</span> <span class="tok-n">t</span> <span class="tok-k">with</span>
    <span class="tok-o">|</span> <span class="tok-n">Leaf</span> <span class="tok-o">=&gt;</span> <span class="tok-bp">true</span>
    <span class="tok-o">|</span> <span class="tok-n">Node</span> <span class="tok-n">x</span> <span class="tok-n">y</span> <span class="tok-o">=&gt;</span> <span class="tok-bp">false</span>
    <span class="tok-k">end</span><span class="tok-o">.</span>

  <span class="tok-kn">Fixpoint</span> <span class="tok-n">depth</span> <span class="tok-o">(</span><span class="tok-n">t</span> <span class="tok-o">:</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">:</span> <span class="tok-kt">nat</span> <span class="tok-o">:=</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-k">match</span> <span class="tok-n">t</span> <span class="tok-k">with</span>
    <span class="tok-o">|</span> <span class="tok-n">Leaf</span> <span class="tok-o">=&gt;</span> <span class="tok-mi">0</span>
    <span class="tok-o">|</span> <span class="tok-n">Node</span> <span class="tok-n">l</span> <span class="tok-n">r</span> <span class="tok-o">=&gt;</span> <span class="tok-n">S</span> <span class="tok-o">(</span><span class="tok-n">max</span> <span class="tok-o">(</span><span class="tok-n">depth</span> <span class="tok-n">l</span><span class="tok-o">)</span> <span class="tok-o">(</span><span class="tok-n">depth</span> <span class="tok-n">r</span><span class="tok-o">))</span> <span class="tok-c">(* Succesor of the  *)</span>
    <span class="tok-k">end</span><span class="tok-o">.</span>

  <span class="tok-kn">Lemma</span> <span class="tok-n">depth_positive</span> <span class="tok-o">:</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="tok-k">forall</span> <span class="tok-n">t</span> <span class="tok-o">:</span> <span class="tok-n">tree</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">&lt;</span> <span class="tok-n">depth</span> <span class="tok-n">t</span> <span class="tok-o">\/</span> <span class="tok-n">is_leaf</span> <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-bp">true</span><span class="tok-o">.</span>
  <span class="tok-kn">Proof</span><span class="tok-o">.</span>
    <span class="tok-k">induction</span> <span class="tok-n">t</span><span class="tok-o">.</span>
    <span class="tok-o">{</span>
      <span class="tok-k">cbv</span> <span class="tok-o">[</span><span class="tok-n">depth</span> <span class="tok-n">is_leaf</span><span class="tok-o">].</span> <i class="conum" data-value="6"></i><b>(6)</b>
      <span class="tok-k">right</span><span class="tok-o">.</span> <i class="conum" data-value="7"></i><b>(7)</b>
      <span class="tok-kp">reflexivity</span><span class="tok-o">.</span> <i class="conum" data-value="8"></i><b>(8)</b>
    <span class="tok-o">}</span>
    <span class="tok-o">{</span>
      <span class="tok-n">cbn</span> <span class="tok-o">[</span><span class="tok-n">depth</span> <span class="tok-n">is_leaf</span><span class="tok-o">].</span> <i class="conum" data-value="9"></i><b>(9)</b>
      <span class="tok-k">left</span><span class="tok-o">.</span> <i class="conum" data-value="10"></i><b>(10)</b>
      <span class="tok-n">lia</span><span class="tok-o">.</span> <i class="conum" data-value="11"></i><b>(11)</b>
    <span class="tok-o">}</span>
  <span class="tok-kn">Qed</span><span class="tok-o">.</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definition of a tree type.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating an instance of tree with three leaves and two intermediate nodes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defining <code>is_leaf</code> which tells whether the given tree is a leaf or not.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defining a function to compute the depth of a leaf.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Defining a lemma stating that the depth of a tree is positive when the tree is not a leaf.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Inline definitions for <code>depth</code> and <code>is_leaf</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Set the right part of the disjunction as goal for the proof.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The right part is true. This proves <code>true = true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Inline again, but do not overwrite depth and is_leaf. This avoids recursive calls to <code>depth</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Set the left part of the disjunction as the goal.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>According to <code>depth</code>, the node can not be a leaf. So the second part of the <code>depth</code> definition is used. This is the inductive step. The successor of a natural number is always greater than 0.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Coq system helps mechanizing the proof of lemmas and theorems by identifying the facts that can be used to achieve the proof and the formulas that still need to be proven.</p>
</div>
<div class="paragraph">
<p>Coq is also able to extract executable programs from definitions and theorems. There are additional extensions and tools to apply this methodology to other programming languages.</p>
</div>
<div class="paragraph">
<p><a href="http://compcert.inria.fr/">CompCert</a> is the first formally verified C compiler, but it is not bug-free even when a lot of effort has been invested into its formal verification. As said before, the main problem with formal proofs comes from the assumptions they make to abstract the real world. The following quote explains the reason behind a bug found in <em>CompCert</em>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The problem is that the 16-bit displacement field is overflowed. CompCertâs PPC semantics failed to specify a constraint on the width of this immediate value, on the assumption that the assembler would catch out-of-range values. In fact, this is what happened. We also found a handful of crash errors in CompCert.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; https://news.ycombinator.com/item?id=11905706
</div>
</div>
<div class="paragraph">
<p>Constructive approaches may also involve a form of model checking. These approaches represent the system as a formal behavioral model, usually transition systems or automata. The verification of these models is made with an exhaustive search on the entire state space. The specification of these models are written with the help of logic formalisms. The exhaustive search is directed to verify properties the system must have, for example, the absence of deadlocks. Model checking is used in hardware and software verification and, in most cases, they are performed at the system level. They find application in defense, nuclear plants and transportation.</p>
</div>
<div class="paragraph">
<p>The following diagram shows a model of the functioning of a microwave oven as a <a href="https://en.wikipedia.org/wiki/Kripke_structure_(model_checking)">Kripke structure</a>. (Adapted from <a href="https://www.dsi.unive.it/~avp/14_AVP_2013.pdf" class="bare">https://www.dsi.unive.it/~avp/14_AVP_2013.pdf</a>). The model includes first order propositions that characterize the states of the system and a transitional relationship between the states.</p>
</div>
<div id="microwave" class="imageblock">
<div class="content">
<img src="images/microwave.png" alt="microwave" width="733" height="511">
</div>
<div class="title">Figure 5. Model of a microwave-oven. Adapted from <a href="https://www.dsi.unive.it/~avp/14_AVP_2013.pdf" class="bare">https://www.dsi.unive.it/~avp/14_AVP_2013.pdf</a></div>
</div>
<div class="paragraph">
<p>These models can be used to generate concrete code that, for example, would be embedded in specific hardware, and it is possible to verify the state of the system at random inputs and even prove or falsify properties, <em>e.g.</em> for every input the heat is not on while the door is open.</p>
</div>
</div>
<div class="sect3">
<h4 id="_analytical_approach">1.3.3. Analytical approach</h4>
<div class="paragraph">
<p>This approach is directed to find the presence of bugs in the system. It is regularly based on heuristics and can target all kinds of software artifacts: code, models, requirements, etc. Its more used variant is <strong>software testing</strong> which evaluates a program by observing its execution under different conditions <a href="#ammann2017introduction">[ammann2017introduction]</a>. Testing presents, nowadays, the best trade-off between effort and result when it comes to the verification and validation of a software product. It will be the main focus of this course.</p>
</div>
<div class="paragraph">
<p>Bertrand Meyer proposes seven principles of testing <a href="#meyer2008seven">(23)</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Principle 1: To test a program is to try to make it fail</dt>
<dd>
<p>This is the main purpose of testing, to find defects in the code. In the words of Meyer the <em>single goal</em> of testing is <em>to uncover faults by triggering failures</em>. Testing can not be used to show the absence of bugs, as Dijkstra said and Meyer recalls. But it is extremely useful in finding those scenarios in which the software does not behave as intended. This definition of Meyer presents testing as a dynamic technique, that is, testing requires the execution of a program. However, there are some static code analysis techniques and tools that help detecting potential faults by finding well known code patterns that are prone to errors, or that ensure code quality by forcing development guidelines. In the long term these techniques help reducing the occurrence of bugs at a lower cost, since they don&#8217;t execute the program. Some authors refer to these analyses as <em>static testing</em>. There is controversy on whether these static analyses are in fact testing or not, but since they are highly valuable for the quality of the software we shall discuss them in the course.</p>
</dd>
<dt class="hdlist1">Principle 2: Tests are no substitute for specifications</dt>
<dd>
<p>Tests are built from specific cases, instances of the different scenarios in which the software shall execute. The specification is composed of more general abstractions tied to human understanding. While the specification can be used to derive test cases the opposite is not necessarily true. Even in large numbers, a finite amount of tests may not capture the general properties of the system due to missing instances.</p>
</dd>
<dt class="hdlist1">Principle 3: Any failed execution must yield a test case, to remain a permanent part of the projectâs test suite</dt>
<dd>
<p>Once a fault has been discovered there is always the peril that it can reappear later. It happens often in practice. Uncovered faults should then become test cases that prevent these regressions. This is known as <em>regression testing</em>.</p>
</dd>
<dt class="hdlist1">Principle 4: Determining the success or failure of tests must be an automatic process</dt>
<dd>
<p>Once a test is executed, one needs to know if the software behaved as expected. Thus, we need a <em>test oracle</em> to produce such verdict. As the number of test cases grows, this task must be automated. It does not scale to run hundreds of test cases, print the output of the program and then manually check whether the output is correct.</p>
</dd>
<dt class="hdlist1">Principle 5: An effective testing process must include both manually and automatically produced test cases</dt>
<dd>
<p>Manually produced test cases come from the understanding developers have about the problem domain and the input, or from <strong>Principle 3</strong>, as Meyer explains. But often corner and specific cases escape from human intuition. Complementing manually designed test cases with automatically produced test cases can help spot what developers missed. Computers are able to generate test cases to a level that humans can not reach and help explore unforeseen scenarios.</p>
</dd>
<dt class="hdlist1">Principle 6: Evaluate any testing strategy through objective assessment using explicit criteria in a reproducible testing process</dt>
<dd>
<p>Any testing strategy must be assessed empirically. No matter how sophisticated a testing technique can be, it is of no use if it can not discover faults.  Meyer recalls that simple techniques such as random testing are proven to be quite efficient. Then there is the question on how to evaluate the effectiveness of our testing strategy.</p>
</dd>
<dt class="hdlist1">Principle 7: A testing strategyâs most important property is the number of faults it uncovers as a function of time</dt>
<dd>
<p>Code coverage, that is, the parts of the code executed in the test cases is often used to evaluate the quality of tests. However, this is only useful to spot the parts of the code that aren&#8217;t yet tested, not how well the executed parts are verified. So, coverage is not, in general, a measure of the quality of the tests. The assessment of the tests should correspond to their ability to detect bugs. In this principle Meyer includes time. Of course, the faster faults are encountered, the better.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This set of principles is not comprehensive and not all authors and practitioners agree with all aspects of their formulations. However, in our opinion, they reveal the essence of testing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Meyer&#8217;s article <em>Seven Principles of Software Testing</em>  provoked an answer from Gerald D. Everett, a testing expert and also author of books on the topic. The answer qualified Meyer&#8217;s principles as <em>insufficient</em> since they don&#8217;t encompass other software quality aspects. The discussion went on with more answers and short essays from both authors. The entire discussion is worth the reading. More details and pointers can be found in Meyer&#8217;s own blog: <a href="https://bertrandmeyer.com/2009/08/12/what-is-the-purpose-of-testing/" class="bare">https://bertrandmeyer.com/2009/08/12/what-is-the-purpose-of-testing/</a>. Needless to say, we agree with Meyer&#8217;s point of view.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modern_practices_cicd_and_devops">1.3.4. Modern practices: CI/CD and DevOps</h4>
<div class="paragraph">
<p>Nowadays testing is automated as much as possible. Software developers use automated processes to facilitate the integration of the work done separately by team members, detect errors as fast as possible and automate most tedious and error-prone tasks.</p>
</div>
<div class="paragraph">
<p><strong>Continuous Integration</strong> (CI) is one of those practices. It is a process in which developers frequently integrate their code into a single shared source control repository. After a change is pushed to a central repository, an automated pipeline is triggered to build and verify the application after the incorporation of the new change. <a href="#fowler2006continuous">(25)</a> <a href="#thoughtworksintegration">(26)</a></p>
</div>
<div class="paragraph">
<p>According to Martin Fowler:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Continuous Integration doesnât get rid of bugs, but it does make them dramatically easier to find and remove.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Martin Fowler<br>
<cite>Chief Scientist ThoughtWorks</cite>
</div>
</div>
<div class="paragraph">
<p>The frequent integration of each developer&#8217;s work facilitate the early detection of errors as opposed to each developer working on isolation and then spending a lot of time dealing with the combination of their individual efforts. Most software companies these days use a form of CI and the most used source control hosting services such as Github, Gitlab and Bitbucket encourage these practices by making it easy to incorporate CI tools and even providing their own CI automation alternatives.</p>
</div>
<div class="paragraph">
<p>According to Thoughtworks, <a href="#thoughtworksintegration">(26)</a> CI processes are supported by the following practices:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Maintenance of a single source repository</dt>
<dd>
<p>All team members should merge their changes into a global/unique code repository, hosted in a source control hosting service, either in-premises or using a public service like Github. The source control repository plays an important role in the identification of a change and the detection of conflicts between simultaneous changes. The common practice nowadays is to use distributed source control systems like Git of Mercurial in opposition to the previous centralized systems like CVS or SVN. Even when the source control system is distributed, that is, every developer has a copy of the repository, the CI process should monitor one central repository to which all developers should push their changes. This does not exclude the creation of mirror repositories.</p>
</dd>
<dt class="hdlist1">Automate the build</dt>
<dd>
<p>Once a developer pushes her changes into the global repository, a CI server checks out the changes and triggers a build process. This build process is expected to be <strong>self-testing</strong>, that is, as part of the automated build, tests should be executed to verify the changes in the code. These tests should also be executed in an environment as <strong>close</strong> as possible <strong>to</strong> the <strong>production conditions</strong>. The build is also <strong>expected to be fast</strong> so developers have a quick feedback on the change they integrated and the outcome of the build process should be accessible to all team members so they know the current state of the project.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>CI processes also impose responsibilities to developers as they are expected to push changes frequently. Also changes should be tested before integrating them into the global repository. Also, developers should not push any change while the automated build fails, that is, when a previous change produced a failure in the CI build process either compiling or running the tests. When a build fails it should be fixed as fast as possible to ensure the quality of the integrated code in the global repository.</p>
</div>
<div class="paragraph">
<p>CI processes are often accompanied by <strong>Continuous Delivery</strong> and <strong>Continuous Deployment</strong> processes.</p>
</div>
<div class="paragraph">
<p><strong>Continuous Delivery</strong> is an automated process involving a verification pipeline whose outcome determines if a change is ready to be deployed. It may involve a larger build process than the one of the CI, including <strong>acceptance tests</strong>, which are tests in direct correlation to the requirements or the user&#8217;s needs, tests in several environment conditions, such as different operating systems, and it may even include manual testing. Once a change passes the <strong>delivery pipeline</strong> it is considered as robust enough to be deployed.</p>
</div>
<div class="paragraph">
<p>On its side, <strong>Continuous Deployment</strong> is an automated process to set artifacts produced and verified by successful builds into production. Continuous Deployment requires Continuous Delivery. Both enable frequent product releases. Some companies may release their products in a daily or even an hourly basis.</p>
</div>
<div class="paragraph">
<p>CI/CD approaches find great realization in <strong>DevOps</strong>. DevOps is a modern development culture in which team members of all roles commit to the quality of the final product and not just divide themselves into silos like the "development team" or "operation team". Automation is at the core of DevOps as every development phase is backed by automated processes and state-of-the-art tools. In DevOps, all phases: <em>plan</em>, <em>code</em>, <em>build</em>, <em>test</em>, <em>release</em>, <em>deploy</em>, <em>operate</em>, <em>monitor</em> are imbricated in an infinite loop (<a href="#devops">Figure 6</a>) and the outcome of one phase impacts the other. For example, crashes observed in production by monitoring the system, automatically become an issue for developers and are incorporated to the set of tests.</p>
</div>
<div id="devops" class="imageblock text-center">
<div class="content">
<img src="images/devops.svg" alt="DevOps" width="600">
</div>
<div class="title">Figure 6. DevOps diagram</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_quality_and_static_analysis">2. Code quality and static analysis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of any software project is to deliver a product of the highest possible quality, or at least it should be. Good software has scarce bugs. However, the notion of quality also characterizes how the product is being built and structured. Observing these aspects should help, in the end, to avoid the introduction of bugs. Diomidis Spinellis in his book <em>Code Quality: The Open Source Perspective</em> <a href="#spinellis2006code">(26)</a> presents four views of software quality:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Quality in use</dt>
<dd>
<p>This view is centered in the user experience (UX), that is, how users perceive the software. It is the extent to which users can achieve their goals in a particular environment. It does not care about how the product is built. If a word processor makes it hard to edit a document, then it does not serve it purposes.</p>
</dd>
<dt class="hdlist1">External quality attributes</dt>
<dd>
<p>These attributes manifest themselves in the execution of the program. They characterize how well the product conforms to the specification. Observed failures signal the presence of bugs. Crashes, efficiency problems and alike degrade the external quality of the software. External quality attributes directly affect the quality in use.</p>
</dd>
<dt class="hdlist1">Internal quality attributes</dt>
<dd>
<p>They characterize the internal structure of the product. According to Martin Fowler, <a href="#fowler2019is">(27)</a>, internal software quality is impacted by how easy it is to understand the code. This, in turn, impacts how easy it is to maintain the product, add new features, improve and detect errors. Internal quality has a great impact in the external quality of the software.</p>
</dd>
<dt class="hdlist1">Process quality</dt>
<dd>
<p>It is a direct expression of how the software product was built. It is affected by the methodologies, practices, tools and frameworks used to develop the software. A good development process favors actions that improve the internal quality of the product, and minimize the amount of <em>accidental complexity</em> which is introduced into engineering solutions due to mismatches between a problem and the technology used to represent the problem.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the end, all views of quality are deeply interconnected. The process quality impacts the internal quality. The internal quality affects in turn the external quality which directly affects the user experience.</p>
</div>
<div class="paragraph">
<p>Several models of software quality attributes have been proposed and standardized throughout the years <a href="#boehm1976quantitative">(28)</a>, <a href="#iso2011square">(29)</a>. However they all insist, as the Consortium for IT Software Quality (CISQ) summarizes, that high quality software products must be:
<strong>reliable</strong> (low risk level in use and low likelihood of potential failures), <strong>efficient</strong>, <strong>secure</strong>, and <strong>maintainable</strong>.</p>
</div>
<div class="paragraph">
<p>Martin Fowler <a href="#fowler2019is">(27)</a> explains that, as time goes by and a project becomes more complex, it is harder to add new features. At this point, even small changes require programmers to understand large areas of code. Paying attention to internal quality is crucial to further develop the product. Fowler calls <em>cruft</em> those deficiencies in internal quality that make it harder to modify and extend the system. <em>Crufts</em> are redundant, useless and dysfunctional pieces of code that become obstacles and increase maintenance costs. This is part of what is also known as <em>Technical Debt</em>.</p>
</div>
<div class="paragraph">
<p>External quality attributes can be observed and improved with the help of testing. Meanwhile internal quality attributes are observed by analyzing the code without executing it, that is, with the help of static code analysis. Some authors consider static analysis as a form of <em>static testing</em>. However, Meyer in its principles <a href="#meyer2008seven">(23)</a> excludes these techniques from the testing umbrella. Either way, static analysis helps to spot potential problems earlier and therefore impacts the testing process.</p>
</div>
<div class="sect2">
<h3 id="_code_quality">2.1. Code quality</h3>
<div class="paragraph">
<p>Internal quality is assured by good code and good development practices. Good code is easy to understand and maintain. But, what may be easy to understand for one developer might be hard to understand for another, and even for the same developer two weeks after the code was written. Fortunately, the community has gathered and shared practices shown to work well, or not, according to experience.</p>
</div>
<div class="sect3">
<h4 id="_coding_guidelines">2.1.1. Coding guidelines</h4>
<div class="paragraph">
<p>Some good development practices are presented as <em>coding guidelines</em> or <em>coding conventions</em>. These are rules that specify how the code should be written so it can be understood by everyone (<em>e.g.</em>, The Google Java Style Guide <a href="#googlestyle">(1)</a>). They may go from how to name a class or a method and how to handle exceptions to how and when to insert blank spaces in the code.</p>
</div>
<div class="paragraph">
<p>Coding guidelines may be specific to a programming language, to a particular framework, library, or tool, they may even be specific to a company or even a project. There are also guidelines general enough so they could be applied anywhere or guidelines that pursue an specific goal such as reducing security breaches in a program.</p>
</div>
<div class="sect4">
<h5 id="_naming_conventions">Naming conventions</h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>There are only two hard things in Computer Science: cache invalidation and naming things.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Phil Karlton<br>
<cite>Product Architect at Netscape</cite>
</div>
</div>
<div class="paragraph">
<p>Part of the coding guidelines is devoted to help developers knowing how to name program elements such as classes or methods. These guidelines are different from one language to the other, although they share common ideas. This section contains three examples from Java, C# and Python.</p>
</div>
<div class="paragraph">
<p>The following <a href="#java-naming-conventions">Example 1</a> is an extract from the Java coding conventions <a href="#oracle1997java">(30)</a>. This fragment specifies how developers should name classes, interfaces and methods.</p>
</div>
<div id="java-naming-conventions" class="exampleblock">
<div class="title">Example 1. Java naming conventions for classes, interfaces and methods</div>
<div class="content">
<div class="paragraph">
<p>Class names should be nouns, in mixed case with the first letter of each internal word capitalized. Try to keep your class names simple
and descriptive. Use whole wordsâavoid acronyms and abbreviations (unless the abbreviation is much more widely used than the
long form, such as URL or HTML).</p>
</div>
<div class="paragraph">
<p>Interface names should be capitalized like class names.</p>
</div>
<div class="paragraph">
<p>Methods should be verbs, in mixed case with the first letter lowercase, with the first letter of each internal word capitalized.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#java-naming-example">Listing 9</a> shows a piece of code respecting the naming conventions form <a href="#java-naming-conventions">Example 1</a>.</p>
</div>
<div id="java-naming-example" class="listingblock">
<div class="title">Listing 9. Java code matching naming conventions for classes, interfaces and methods</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ArrayList</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractList</span> <span class="tok-kd">implements</span> <span class="tok-n">RandomAccess</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ensureCapacity</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">minCapacity</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#csharp-naming-conventions">Example 2</a> contains an extract of the naming conventions for C# <a href="#microsoft2008naming">(31)</a>.</p>
</div>
<div id="csharp-naming-conventions" class="exampleblock">
<div class="title">Example 2. C# naming conventions</div>
<div class="content">
<div class="paragraph">
<p>âï¸ DO name classes and structs with nouns or noun phrases, using PascalCasing. This distinguishes type names from methods, which are named with verb phrases.</p>
</div>
<div class="paragraph">
<p>âï¸ DO name interfaces with adjective phrases, or occasionally with nouns or noun phrases.</p>
</div>
<div class="paragraph">
<p>â DO NOT give class names a prefix (e.g., "C").</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>âï¸ DO prefix interface names with the letter I, to indicate that the type is an interface.</p>
</div>
<div class="paragraph">
<p>âï¸ DO ensure that the names differ only by the "I" prefix on the interface name when you are defining a classâinterface pair where the class is a standard implementation of the interface.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>There are similarities between the naming conventions for Java and C#. For example, class names should be noun phrases starting with a capital letter and using <em>PascalCasing</em> (Also called <em>UpperCamelCase</em>, <em>DromedaryCase</em> or <em>CapWords</em>). While method names in both languages should be verb phrases indicating an action, in Java developers use <em>camelCasing</em>. Notice that, in C#, interfaces should be prefixed with <code>I</code> but classes should not be prefixed with <code>C</code>. <a href="#csharp-naming-example">Listing 10</a> shows a code fragment matching these naming conventions. The <code>I</code> prefix helps to quickly differentiate between classes and interfaces.</p>
</div>
<div id="csharp-naming-example" class="listingblock">
<div class="title">Listing 10. C# code respecting naming conventions</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="csharp"><span></span><span class="tok-k">public</span> <span class="tok-k">class</span> <span class="tok-nc">ComplexNode</span> <span class="tok-p">:</span> <span class="tok-n">Node</span><span class="tok-p">,</span> <span class="tok-n">IEnumerable</span>
<span class="tok-p">{</span>
    <span class="tok-k">public</span> <span class="tok-k">void</span> <span class="tok-nf">RemoveNode</span><span class="tok-p">(</span><span class="tok-n">Node</span> <span class="tok-n">node</span><span class="tok-p">)</span> <span class="tok-p">{</span> <span class="tok-p">...</span> <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Python developers use conventions to further differentiate method and functions from classes and user defined classes from built-in types <a href="#vanrossum2001style">(32)</a>. See <a href="#python-naming-conventions">Example 3</a>.</p>
</div>
<div id="python-naming-conventions" class="exampleblock">
<div class="title">Example 3. Naming conventions for Python</div>
<div class="content">
<div class="paragraph">
<p>Class names should normally use the CapWords convention.
The naming convention for functions may be used instead in cases where the interface is documented and used primarily as a callable.</p>
</div>
<div class="paragraph">
<p>Note that there is a separate convention for builtin names: most builtin names are single words (or two words run together), with the CapWords convention used only for exception names and builtin constants.</p>
</div>
<div class="paragraph">
<p>Function names should be lowercase, with words separated by underscores as necessary to improve readability.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>With this, one can easily infer that <code>Node</code> names a class, <code>str</code> is a built-in type and <code>remove_node</code> is a function.</p>
</div>
<div class="paragraph">
<p>Naming conventions are derived in most of the cases from the taste  and practice of the community around a language or framework.  In the end, these conventions help improving the readability of the code as developers can quickly understand the role of each element in a program.</p>
</div>
</div>
<div class="sect4">
<h5 id="_indentation">Indentation</h5>
<div class="paragraph">
<p>In most languages extra white spaces do not change the semantics of a program but they may play an important role in readability. For example, the indentation is useful to know the limit of methods, classes, nested instructions and any block in general. Each programming language tries to enforce an indentation style, but even for the same language different developers may follow different styles. Keeping a consistent style improves the understanding of a program.</p>
</div>
<div class="paragraph">
<p><a href="#indentation-examples">Table 1</a> shows three examples of different indentation styles applied to the same fragment of code. Notice how different the program looks in each case.</p>
</div>
<table id="indentation-examples" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Examples of indentation styles taken from <a href="https://en.wikipedia.org/wiki/Indentation_style">Wikipedia</a> <a href="#wikipedia2020indentation">(33)</a></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Kernighan &amp; Ritchie</strong> (K&amp;R 1TBS)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><span></span><span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-n">y</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-n">something</span><span class="tok-p">();</span>
    <span class="tok-n">somethingelse</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Allman</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><span></span><span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-n">y</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-n">something</span><span class="tok-p">();</span>
    <span class="tok-n">somethingelse</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
<span class="tok-o">---</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Ratliff</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><span></span><span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-n">y</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-n">something</span><span class="tok-p">();</span>
    <span class="tok-n">somethingelse</span><span class="tok-p">();</span>
    <span class="tok-p">}</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Haskell</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c"><span></span><span class="tok-k">while</span> <span class="tok-p">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-n">y</span><span class="tok-p">)</span>
  <span class="tok-p">{</span> <span class="tok-n">something</span><span class="tok-p">()</span>
  <span class="tok-p">;</span> <span class="tok-n">somethingelse</span><span class="tok-p">()</span>
  <span class="tok-p">;</span>
  <span class="tok-p">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <em>Kernighan &amp; Ritchie</em> style, also known as &#8220;_the one true brace style_&#8221; and &#8220;Egyptian braces&#8221; was used in the influential book <em>The C Programming Language</em> written by Brian Kernighan and Dennis Ritchie (creator of C). Besides C, this style is also used in C++ and Java. C# however, uses the Allman style, in which the first brace is written in a separated line. The Allman style is also used in Pascal and SQL.</p>
</div>
<div class="paragraph">
<p>Wikipedia lists nine different indentation styles most of them with additional variants <a href="#wikipedia20202indentation">[wikipedia20202indentation]</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_framework_and_company_specific_guidelines">Framework and company specific guidelines</h5>
<div class="paragraph">
<p>Companies and even communities around a framework or project may impose specific guidelines to override or extend language conventions.</p>
</div>
<div class="paragraph">
<p>Sometimes these guidelines have a concrete goal other than readability. For instance, <a href="#microsoft-security-example">Example 4</a> shows an extract of the guidelines Microsoft enforces to write secure code using the .NET framework <a href="#microsoft2018secure">(34)</a>.</p>
</div>
<div id="microsoft-security-example" class="exampleblock">
<div class="title">Example 4. Microsoft&#8217;s secure coding guidelines for the .NET framework.</div>
<div class="content">
<div class="paragraph">
<p>When designing and writing your code, you need to protect and limit the access that code has to resources, especially when using or invoking code of unknown origin. So, keep in mind the following techniques to ensure your code is secure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not use Code Access Security (CAS).</p>
</li>
<li>
<p>Do not use partial trusted code.</p>
</li>
<li>
<p>Do not use the AllowPartiallyTrustedCaller attribute (APTCA).</p>
</li>
<li>
<p>Do not use .NET Remoting.</p>
</li>
<li>
<p>Do not use Distributed Component Object Model (DCOM).</p>
</li>
<li>
<p>Do not use binary formatters.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#google-conventions">Example 5</a> shows how Google extends the Java coding conventions to their own projects <a href="#google2020java">(35)</a>.</p>
</div>
<div id="google-conventions" class="exampleblock">
<div class="title">Example 5. Google conventions for Java</div>
<div class="content">
<div class="paragraph">
<p>When a reference to a static class member must be qualified, it is qualified with that class&#8217;s name, not with a reference or expression of that class&#8217;s type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Foo</span> <span class="tok-n">aFoo</span> <span class="tok-o">=</span> <span class="tok-o">...;</span>
<span class="tok-n">Foo</span><span class="tok-o">.</span><span class="tok-na">aStaticMethod</span><span class="tok-o">();</span> <span class="tok-c1">// good</span>
<span class="tok-n">aFoo</span><span class="tok-o">.</span><span class="tok-na">aStaticMethod</span><span class="tok-o">();</span> <span class="tok-c1">// bad</span>
<span class="tok-n">somethingThatYieldsAFoo</span><span class="tok-o">().</span><span class="tok-na">aStaticMethod</span><span class="tok-o">();</span> <span class="tok-c1">// very bad</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_should_conventions_be_always_enforced">Should conventions be always enforced?</h5>
<div class="paragraph">
<p>Conventions are created to set a common ground for understanding. This is especially useful when we are learning a new language and to ease the collaboration between different developers in a project. However, there are cases in which strictly following these conventions actually has the opposite effect. For example, when dealing with legacy code that followed different guidelines, it is better to stick to the practices in place rather than introducing new conventions.</p>
</div>
<div class="paragraph">
<p>In any case, the ultimate goal must be to write consistent code that can be understood by all team/project members. Common sense is always the best guideline.</p>
</div>
<div class="paragraph">
<p><a href="#microsoft-base-name">Example 6</a> explains how to name extending classes with respect to the base class, but it also warns against over-use <a href="#microsoft2008naming">(31)</a>.</p>
</div>
<div id="microsoft-base-name" class="exampleblock">
<div class="title">Example 6. Microsoft&#8217;s guideline to name extending classes with a warning on when not to use it</div>
<div class="content">
<div class="paragraph">
<p>âï¸ CONSIDER ending the name of derived classes with the name of the base class.</p>
</div>
<div class="paragraph">
<p>This is very readable and explains the relationship clearly. Some examples of this in code are: ArgumentOutOfRangeException, which is a kind of Exception, and SerializableAttribute, which is a kind of Attribute. However, it is important to use reasonable judgment in applying this guideline; for example, the Button class is a kind of Control event, although Control doesnât appear in its name.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#python-guidelines-warning">Example 7</a> shows an extract from the Python coding guidelines stressing the idea that keeping consistency is more important than following the guidelines <a href="#vanrossum2001style">(32)</a>.</p>
</div>
<div id="python-guidelines-warning" class="exampleblock">
<div class="title">Example 7. Python guidelines on consistency and guidelines applications</div>
<div class="content">
<div class="paragraph">
<p>A style guide is about consistency. Consistency with this style guide is important. Consistency within a project is more important. Consistency within one module or function is the most important.</p>
</div>
<div class="paragraph">
<p>However, know when to be inconsistent&#8201;&#8212;&#8201;sometimes style guide recommendations just aren&#8217;t applicable. When in doubt, use your best judgment. Look at other examples and decide what looks best. And don&#8217;t hesitate to ask!</p>
</div>
<div class="paragraph">
<p>In particular: do not break backwards compatibility just to comply with this PEP!</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_smells_and_antipatterns">2.1.2. Code Smells and AntiPatterns</h4>
<div class="paragraph">
<p>Thorough the years, developers have identified patterns of code that usually become symptoms of hidden problems affecting the quality of the software. Such code patterns are known as <em>Code Smells</em> (also known as <em>bad smells</em>), a term coined by Kent Beck and first presented in Martin Fowler&#8217;s <em>Refactoring</em> book <a href="#fowler2006codesmells">[fowler2006codesmells]</a>.</p>
</div>
<div class="paragraph">
<p>Code smells do not always lead to a problem or a bug. But, in most cases, their presence makes the code harder to understand and maintain, and in Fowler&#8217;s words &#8220;they are often an indicator of a problem rather than the problem themselves&#8221;. Code smells can be eliminated by refactoring, that is, restructuring the program to make it simpler.</p>
</div>
<div class="paragraph">
<p>The <a href="https://sourcemaking.com/">Source Making Blog</a> presents a list of well known code smells and how they could be solved <a href="#source2020smells">(37)</a>. Internet is full with such lists which might differ on the (generally catchy) name they use to categorize a smell and some might miss one or two patters.</p>
</div>
<div class="paragraph">
<p>The following is a small sample from that list.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Long method</dt>
<dd>
<p>A method that contains too many lines of code or too many statements. Long methods tend to hide unwanted duplicated code and are harder to maintain. It can be solved by splitting the code in shorter methods easier to reuse, maintain and understand. <a href="#long-method-example">Listing 11</a> shows a fragment taken from <a href="#glover2006monitoring">(39)</a> of nearly 20 lines of code. It is already a big chunk of code, but it comes for a very large method of more than 350 lines. This is a clear, and rather extreme example of this code smell.</p>
<div id="long-method-example" class="listingblock">
<div class="title">Listing 11. An already large fragment of code from a method of more than 350 lines. Taken from <a href="#glover2006monitoring">[glover2006monitoring]</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">entityImplVO</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">List</span> <span class="tok-n">actions</span> <span class="tok-o">=</span> <span class="tok-n">entityImplVO</span><span class="tok-o">.</span><span class="tok-na">getEntities</span><span class="tok-o">();</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">actions</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-n">actions</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
  <span class="tok-n">Iterator</span> <span class="tok-n">enItr</span> <span class="tok-o">=</span> <span class="tok-n">actions</span><span class="tok-o">.</span><span class="tok-na">iterator</span><span class="tok-o">();</span>
  <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">enItr</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">())</span> <span class="tok-o">{</span>
    <span class="tok-n">entityResultValueObject</span> <span class="tok-n">arVO</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">entityResultValueObject</span><span class="tok-o">)</span> <span class="tok-n">actionItr</span>
     <span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
    <span class="tok-n">Float</span> <span class="tok-n">entityResult</span> <span class="tok-o">=</span> <span class="tok-n">arVO</span><span class="tok-o">.</span><span class="tok-na">getActionResultID</span><span class="tok-o">();</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">assocPersonEventList</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">actionResult</span><span class="tok-o">))</span> <span class="tok-o">{</span>
      <span class="tok-n">assocPersonFlag</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">arVL</span><span class="tok-o">.</span><span class="tok-na">getByName</span><span class="tok-o">(</span>
      <span class="tok-n">AppConstants</span><span class="tok-o">.</span><span class="tok-na">ENTITY_RESULT_DENIAL_OF_SERVICE</span><span class="tok-o">)</span>
         <span class="tok-o">.</span><span class="tok-na">getID</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">entityResult</span><span class="tok-o">))</span> <span class="tok-o">{</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">actionBasisId</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">actionImplVO</span><span class="tok-o">.</span><span class="tok-na">getActionBasisID</span><span class="tok-o">()))</span> <span class="tok-o">{</span>
        <span class="tok-n">assocFlag</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
      <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">arVL</span><span class="tok-o">.</span><span class="tok-na">getByName</span><span class="tok-o">(</span>
     <span class="tok-n">AppConstants</span><span class="tok-o">.</span><span class="tok-na">ENTITY_RESULT_INVOL_SERVICE</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">getID</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">entityResult</span><span class="tok-o">))</span> <span class="tok-o">{</span>
     <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">reasonId</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">arVO</span><span class="tok-o">.</span><span class="tok-na">getStatusReasonID</span><span class="tok-o">()))</span> <span class="tok-o">{</span>
       <span class="tok-n">assocFlag</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
     <span class="tok-o">}</span>
   <span class="tok-o">}</span>
 <span class="tok-o">}</span>
<span class="tok-o">}</span><span class="tok-k">else</span><span class="tok-o">{</span>
  <span class="tok-n">entityImplVO</span> <span class="tok-o">=</span> <span class="tok-n">oldEntityImplVO</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Large class</dt>
<dd>
<p>A class containing too many methods, fields and lines of code. Large classes can be split into several classes and even into a hierarchy in which each smaller class has a very well defined purpose.</p>
</dd>
<dt class="hdlist1">Long parameter list</dt>
<dd>
<p>A method with a long list of parameters is harder to use. Parameters could be replaced by method calls or passing complete objects.</p>
</dd>
<dt class="hdlist1">Primitive obsession</dt>
<dd>
<p>Abuse of primitive types instead of creating one&#8217;s own abstractions.</p>
</dd>
<dt class="hdlist1">Temporary fields</dt>
<dd>
<p>Fields in classes that are used only under certain circumstances in one or very few methods, otherwise they are not used. These fields could be promoted most of the times to local variables.</p>
</dd>
<dt class="hdlist1">Feature envy</dt>
<dd>
<p>A method that accesses the data of another object more than its own data. This method&#8217;s behavior will probably be better placed in the class of the external object.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Code smells are very well localized program fragments. However, there are more global patterns that are often used as solutions to a problem but they may bring more harm than benefits and are better to avoid. These bad solutions are described as <em>AntiPatterns</em>. The same <a href="https://sourcemaking.com/">Source Making Blog</a> provides an interesting list of AntiPatterns related to coding practices, software architecture designs and even related to the management of a project. Identifying these bad solutions helps also in finding a better alternative <a href="#source2020anti">(38)</a>.</p>
</div>
<div class="paragraph">
<p>Here are some examples:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Golden Hammer</dt>
<dd>
<p>Using a single tool to solve most problems even when it is not the best alternative. Leads to inferior performance and less suited solutions, requirements are accommodated more to match the tool than what users may need, design choices are dictated by the tool&#8217;s capabilities and new development relies heavily in the tool.</p>
</dd>
<dt class="hdlist1">Cut-And-Paste Programming</dt>
<dd>
<p>This one is self-descriptive: code is reused by copying and pasting fragments in different places. In the case that the originally copied code has a bug, then the issue will reoccur in all places where the code was pasted and it will be harder to solve.</p>
</dd>
<dt class="hdlist1">Swiss Army Knife</dt>
<dd>
<p>An excessively complex class interface attempting to provide a solution for all possible uses of the class. These classes include too many method signatures for a single class. It denotes an unclear abstraction or purpose.</p>
</dd>
<dt class="hdlist1">Design By Committee</dt>
<dd>
<p>A software design, usually from a committee, that is so complex and so full of different features and variants that it becomes impossible to complete in a reasonable lapse of time.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_code_metrics">2.1.3. Code Metrics</h4>
<div class="paragraph">
<p>Many code smells are vague in their formulation. For example: How can we tell that a method or a class is too long? Or, how can we tell that two classes are too coupled together so their functionalities should be merged or rearranged? The identification of such potential issues requires concrete measurements for the method length or the coupling between classes. These are known as <em>code metrics</em>.</p>
</div>
<div class="paragraph">
<p>Code metrics are quantitative characterizations of code features. They are used to assess the structural quality of the software and provide an effective and customizable way to automate the detection of potential code issues. This section presents some examples of commonly used metrics.</p>
</div>
<div class="sect4">
<h5 id="_lines_of_code">Lines of Code</h5>
<div class="paragraph">
<p>The simplest code metric is, maybe, the number of <em>Lines of Code</em> (LoC) of a method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes code metrics are presented for <em>operations</em> instead of methods. <em>Operations</em> are indeed methods but the term is broader to escape from the Object-Oriented terminology and reach other programming paradigms.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>LoCs can be used to compare the length of the methods in a project. It helps to detect those methods that are too long when compared to a given threshold. However, this threshold depends on the development practices used for the project. The programming language as well as the frameworks and libraries supporting the code do have an impact on the length of the methods. For example, a small study made by Jon McLoone from Wolfram <a href="#mcloone2012code">(40)</a>, observed in <a href="http://rosettacode.org/wiki/Rosetta_Code">Rosetta Code</a> programs that <em>Mathematica</em> requires <em>less than a third of the length of the same tasks written in other languages</em>.</p>
</div>
<div class="paragraph">
<p>Including blank lines or lines with comments in the metric may be misleading. Therefore, LoC is often referred as <em>Physical Lines of Code</em> while developers also measure <em>Logical Lines of Code</em> (LLoC) which counts the number of programming language statements in the method.</p>
</div>
</div>
<div class="sect4">
<h5 id="cyclomatic-section">Cyclomatic Comprexity</h5>
<div class="paragraph">
<p>A method with many branches and logical decisions is, in general, hard to understand. This affects the maintainability of the code. Back in 1976, Thomas J. McCabe  proposed a metric to assess the complexity of a program <a href="#mccabe1976complexity">(41)</a>. McCabe&#8217;s original idea was to approximate the complexity of a program by computing the <em>cyclomatic number</em> of its control flow graph. This is why the metric is also known as <em>McCabe&#8217;s Cyclomatic Complexity</em>. The goal of the metric was to provide a quantitative basis to determine whether a software module was hard to understand, maintain and test.</p>
</div>
<div class="paragraph">
<p>A sequence of code instructions, and by extension the body of a method, could be represented by a directed graph named <em>control flow graph</em>. The procedure is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initially, the graph has two special nodes: the <em>start</em> node and the <em>end</em> node.</p>
</li>
<li>
<p>A sequence of instructions with no branches is called a <em>basic block</em>. Each basic block becomes a node in the graph.</p>
</li>
<li>
<p>Each branch in the code becomes an edge. The direction of edge coincides with the direction of the branch.</p>
</li>
<li>
<p>There is an edge from the start node to the node with the first instruction.</p>
</li>
<li>
<p>There is an edge from all nodes that could terminate the execution of the code, to the end node.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the method in <a href="#max-method">Listing 12</a> computes the maximum of three given integers. The control flow graph for this method is shown in <a href="#control-flow-max-method">Figure 7</a>.</p>
</div>
<div id="max-method" class="listingblock">
<div class="title">Listing 12. A method that computes the maximum between three given integers</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">max</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">c</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">a</span> <span class="tok-o">&gt;</span> <span class="tok-n">c</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">c</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">b</span> <span class="tok-o">&gt;</span> <span class="tok-n">c</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">b</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">c</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="control-flow-max-method" class="imageblock">
<div class="content">
<img src="images/control-flow-max-method.png" alt="control flow max method" width="427" height="485">
</div>
<div class="title">Figure 7. Control flow graph from the method in <a href="#max-method">Listing 12</a></div>
</div>
<div class="paragraph">
<p>The cyclomatic complexity of a program, represented by its control flow graph, is defined as \$v(G) = E - V + 2P\$, where \$N\$ is the number of nodes, \$E\$ the number of edges and \$P\$ the number of connected components or the underlying undirected graph. In the way we have defined the control flow graph, \$P\$ will always be 1. This metric is directly derived from the cyclomatic number or circuit rank of the undirected graph. This property represents the minimum number of edges that has to be removed in order to break all cycles and obtain a spanning tree.</p>
</div>
<div class="paragraph">
<p>McCabe showed that the computation of the  cyclomatic complexity could be simplified as the number of predicate nodes (conditionals) plus one. The method in <a href="#max-method">Listing 12</a> has a cyclomatic complexity of \$v(G) = 4 = 3 + 1\$, as it has three conditionals: <code>a &gt; b</code>, <code>a &gt; c</code> and <code>b &gt; c</code>. It can be also computed as \$v(G) = 4 = 11 - 9 + 2\$, as it has eleven edges, nine nodes and only one connected component.</p>
</div>
<div class="paragraph">
<p>McCabe&#8217;s cyclomatic complexity is well known and widely used. It is frequently accompanied by a scale. Values below 10 are usually considered as good. However, some caveats of the metrics must be taken into account. First, it was conceived for unstructured programs and some aspects of its original definition are vague. Modern tools implementing the metric work under different assumptions, therefore two different tools may not produce the same result for the same method. Logical conjunctions and disjunctions (<code>&amp;&amp;</code>, <code>||</code>) also produce branches but not all tools include them in their result.</p>
</div>
<div class="paragraph">
<p>Not always the cyclomatic complexity matches the developer&#8217;s idea of what is a complex method. For example, the metric does not consider nested structures. It produces the same value for the two code fragments in <a href="#ifs-mccabe">Listing 13</a>.</p>
</div>
<div id="ifs-mccabe" class="listingblock">
<div class="title">Listing 13. These two pieces of code have the same cyclomatic complexity</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// 1</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>

<span class="tok-o">}</span>

<span class="tok-c1">//2</span>
<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>

<span class="tok-o">}</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">{</span>

<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#hummel2014mccabe">(42)</a>, the author advocates against the use of the metric. Besides showing concrete examples where tools produce different results, he shows the method in <a href="#hummel-switch">Listing 14</a>. The author explain that this method is fairly easy to understand, yet it has a cyclomatic complexity of 13 while the more complex method in <a href="#hummel-primes">Listing 15</a> has a cyclomatic complexity of 5.</p>
</div>
<div id="hummel-switch" class="listingblock">
<div class="title">Listing 14. A simple method with a cyclomatic complexity of 13. Taken from <a href="#hummel2014mccabe">[hummel2014mccabe]</a>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-nf">getMonthName</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">month</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">month</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">case</span> <span class="tok-mi">0</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;January&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;February&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;March&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">3</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;April&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">4</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;May&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">5</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;June&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">6</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;July&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">7</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;August&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">8</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;September&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">9</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;October&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">10</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;November&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">case</span> <span class="tok-mi">11</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-s">&quot;December&quot;</span><span class="tok-o">;</span>
        <span class="tok-k">default</span><span class="tok-o">:</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="hummel-primes" class="listingblock">
<div class="title">Listing 15. A relatively complex method with a cyclomatic complexity of 5. Taken from <a href="#hummel2014mccabe">[hummel2014mccabe]</a>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-nf">sumOfNonPrimes</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">limit</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-n">OUTER</span><span class="tok-o">:</span> <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">limit</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        	<span class="tok-k">continue</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">i</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">j</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">%</span> <span class="tok-n">j</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            	<span class="tok-k">continue</span> <span class="tok-n">OUTER</span><span class="tok-o">;</span>
             <span class="tok-o">}</span>
        <span class="tok-o">}</span>
        <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_coupling_between_objects_or_class_coupling">Coupling between objects or class coupling</h5>
<div class="paragraph">
<p>A class is coupled to another if the former uses a method or a field from the latter. Coupling between classes can not be avoided, it is, in fact, desirable. We create classes as functional units for reuse. At some point, existing classes will be leveraged to create new functionalities. However, coupling has important implications: changing a class most of the times will require changing its dependent classes. Therefore, tight coupling between classes harms modularity, makes a software too sensitive to change and harder to maintain <a href="#chidamber1994metrics">(43)</a> <a href="#fowler2001reducing">(44)</a>.</p>
</div>
<div class="paragraph">
<p><em>Class coupling</em> or <em>Coupling Between Objects</em> (CBO) of a class is the number of external classes it uses. In <a href="#coupling-example">Listing 16</a>, <code>Point</code> has CBO of 0. It only depends on <code>double</code> and the metric does not count primitive types. <code>Line</code>, on the other hand, depends on <code>Point</code> and has a CBO of 1. The metric counts only unique classes. In the example, <code>Line</code> uses <code>Point</code> several times, but it is counted only once.</p>
</div>
<div id="coupling-example" class="listingblock">
<div class="title">Listing 16. Two classes: <code>Point</code> as CB=0 coupling and <code>Line</code> 1.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">Point</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Point</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">x</span> <span class="tok-o">=</span> <span class="tok-n">x</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">y</span> <span class="tok-o">=</span> <span class="tok-n">y</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getX</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getY</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">y</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">dot</span><span class="tok-o">(</span><span class="tok-n">Point</span> <span class="tok-n">p</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">x</span><span class="tok-o">*</span><span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span><span class="tok-o">*</span><span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">y</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Point</span> <span class="tok-nf">sub</span><span class="tok-o">(</span><span class="tok-n">Point</span> <span class="tok-n">p</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">-</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">-</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">y</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Segment</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-n">Point</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nf">Segment</span><span class="tok-o">(</span><span class="tok-n">Point</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">Point</span> <span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">b</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">has</span><span class="tok-o">(</span><span class="tok-n">Point</span> <span class="tok-n">p</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Point</span> <span class="tok-n">pa</span> <span class="tok-o">=</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">sub</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">);</span>
        <span class="tok-n">Point</span> <span class="tok-n">ab</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">sub</span><span class="tok-o">(</span><span class="tok-n">b</span><span class="tok-o">);</span>
        <span class="tok-kt">double</span> <span class="tok-n">product</span> <span class="tok-o">=</span> <span class="tok-n">pa</span><span class="tok-o">.</span><span class="tok-na">dot</span><span class="tok-o">(</span><span class="tok-n">ab</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-mi">0</span> <span class="tok-o">&lt;=</span> <span class="tok-n">product</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">product</span> <span class="tok-o">&lt;=</span> <span class="tok-n">ab</span><span class="tok-o">.</span><span class="tok-na">dot</span><span class="tok-o">(</span><span class="tok-n">ab</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Classes with low CBO values, or loosely coupled are easier to reuse. Classes with large CBO values or tightly coupled should be avoided and refactored. If a tightly coupled class is necessary, then it requires rigorous testing to correctly verify how it interacts with all its dependencies.</p>
</div>
<div class="paragraph">
<p>Coupling could be measured not only at the class level but also between any modules at all granularity levels (<em>e.g.</em>, packages, components&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>The <em>Law of Demeter</em> (LoD)  or <em>principle of least knowledge</em> is a guideline aiming to keep classes loosely coupled <a href="#appleton_demeter">(46)</a>. Its idea is that any unit should only "<em>talk</em>" to "<em>its closest friends</em>" and not to "<em>strangers</em>". In the context of object-oriented programming, it means that a method can only invoke methods from the receiver (<code>this</code>), a parameter, an object instantiated in the method and an attribute of the class. <a href="#demeter-example">Listing 17</a> shows examples of violations of this principle.</p>
</div>
<div id="demeter-example" class="listingblock">
<div class="title">Listing 17. Examples of violations of the Law of Demeter.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Foo</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">example</span><span class="tok-o">(</span><span class="tok-n">Bar</span> <span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-n">C</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">getC</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>

       <span class="tok-n">c</span><span class="tok-o">.</span><span class="tok-na">doIt</span><span class="tok-o">();</span> <i class="conum" data-value="2"></i><b>(2)</b>

       <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">getC</span><span class="tok-o">().</span><span class="tok-na">doIt</span><span class="tok-o">();</span> <i class="conum" data-value="3"></i><b>(3)</b>

       <span class="tok-n">D</span> <span class="tok-n">d</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">D</span><span class="tok-o">();</span>
       <span class="tok-n">d</span><span class="tok-o">.</span><span class="tok-na">doSomethingElse</span><span class="tok-o">();</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Conforms to LoD</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Violates LoD as <code>c</code> was not created inside <code>example</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Chaining method invocations does not conform to LoD</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Conforms to LoD, as <code>d</code> was created inside the method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>LoD also has downsides. A strict adherence to its postulates may produce many unnecessary wrapper methods. In <a href="#demeter-example">Listing 17</a> the class <code>Bar</code> should had a wrapper method <code>doItInC</code> whose code could be <code>this.getC().doIt()</code> or something alike. This kind of wrapper would be widespread in the code and it could become a challenge for maintenance. On the other hand, fluent APIs encourage the use of method chains, which also tends to improve readability.</p>
</div>
</div>
<div class="sect4">
<h5 id="_class_cohesion">Class cohesion</h5>
<div class="paragraph">
<p>A class in an object-oriented program, or a module in general, is expected to have a responsibility over a single and well defined part of the software&#8217;s functionalities. All services/methods of the module/class should be aligned with this responsibility and this responsibility should be entirely encapsulated in the class. This ensures that the module/class is only changed when the requirements concerning the specific responsibility change. Changes to different requirements should not make a single class to change <a href="#martin2006agile">(47)</a> <a href="#martin2014single">(48)</a>. This is known as the The <em>Single Responsibility Principle</em> and it was coined by Robert C. Martin in the late 1990&#8217;s. This principle puts the <strong>S</strong> in the <strong>SOLID</strong> principles of object-oriented programming.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The SOLID principles of object-oriented programming are: <strong>S</strong>: Single Responsibility Principle, <strong>O</strong>: Open/Closed Principle, <strong>L</strong>: Liskov&#8217;s Substitution Principle, <strong>I</strong>: Interface Segregation Principle and <strong>D</strong>: Dependency Inversion Principle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a class violates this principle, then it can probably be divided in two or more classes with different responsibilities. In this case we say that the class lacks <em>cohesion</em>. In a more concrete view, a cohesive class performs different operations on the same set of instance variables <a href="#chidamber1994metrics">(43)</a>.</p>
</div>
<div class="paragraph">
<p>There are several metrics to evaluate cohesion in classes, but most of them are based in the <em>Lack of Cohesion Of Methods</em> (LCOM) <a href="#chidamber1994metrics">(43)</a>. This metric is defined as follows:</p>
</div>
<div class="paragraph">
<p>Let \$C\$ be a class with \$n\$ methods: \$M_1, ..., M_n\$, let \$I_j\$ the set of instance variables used by the method \$M_j\$. Let \$P = { (I_i, I_j) | I_i \cap I_j = \emptyset, i \gt j }\$, that is, the pairs of methods that use disjoint sets of instance variables, and \$Q = { (I_i, I_j) | I_i \cap I_j \ne \emptyset, i \gt j}\$, all pairs of methods using at least one instance variable in common. Then \$\text{LCOM}(C) = |P| - |Q| \text{ if } |P| \gt |Q| \text{ 0} \text{ otherwise}\$.</p>
</div>
<div class="paragraph">
<p>This means that <em>LCOM</em> is equal to the number of pairs of methods using a disjoint set of instance variables minus the number of pairs of methods using variables in common. If the class has more methods using disjoint sets of instance variables then it is less cohesive. A class is cohesive if its methods use the same variables to compute different things. Low values of LCOM are preferred.</p>
</div>
<div class="paragraph">
<p><a href="#variables-methods-point">Table 2</a> shows the set of all instance variables used by each method declared in the <code>Point</code> class shown in <a href="#coupling-example">Listing 16</a>. Constructors are not used to compute this metric, as their role is to initialize the variables and they virtually access all of them. In this particular example, all methods use the instance variables directly. However, a method could use an instance variable indirectly by invoking other methods.  In that case, the variables are also said to be used by the initial method. For example, any new method invoking <code>getX</code> in <code>Point</code> would also use variable <code>x</code>.</p>
</div>
<table id="variables-methods-point" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Set of instance variables used by each method of the class <code>Point</code> shown in <a href="#coupling-example">Listing 16</a>.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Instance variables</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>x</code> }</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>y</code> }</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>x</code>, <code>y</code> }</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sub</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>x</code>, <code>y</code> }</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#intersection-methods-point">Table 3</a> shows the instance variables used un common for all pairs of methods declared in <code>Point</code>. Only <code>getX</code> and <code>getY</code> do not use any variable in common.</p>
</div>
<table id="intersection-methods-point" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Intersection of instance variables used by all pairs of methods in <code>Point</code>.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><code>getX</code></th>
<th class="tableblock halign-left valign-top"><code>getY</code></th>
<th class="tableblock halign-left valign-top"><code>dot</code></th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><code>sub</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>x</code> }</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>y</code> }</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>x</code>, <code>y</code> }</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><code>dot</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>x</code> }</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ <code>y</code> }</p></td>
<th class="tableblock halign-left valign-top"></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><code>getY</code></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">\$\emptyset\$</p></td>
<th class="tableblock halign-left valign-top" colspan="2"></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Given that we obtain: \$ | P | =  | \{ (I_\text{getX},I_\text{getY}) \} | = 1 \$ and: \$ | Q | = | \{ (I_\text{getX},I_\text{sub}), (I_\text{getX},I_\text{dot}), (I_\text{getY},I_\text{sub}), (I_\text{getY},I_\text{dot}), (I_\text{dot},I_\text{sub}) \} | = 4\$ producing: \$ \text{LCOM}(C) = 0 \$ as \$ | P | \lt | Q | \$. Which means that the <code>Point</code> class is cohesive, its carries the responsibility to represent the concept of a two-dimensional point. Only a change in the requirements of this representation will make this class change.</p>
</div>
<div class="paragraph">
<p>Lack of cohesion implies that a class violates the principle of single functionality and could be split in two different classes. <a href="#cohesion-example">Listing 18</a> shows the <code>Group</code> class. The only two methods in this class use a disjoint set of fields. <code>compareTo</code> uses <code>weight</code> while <code>draw</code> uses <code>color</code> and <code>name</code>. Computing the metric we get: \$\text{LCOM}(C = |P| - |Q| = 1 - 0 = 1\$.</p>
</div>
<div id="cohesion-example" class="listingblock">
<div class="title">Listing 18. Example of a non-cohesive class. <code>compareTo</code> and <code>weight</code> could be separated from the rest.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">Group</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">Color</span> <span class="tok-n">color</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Group</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">Color</span> <span class="tok-n">color</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">weight</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">color</span> <span class="tok-o">=</span> <span class="tok-n">color</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">compareTo</span><span class="tok-o">(</span><span class="tok-n">Group</span> <span class="tok-n">other</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">weight</span> <span class="tok-o">-</span> <span class="tok-n">other</span><span class="tok-o">.</span><span class="tok-na">weight</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">draw</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Screen</span><span class="tok-o">.</span><span class="tok-na">rectangle</span><span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">,</span> <span class="tok-n">name</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Tight Class Cohesion</em> (TCC) and <em>Loose Class Cohesion</em> (LCC) are other two well known and used metrics to evaluate the cohesion of a class <a href="#bieman1995cohesion">(49)</a>. Both these metrics start by creating a graph from the class. The graph is constructed as follows: Given a class <code>C</code>, each method <code>m</code> declared in the class becomes a node. Given any two methods <code>m</code> and <code>n</code> declared in <code>C</code> we add an edge between <code>m</code> and <code>n</code> if and only if, <code>m</code> and <code>n</code> use at least one instance variable in common. Going back to the definition of <code>LCOM</code>, we add an edge between <code>m</code> and <code>n</code> if \$I_{m,n} \ne \emptyset\$. TCC is defined as the ratio of directly connected pairs of node in the graph to the number or all pairs of nodes. On its side, LCC is the number of pairs of connected (directly or indirectly) nodes to all pairs of node. As before, constructors are not used.</p>
</div>
<div class="paragraph">
<p><a href="#cohesion-graph">Figure 8</a> shows the graph that results from the class <code>Point</code>. In this example, \$\text{TCC = 5/6 = 0.83\$ as there are 5 direct connections and only 6 method pairs. On the other hand \$\text{LCC} = 6/6 = 1\$ as all pairs of methods are indirectly or directly connected. For the <code>Group</code> class both LCC and TCC are 0, as no method is connected to the other.</p>
</div>
<div id="cohesion-graph" class="imageblock">
<div class="content">
<img src="images/cohesion-graph.png" alt="cohesion graph" width="275" height="251">
</div>
<div class="title">Figure 8. Description</div>
</div>
<div class="paragraph">
<p>In object-oriented programs a class may inherit methods and instance variables from its base classes. In those cases, computing the cohesion of a subclass may: include only inherited methods, only inherited fields, or both. The original definition of TCC and LCC leaves this inclusion open to the users of the metrics <a href="#bieman1995cohesion">(49)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_analysis">2.2. Static analysis</h3>
<div class="paragraph">
<p>Enforcing coding guidelines, detecting code smells and computing code metrics, can and <strong>should be</strong> automated. All these goals can be achieved by inspecting the code without executing the program. This is known as <em>static analysis</em>. Any form of static analysis takes as input the code of a program. It may be a high level code, such as Python, or Java, or it could also target compiled code as the JVM bytecode. The static inspection of code also enables the early detection of problems like cyclic dependencies, potential null pointer exceptions, buffer overflows. Since it does not require the execution of the program, static analysis is, in most cases, very efficient in terms of computation time.</p>
</div>
<div class="paragraph">
<p>There are plenty of tools available that can perform many types of static analysis. Some of them are highly configurable to, for example, select the coding guidelines a team wants to enforce. Many of these tools are also extensible and may allow the incorporation of new metrics, code smell definitions and other unforeseen functionalities. There are also libraries that make it easy to implement custom static analysis tools. This section presents some of these libraries and tools for Java.</p>
</div>
<div class="sect3">
<h4 id="_implementing_a_static_analysis">2.2.1. Implementing a static analysis</h4>
<div class="paragraph">
<p>Most code analyses start with the two same initial phases of a compiler: the lexicographic and syntactic analyses.</p>
</div>
<div class="paragraph">
<p>Given a source code, say in Java as the one in <a href="#static-analysis-example">Listing 19</a>, a lexicographical analyzer, lexer, or scanner, groups together sequences of characters. These sequences are usually associated with a type  and are called <em>tokens</em>. The lexer produces as output a sequence of tokens.</p>
</div>
<div id="static-analysis-example" class="listingblock">
<div class="title">Listing 19. A simple Java class.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">method</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Hello&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#tokens">Listing 20</a> shows the first tokens produced by a lexer for the code in <a href="#static-analysis-example">Listing 19</a>. A lexer also removes characters that are not needed for subsequent phases like white spaces and comments.</p>
</div>
<div id="tokens" class="literalblock">
<div class="title">Listing 20. First tokens produced for <a href="#static-analysis-example">Listing 19</a></div>
<div class="content">
<pre>("class", CLASS_KEYWORD)
("A", IDENTIFIER)
("{", "OPEN_BRACE")
("public", PUBLIC_KEYWORD)
("void", VOID_KEYWORD)
("method", IDENTIFIER)</pre>
</div>
</div>
<div class="paragraph">
<p>The sequence of tokens is used as input for the syntactic analysis where a <em>parser</em> checks that the order of the tokens is correct with respect to a formal specification or grammar and builds an <em>Abstract Syntax Tree</em> (AST). An AST is a hierarchical representation of the source code. The nodes represent the elements in the code in a way that, for example, nodes representing classes have children representing methods and fields, and nodes representing methods contain nodes representing instructions. The AST does not contain purely syntactical elements such as semicolons or braces. <a href="#ast-example">Figure 9</a> shows a simplified version of an AST for the code in <a href="#static-analysis-example">Listing 19</a>.</p>
</div>
<div id="ast-example" class="imageblock">
<div class="content">
<img src="images/ast-example.png" alt="ast example" width="456" height="539">
</div>
<div class="title">Figure 9. Description</div>
</div>
<div class="paragraph">
<p>Most static analyses are implemented by tracing the AST and most implementations are based on the visitor pattern. The visitor pattern abstracts the operations to be performed over an object structure <a href="#gamma1994design">(50)</a>. Each operation is implemented as a visitor. The structure is traversed and each visitor is selected according to the elements of the structure that is being visited. In the case of a static analysis over an AST, each visitor could be a class or a method, designed to operate over a specific type of node, for example, a class will be handled by a <em>class visitor</em>. The static analysis is then carried by the joint actions of these visitors.</p>
</div>
<div class="paragraph">
<p>There are libraries that facilitate the implementation of static analyses by accomplishing the construction of the AST and even providing abstractions to implement the visitor pattern. For Java sources two of the most famous are <a href="http://spoon.gforge.inria.fr/">Spoon</a> and <a href="https://javaparser.org/">JavaParser</a>. There are other libraries that offer similar functionalities but targeting compiled code. One most famous JVM bytecode analysis tool is <a href="https://asm.ow2.io/">ASM</a>.</p>
</div>
<div class="sect4">
<h5 id="_using_javaparser">Using JavaParser</h5>
<div class="paragraph">
<p>This section explains how to implement a simple static analysis tool using JavaParser. As a library, JavaParser provides a hierarchy of classes to represent ASTs for Java programs and implementations of the visitor pattern to help analyze and transform those ASTs.</p>
</div>
<div class="paragraph">
<p><a href="#javaparser-classes">Figure 10</a> shows a selection of classes representing AST nodes. <code>Node</code> is the base class of the hierarchy. The instances of <code>ClassOrInterfaceDeclaration</code> represent declarations of classes and interfaces in the program. These nodes contain information about the type parameters, base class and interfaces implemented in the corresponding declaration. <code>ClassOrInterfaceDeclaration</code> inherits from the more general <code>TypeDeclaration</code>, which contains, among other properties, a <code>name</code>. <code>TypeDeclaration</code> inherits from <code>BodyDeclaration</code> which is also the base class for all elements that could be included in the body of a type declaration. <code>Expression</code> is the super class of all abstractions of expressions as it is the case for <code>MethodCallExpr</code> and <code>FieldAccessExpr</code>. Both these classes contain information about the scope or receiver of the method call or the field access, as well as the name of the method or the field. <code>MethodCallExpr</code> also provides information about the arguments. On its side,<code>Statement</code> is the base class for all types representing statements in the program, as it is the case of the <code>IfSmt</code>. This last class has an <code>Expression</code> representing the condition and two <code>Statement</code> instances for the <em>then</em> and <em>else</em> branches of the conditional statement.</p>
</div>
<div id="javaparser-classes" class="imageblock">
<div class="content">
<img src="images/javaparser-classes.png" alt="javaparser classes" width="863" height="479">
</div>
<div class="title">Figure 10. Extract of the class hierearchy representing AST nodes in JavaParser</div>
</div>
<div class="paragraph">
<p>The visitor pattern is implemented in JavaParser by the interfaces <code>VoidVisitor</code> (<a href="#voidvisitor-javaparser">Listing 21</a>) and <code>GenericVisitor</code> (<a href="#genericvisitor-javaparser">Listing 22</a>). Both interfaces are very similar. They both contain <code>visit</code> methods for all concrete classes representing AST nodes. In the former interface these methods are <code>void</code> while the latter allows to return a value. This is the only difference. All <code>visit</code> overloads also accept an <code>arg</code> parameter to share information among nodes in the traversal of the AST.</p>
</div>
<div id="voidvisitor-javaparser" class="listingblock">
<div class="title">Listing 21. An extract of the <code>VoidVisitor</code> class in JavaParser.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">VoidVisitor</span><span class="tok-o">&lt;</span><span class="tok-n">A</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

    <span class="tok-o">...</span>

    <span class="tok-kt">void</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">ClassOrInterfaceDeclaration</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-kt">void</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">IfStmt</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-kt">void</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">MethodCallExpr</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-kt">void</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">FieldAccessExpr</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-o">...</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="genericvisitor-javaparser" class="listingblock">
<div class="title">Listing 22. An extract of the <code>GenericVisitor</code> class in JavaParser.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">GenericVisitor</span><span class="tok-o">&lt;</span><span class="tok-n">R</span><span class="tok-o">,</span> <span class="tok-n">A</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>

    <span class="tok-n">R</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">ClassOrInterfaceDeclaration</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-n">R</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">IfStmt</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-n">R</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">MethodCallExpr</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-n">R</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">FieldAccessExpr</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">);</span>

    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no need to directly implement these two interfaces. The library also provides some default implementations to ease reuse. For example, <code>VoidVisitorAdapter</code> and <code>GenericVisitorAdapter</code> implement the visitor interfaces and perform a depth-first traversal of the AST. A new visitor could extend one of these adapter classes and just redefine the <code>visit</code> overloads it actually needs and not all of them. <code>ModifierVisitor</code> enables a similar reuse, but specialized on the use case where the AST should be modified. <a href="#modifiervisitor-javaparser">Listing 23</a> shows a fragment of the code of this class implementing the <code>visit</code> method overload for <code>IfStmt</code>.</p>
</div>
<div id="modifiervisitor-javaparser" class="listingblock">
<div class="title">Listing 23. An extract of the <code>ModifierVisitor</code> class in JavaParser.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ModifierVisitor</span><span class="tok-o">&lt;</span><span class="tok-n">A</span><span class="tok-o">&gt;</span> <span class="tok-kd">implements</span> <span class="tok-n">GenericVisitor</span><span class="tok-o">&lt;</span><span class="tok-n">Visitable</span><span class="tok-o">,</span> <span class="tok-n">A</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-n">Visitable</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">IfStmt</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-kd">final</span> <span class="tok-n">A</span> <span class="tok-n">arg</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Expression</span> <span class="tok-n">condition</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Expression</span><span class="tok-o">)</span> <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">getCondition</span><span class="tok-o">().</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">arg</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-n">Statement</span> <span class="tok-n">elseStmt</span> <span class="tok-o">=</span> <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">getElseStmt</span><span class="tok-o">().</span><span class="tok-na">map</span><span class="tok-o">(</span><span class="tok-n">s</span> <span class="tok-o">-&gt;</span> <span class="tok-o">(</span><span class="tok-n">Statement</span><span class="tok-o">)</span> <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">arg</span><span class="tok-o">)).</span><span class="tok-na">orElse</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-n">Statement</span> <span class="tok-n">thenStmt</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Statement</span><span class="tok-o">)</span> <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">getThenStmt</span><span class="tok-o">().</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">arg</span><span class="tok-o">);</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-n">Comment</span> <span class="tok-n">comment</span> <span class="tok-o">=</span> <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">getComment</span><span class="tok-o">().</span><span class="tok-na">map</span><span class="tok-o">(</span><span class="tok-n">s</span> <span class="tok-o">-&gt;</span> <span class="tok-o">(</span><span class="tok-n">Comment</span><span class="tok-o">)</span> <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">arg</span><span class="tok-o">)).</span><span class="tok-na">orElse</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">);</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">condition</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">||</span> <span class="tok-n">thenStmt</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
        <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">setCondition</span><span class="tok-o">(</span><span class="tok-n">condition</span><span class="tok-o">);</span> <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">setElseStmt</span><span class="tok-o">(</span><span class="tok-n">elseStmt</span><span class="tok-o">);</span>
        <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">setThenStmt</span><span class="tok-o">(</span><span class="tok-n">thenStmt</span><span class="tok-o">);</span>
        <span class="tok-n">n</span><span class="tok-o">.</span><span class="tok-na">setComment</span><span class="tok-o">(</span><span class="tok-n">comment</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">n</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The condition expression is visited and the result is stored in <code>condition</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <em>else</em> part is visited and the result is stored in <code>elseStmt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <em>then</em> part is visited and the result is stored in <code>thenStmt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If there is any comment associated to the statement, it is also visited.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In the case there is no valid result for the mandatories condition and <em>then</em> part, the result is <code>null</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Otherwise the node is updated with the result from visiting the children elements and the method returns its reference.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the help of JavaParser we will implement a small tool to enforce a coding convention. In Java, and many other languages, it is optional to use braces (<code>{}</code>) in loops and conditionals if the body contains only one statement. For example, it is not easy to see that the <code>else</code> belongs to the inner conditional statement in <a href="#dangling-else">Listing 24</a>. Also it is easy to missplace code when not using the braces.</p>
</div>
<div id="dangling-else" class="listingblock">
<div class="title">Listing 24. Not using braces can harm readability.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>
<span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">m</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">boolean</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;one&quot;</span><span class="tok-o">);</span> <span class="tok-k">else</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;two&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>ModifierVisitor</code> as base, we will implement a visitor that modifies the AST so that the <em>then</em> and <em>else</em> parts of all conditional statements are enclosed in braces, that is, the statements must be contained in a block. The implementation of this custom visitor is shown in <a href="#blockenforcer-javaparser">Listing 25</a>. The <code>BlockEnforcer</code> traverses the AST and modifies only <code>IfStmt</code> nodes. It ensures that each <em>then</em> and <em>else</em> parts are instances of <code>BlockStmt</code>. Notice the use of <code>Void</code> as a type parameter for the implementation as no extra information will be passed between nodes.</p>
</div>
<div id="blockenforcer-javaparser" class="listingblock">
<div class="title">Listing 25. A JavaParser visitor to enforce the use of blocks in conditional statements.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BlockEnforcer</span> <span class="tok-kd">extends</span> <span class="tok-n">ModifierVisitor</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-n">Visitable</span> <span class="tok-nf">visit</span><span class="tok-o">(</span><span class="tok-n">IfStmt</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">Void</span> <span class="tok-n">arg</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">IfStmt</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">IfStmt</span><span class="tok-o">)</span> <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">visit</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">arg</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">result</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">setThenStmt</span><span class="tok-o">(</span><span class="tok-n">enforceBlockOn</span><span class="tok-o">(</span><span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">getThenStmt</span><span class="tok-o">()));</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">getElseStmt</span><span class="tok-o">().</span><span class="tok-na">ifPresent</span><span class="tok-o">(</span><span class="tok-n">statement</span> <span class="tok-o">-&gt;</span>
                <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">setElseStmt</span><span class="tok-o">(</span><span class="tok-n">enforceBlockOn</span><span class="tok-o">(</span><span class="tok-n">statement</span><span class="tok-o">)));</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Statement</span> <span class="tok-nf">enforceBlockOn</span><span class="tok-o">(</span><span class="tok-n">Statement</span> <span class="tok-n">stmt</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">stmt</span><span class="tok-o">.</span><span class="tok-na">isBlockStmt</span><span class="tok-o">())</span> <span class="tok-o">{</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="tok-k">return</span> <span class="tok-n">stmt</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-n">BlockStmt</span> <span class="tok-n">block</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BlockStmt</span><span class="tok-o">();</span> <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="tok-n">block</span><span class="tok-o">.</span><span class="tok-na">addStatement</span><span class="tok-o">(</span><span class="tok-n">stmt</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">block</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Perform the original traversal and propagate the analysis to the children elements.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Return <code>null</code> if the result from the children is also <code>null</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Enforce a block in the <em>then</em> part.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enforce a block in the <em>else</em> part if present.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>enforceBlockOn</code> takes a statement and returns a block.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Do nothing if the initial statement is already a block.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Otherwise, create a new <code>BlockStmt</code> containing the initial statement.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#blockenforcer-usage">Listing 26</a> shows how to use <code>BlockEnforcer</code> to analyze a single Java file. The first step is to obtain an instance of <code>CompilationUnit</code>. A compilation unit in Java is a file that optionally declares a package and contains an arbitrary number of imports and type declarations. <code>StaticJavaParser</code> provides shortcut methods to get such objects from common <code>String</code>, <code>InputStream</code>, <code>Reader</code> and <code>File</code> inputs. Then the visitor is applied through the <code>accept</code> method. This snippet prints on the screen the result of the analysis by invoking the <code>toString</code> method of <code>CompilationUnit</code>. The result cane be also saved to a file or we can even rewrite the original source code.</p>
</div>
<div id="blockenforcer-usage" class="listingblock">
<div class="title">Listing 26. Using <code>BlockEnforcer</code> to analyze a single Java file.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">CompilationUnit</span> <span class="tok-n">unit</span> <span class="tok-o">=</span> <span class="tok-n">StaticJavaParser</span><span class="tok-o">.</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">unit</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">BlockEnforcer</span><span class="tok-o">(),</span> <span class="tok-kc">null</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">unit</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtain a <code>CompilationUnit</code> instace. <code>input</code> could be a <code>String</code>, <code>Reader</code>, <code>InputStream</code> or <code>File</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The compilation unit is visited to start the analysis.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The result is printed to the screen.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When given the code in <a href="#dangling-else">Listing 24</a>, <a href="#blockenforcer-usage">Listing 26</a> produces <a href="#blockenforcer-result">Listing 27</a> as result.</p>
</div>
<div id="blockenforcer-result" class="listingblock">
<div class="title">Listing 27. Result of the analysis when given <a href="#dangling-else">Listing 24</a> as input.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">m</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">boolean</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
        <span class="tok-kt">boolean</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;one&quot;</span><span class="tok-o">);</span>
            <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;two&quot;</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, JavaParser also includes functionalities to analyze a full Java project and more. Further information can be found in <a href="https://javaparser.org/">the project&#8217;s website</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tools_for_static_analysis">2.3. Tools for static analysis</h3>
<div class="paragraph">
<p>There are plenty of static analysis tools for all languages and frameworks. Compilers are the first of such tools we use. They rely on static analysis to check the syntactic and semantic validity of the program. Compilers may also detect unreachable code, unused variables and potential conversion errors.</p>
</div>
<div class="paragraph">
<p>Other tools, often called <em>linters</em>, help improve the quality of the program by detecting code smells, proposing code improvements and enforcing coding guidelines. In most cases they are highly customizable and extensible so each team, project or company can adapt the linter&#8217;s functionalities to their own practices and goals. The term linter comes from <em>lint</em>  a tool conceived to analyze portability issues for C programs back in the 70&#8217;s.</p>
</div>
<div class="paragraph">
<p>For Java, the most popular alternatives are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://errorprone.info/index">Error Prone</a>: Detects common bug patterns and proposes potential fixes. For example, the tool is able to detect wrong printf-style formats used in the code.</p>
</li>
<li>
<p><a href="https://spotbugs.github.io/">SpotBugs</a>: Also finds known bug patterns and bad practices, but targets the compiled bytecode instead of the source code. For example, it can propose use a more efficient equivalent method such as use <code>Integer.valueOf</code> instead of <code>new Integer</code>.</p>
</li>
<li>
<p><a href="https://checkstyle.sourceforge.io/">checkstyle</a>: Detects coding guideline violations. For example, it checks that a class with only one private constructor is declared as final, as it can not be extended anyways.</p>
</li>
<li>
<p><a href="https://pmd.github.io/">PMD</a>: A cross-language static analysis tool able to detect code smells, compute code metrics, and detect guideline violations. For example, it computes the Cyclomatic Complexity of a method and the Tight Class Cohesion (TCC) as seen before. It can also recommend, for example, when to replace a <code>for</code> by a <code>foreach</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the tools mentioned above are able to detect several hundreds of know bug patterns, code smells and bad practices. They are also configurable and extensible via plugins.</p>
</div>
<div class="sect3">
<h4 id="_using_and_extending_pmd">2.3.1. Using and extending PMD</h4>
<div class="paragraph">
<p>PMD is one of the most complete alternatives available. It uses a huge and modifiable set of rule definitions to detect code patterns representing code smells and potential bugs. It can be extended with custom rules and metrics. This section shows how to use PMD and how to extend it.</p>
</div>
<div class="paragraph">
<p>The tool can be freely downloaded from its website as a zip file. This file contains the PMD program itself and the files corresponding to the rule definitions. It can be used from the command line as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>&lt;path-to-pmd-folder&gt;/bin/run.sh pmd -d &lt;path-to-java-file&gt; -f text -R &lt;path-to-rule-definition&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The line above runs PMD over a single Java file using a single rule definition file and outputs the result to the console in plain text.</p>
</div>
<div class="paragraph">
<p><a href="https://pmd.github.io/latest/pmd_rules_java.html">The PMD documentation</a> contains a comprehensive list of all rules PMD includes for Java. These rules are sorted into categories according to their nature. For example, the <em>Design</em> category contains rules that discover design issues. One of the rules inside this category is <code>AbstractClassWithoutAnyMethod</code>. As it name indicates, it finds and signals abstract classes without any declared method. The rationale behind this rule is that the abstract modifier has been added so no instance of this class can be created. In that case, it is better to have a private constructor.</p>
</div>
<div class="paragraph">
<p>Let the code in <a href="#silly-class">Listing 28</a> be the content of <code>SillyClass.java</code>.</p>
</div>
<div id="silly-class" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">SillyClass</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">field</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule can be invoked as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>&lt;path-to-pmd-folder&gt;/bin/run.sh pmd -d SillyClass.java -f text -R category/java/design.xml/AbstractClassWithoutAnyMethod</code></pre>
</div>
</div>
<div class="paragraph">
<p>See that <code>category/java/design.xml</code> is an internal PMD route to the <code>design.xml</code> which contains the definition of all rules targeting design issues in Java.</p>
</div>
<div class="paragraph">
<p>In the <em>Error Prone</em> category, PMD includes the <code>CloseResource</code> rule. This rule finds code where resources are not properly closed. As an example in <a href="#connection-not-closed">Listing 29</a> the <code>Bar</code> class does not close the <code>Connection</code> resource. PMD signals an error when passed this code to the <code>CloseResource</code> rule. The solution is to call <code>c.close()</code> in a <code>finally</code> block.</p>
</div>
<div id="connection-not-closed" class="listingblock">
<div class="title">Listing 29. <code>Connection</code> is not closed.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Bar</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">foo</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Connection</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">pool</span><span class="tok-o">.</span><span class="tok-na">getConnection</span><span class="tok-o">();</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-c1">// do stuff</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">SQLException</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-c1">// handle exception</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>CloseResource</code> rule is used in the code from <a href="#close-resource-method">Listing 30</a>, PMD will report an error even when the connection is effectively closed in another method. The tool fails to see that the resource is closed in <code>bar</code> as the rule matching does not go beyond the code of <code>foo</code>. PMD does not analyze how methods invoke each other, probably to keep the analysis and rule matching simple and scalable.</p>
</div>
<div class="paragraph">
<p>We can consider tools like PMD as an algorithm that classifies a piece of code into <em>issue</em> and <em>not issue</em>. In this sense,  <a href="#close-resource-method">Listing 30</a> is an example of a <em>false positive</em>, that is, an error reported by PMD in a situation where the problem does not occur.</p>
</div>
<div id="close-resource-method" class="listingblock">
<div class="title">Listing 30. <code>Connection</code> is closed in another method but PMD still produces an error.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Bar</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">foo</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Connection</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">pool</span><span class="tok-o">.</span><span class="tok-na">getConnection</span><span class="tok-o">();</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-c1">// do stuff</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">SQLException</span> <span class="tok-n">ex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-c1">// handle exception</span>
        <span class="tok-o">}</span> <span class="tok-k">finally</span> <span class="tok-o">{</span>
            <span class="tok-n">bar</span><span class="tok-o">(</span><span class="tok-n">c</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">bar</span><span class="tok-o">(</span><span class="tok-n">Connection</span> <span class="tok-n">c</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">c</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CloseResource</code> rule signals no error when given the code in <a href="#stream-example">Listing 31</a> as input. However, in this code it is clear that, if an exception is thrown, the resource will not be closed. This is an example of a <em>false negative</em>: no issue was signaled by the tool, when there is actually one.</p>
</div>
<div id="stream-example" class="listingblock">
<div class="title">Listing 31. A piece of code where the resource is not always closed.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Stream</span> <span class="tok-o">{</span>
    <span class="tok-n">BufferedReader</span> <span class="tok-n">reader</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">readData</span><span class="tok-o">()</span>  <span class="tok-o">{</span>
        <span class="tok-k">try</span> <span class="tok-o">{</span>
            <span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
            <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">line</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">parseLine</span><span class="tok-o">(</span><span class="tok-n">line</span><span class="tok-o">));</span>
                <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">reader</span><span class="tok-o">.</span><span class="tok-na">readLine</span><span class="tok-o">();</span>
            <span class="tok-o">}</span>
            <span class="tok-n">reader</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If the code above throws an exception the resource is never closed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>PMD searches for patterns in the source code and these patterns may not include all cases, as seen in the two examples above. This is a limitation of static analysis in general. The code is not executed, therefore no dynamic behavior is considered, as in the case of <a href="#stream-example">Listing 31</a> where the issue is influenced by the input of the user.</p>
</div>
<div class="paragraph">
<p>It is possible to extend PMD with new rule and metric definitions. This is useful to accommodate PMD to custom requirements. For example, a team can define their own set of rules to reflect their best practices when using third party library or framework like <a href="http://hibernate.org/">Hibernate</a> or <a href="https://spring.io/">Spring</a>.</p>
</div>
<div class="paragraph">
<p>PMD provides a complete API to implement custom rules and metrics. As with the libraries discussed before, this API relies on a visitor pattern over the AST of the source code. Defining new metrics or rules this way is very similar to what can be done with JavaParser.</p>
</div>
<div class="paragraph">
<p>However, there is another simpler alternative that does not require to program a new rule. As long as the rule requires only to query the AST looking for patterns, it could be written using XPath.</p>
</div>
<div class="paragraph">
<p>XPath stands for <em>XML Path Language</em>. It is a language used to express queries selecting nodes in an XML document based on their relationship with their ancestors, descendants and the value of their attributes. An XML document is, in fact, a tree. Therefore it does not require any special adaptation to use XPath and select nodes from an AST. PMD allows to define rules in this way.</p>
</div>
<div class="paragraph">
<p>A rule defined using XPath consists in a selection query. If the query finds a match, then an error is reported. Retaking the example of <code>BlockEnforcer</code> to signal that a conditional statement must use braces, the query would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>//IfStatement/Statement[not(./Block)]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>//IfStatement/Statement</code> matches the direct <code>Statement</code> children of any <code>IfStatement</code> node, this matches the <em>then</em> and <em>else</em> children nodes. <code>not(./Block)</code> matches no direct descendant of type <code>Block</code>. So the entire expression matches conditionals whose <em>then</em> and <em>else</em> nodes do not have a direct <code>Block</code> descendant.</p>
</div>
<div class="paragraph">
<p>The rule must be specified in an XMl file. Those files may contain definitions of more than one rule. The full code for this example is shown in <a href="#custom-rule-definition">Listing 32</a>.</p>
</div>
<div id="custom-rule-definition" class="listingblock">
<div class="title">Listing 32. Full definition of a PMD custom rule using XPath.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>

<span class="tok-nt">&lt;ruleset</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Custom Rules&quot;</span>
    <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://pmd.sourceforge.net/ruleset/2.0.0&quot;</span>
    <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://pmd.sourceforge.net/ruleset/2.0.0 http://pmd.sourceforge.net/ruleset_2_0_0.xsd&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;description&gt;</span>
        Custom rules
    <span class="tok-nt">&lt;/description&gt;</span>
    <span class="tok-nt">&lt;rule</span>
    <span class="tok-na">name=</span><span class="tok-s">&quot;MandatoryBracesOnIf&quot;</span>
    <span class="tok-na">language=</span><span class="tok-s">&quot;java&quot;</span>
    <span class="tok-na">message=</span><span class="tok-s">&quot;Then and else parts of a conditional statement must be enclosed by braces&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;net.sourceforge.pmd.lang.rule.XPathRule&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;description&gt;</span>
        Then and else parts not enclosed by braces in a conditional statement
        may harm readability and facilitate the introduction of bugs.
    <span class="tok-nt">&lt;/description&gt;</span>
    <span class="tok-nt">&lt;priority&gt;</span>3<span class="tok-nt">&lt;/priority&gt;</span>
    <span class="tok-nt">&lt;properties&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;xpath&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;value&gt;</span><span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">            //IfStatement/Statement[not(./Block)]</span>
<span class="tok-cp">        ]]&gt;</span><span class="tok-nt">&lt;/value&gt;</span>
        <span class="tok-nt">&lt;/property&gt;</span>
    <span class="tok-nt">&lt;/properties&gt;</span>
    <span class="tok-nt">&lt;/rule&gt;</span>
<span class="tok-nt">&lt;/ruleset&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_analysis_in_the_development_process">2.4. Static analysis in the development process</h3>
<div class="paragraph">
<p>There are several ways to include linters and other static analysis tools in the development process. Most Integrated Development Environments (IDE) such as <a href="https://www.eclipse.org/eclipseide/">Eclipse</a> or <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> and code editors like <a href="https://atom.io/">Atom</a> or <a href="https://code.visualstudio.com/">Visual Studio Code</a>, support them and even have them preinstalled out-of-the-box. IDE integration allows programmers to obtain instant feedback while coding.</p>
</div>
<div class="paragraph">
<p>Such tools can also be integrated in the compiling or building process. Utilities like <a href="https://maven.apache.org/">Maven</a> or <a href="https://gradle.org/">Gradle</a> permit the addition of custom build actions through plugins. Static analysis tools could be incorporated to the process as plugins and even make the build fail under certain conditions. In fact, there is already a <a href="https://maven.apache.org/plugins/maven-pmd-plugin/index.html">PMD Maven plugin</a>. With this plugin it is possible to generate a full report of issues discovered by PMD in the code of a project. This report could be exported in human readable formats like HTML or files adapted for automation like CSV and XML. The plugin can be configured with a selection of rules and provide means to make the build fail if there are issues with a given level of severity. As with any Maven plugin, this one can be attached to a build step so, for example, it is launched every time the compilation process starts without having to invoke the plugin directly.</p>
</div>
<div class="paragraph">
<p>Most projects are not developed by a single person. Projects are regularly built by a team of developers that may not even use the same development environment and may have different coding practices. Static analysis tools become then great allies to find potential issues and to keep the code understandable. In those cases, these tools may be better used with the help of <em>Continuous Integration</em> (CI) servers. These servers, like <a href="https://www.jenkins.io/">Jenkins</a> or <a href="https://travis-ci.org/">Travis</a> monitor the code repositories and execute the analysis tools on every commit or for pull requests (<a href="#sa-integration-diagram">Figure 11</a>). In this way all new additions to the project are automatically inspected. Integration could even go further and automatically report all the issues that were found in the new code. Major source hosting services provide their own CI solutions like <a href="https://github.com/features/actions">Github Actions</a> and <a href="https://docs.gitlab.com/ee/ci/">Gitlab CI</a> that are a good fit for this kind of integration scenario.</p>
</div>
<div id="sa-integration-diagram" class="imageblock text-center">
<div class="content">
<img src="images/sa-integration-diagram.png" alt="PMD&#8217;s CI integration" width="600">
</div>
<div class="title">Figure 11. Example of integration between Github, Jenkins and PMD.</div>
</div>
<div class="paragraph">
<p>Nowadays it is a common practice in companies and open source projects to watch the quality of their code through manual inspection. These inspections are known as <em>code reviews</em>. In companies like Google, for example, every code change should be manually reviewed <a href="#sadowski2018modern">(51)</a>.</p>
</div>
<div class="paragraph">
<p>A typical code review may involve people in 4 main roles: a moderator, the programmer responsible for the code under inspection, a system designed and the code inspector. The involvement of different roles helps in having different points of view and a more global system-wide perspective. In the review, the system designer and the inspector use their expertise to get a list of potential issues in the code being inspected. These issues are discussed with the programmer who shall fix those that represent actual problems after the review. The process could be implemented as a formal meeting or deferred using a dedicated platform and even echanging direct messages.</p>
</div>
<div class="paragraph">
<p>A code review is successful only if it is carried with very clear goals. For example, reviewing a change in the code may involve answering the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is the code clear enough?</p>
</li>
<li>
<p>Could the development of the program be continued by someone other than the programmer?</p>
</li>
<li>
<p>Are there redundancies in the code?</p>
</li>
<li>
<p>Are there asymmetries like missing cases in the input validation?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Static analysis tools help making code reviews more systematic by finding potential issues that might be missed by the inspector. CI integration is specially helpful for this kind of process.</p>
</div>
<div class="paragraph">
<p>There are tools that implement and automate code review processes. For example Github includes a review workflow for pull requests. The code in the pull request could be annotated and verified either manually or using automated tools. The platform facilitates the exchange between the developer that originated the pull request and the inspector.</p>
</div>
<div class="paragraph">
<p><a href="https://www.sonarqube.org/">SonarQube</a> has become one of the major players in this area. The tool integrates with most used CI/CD and source hosting services. It supports 27 different programming languages and evaluates the quality of the code using a comprehensive set of metrics and vulnerabilities and smell detectors. The platform also helps in the organization of the project by automatically assigning the issues it finds to the developers that made the change.</p>
</div>
<div class="paragraph">
<p>Static analysis tools help assuring the quality of the code. They can efficiently spot potential issues and can be easily integrated in the development process at different levels. However, these tools do not run the code which makes them specially prone to false positives. They should be complemented with other tools that observe the execution of the program under different conditions, that is, dynamic analysis tools and testing.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_testing">3. Software Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>According to Ammann and Offutt <a href="#ammann2016introduction">[ammann2016introduction]</a> <em>Software Testing</em> is the process of evaluating a software by observing its execution to reveal the presence of faults. Or, as Meyer says in his principles <a href="#meyer2008seven">(23)</a> <em>"`to test a program is to try to make it fail`"</em>. Per this definition, testing (aka. dynamic testing) is a form of dynamic analysis: it requires the execution of the program or system under test.</p>
</div>
<div class="paragraph">
<p>Testing is achieved through the design and application of test cases. In broad terms, a test case is a set of steps and values that must provide the required <em>input</em> and set the program in the desired state by <em>triggering specific behaviors</em>. It then, must <em>check the output</em> of the program against expected results. Often, the output of the test case execution is validated with an <em>oracle</em>, <em>i.e.</em> a predicate to tell whether the execution was successful or not. A test case may optionally include <em>prefix values</em> which are inputs necessary to get the system ready for the input and <em>postfix values</em> which are inputs needed to clean the environment after the execution of the test. Test cases may be <em>functional</em>, if they check that a functionality is correct, or <em>non-functional</em> if it is directed to evaluate properties like performance, security or even energy consumption. If a test case executes normally it is said to <em>pass</em> otherwise, if the output is not correct, we say that there is a <em>test failure</em> and that the test <em>fails</em>.</p>
</div>
<div class="paragraph">
<p>A test case exercises the system in one specific scenario. So, only one test case is not enough to correctly verify the system. Therefore we always need to create a set of multiple test cases. This set is usually called <em>test suite</em>.</p>
</div>
<div class="sect2">
<h3 id="_levels_of_testing">3.1. Levels of testing</h3>
<div class="paragraph">
<p>Testing can (and should) be done at different levels of abstractions <a href="#amman2017introduction">(4)</a> <a href="#aniche-software">(52)</a>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unit Testing</dt>
<dd>
<p>It is the lowest level of testing and targets the code units of the program: procedures, functions or methods. The goal is to assess the <em>implementation</em> of the software. For example, a unit test for a function that computes the factorial of a given number, would call the function with an input, say 5 and then check that the result is 120.</p>
</dd>
<dt class="hdlist1">Module Testing</dt>
<dd>
<p>Units are often grouped in <em>modules</em> that could be classes, packages or files. This level of testing verifies each module in isolation and evaluates how the component units interact with each other. For example, a test for a <code>Stack</code> class may create an instance of the class, push an element onto the stack, pop it out and finally check that the stack is empty.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In Object-Oriented Programming a class is at the same time a unit and a module. Therefore the distinction between <em>unit tests</em> and <em>module tests</em> is not clear within this context. In fact, for most testers and developers both types of testing are known as <em>unit testing</em> and it will be also the case for the rest of this text.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Integration Testing</dt>
<dd>
<p>The goal of this level of testing is to assess the interaction between modules and verify that they are communicating correctly. Integration tests assume that modules work correctly. Modules should be verified by the previous testing levels. As an example, an integration test for an online store may check the interaction between the shopping cart module and the payment gateway by creating and validating an order, or it could also verify that data access abstractions communicate correctly with the database by creating the right queries and interpreting the results in the right way.</p>
</dd>
<dt class="hdlist1">System Testing</dt>
<dd>
<p>The goal of this level is to check whether the assembled system meets the specifications. Thus, it assumes that all subsystems work correctly, which is the task of the previous testing levels. System tests execute the system as a whole from beginning to end, that is why they are sometimes also referred as <em>end-to-end</em> tests. An example of such tests in the context of an online store could verify that: a user can log in with the right credentials, she can create a shopping cart with a selection of products, she can validate the order, she receives an email with the invoice and then she is able to log out. Testing done from the graphical user interface is also a form of system testing.</p>
</dd>
<dt class="hdlist1">Acceptance Testing</dt>
<dd>
<p>This level checks that the finished product meets the needs of the users, that is, if the system does what users want. These tests should be elaborated from the user&#8217;s perspective and may be used to evaluate the requirements. Like system tests, these also verify the product from beginning to end.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There might be other, even finer-grained, classifications for tests and they all tend to be blurred and even ambiguous. Classifying one test case as unit, module, integration or system is not crucial. The most important message here is that testing should be carried at different levels, for each unit, whatever they may be, then how these units interact and then how the entire system behaves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each level of testing has its own level of complexity. Unit tests tend to be easier to define and faster to execute. System tests are more complex and slower. Inputs for unit tests may not be completely realistic compared to the inputs that shall appear in production and they are not generally able to find faults arising from the interaction of modules. System tests tend to be more realistic. On the other hand, finding an implementation fault from a system test may be even impractical.</p>
</div>
<div class="paragraph">
<p>Automating the execution of tests at all levels is key for modern software development practices. Manual tests are tedious, take a lot of time and are prone to errors. Automated test execution allows having more tests and therefore more scenarios are explored. As Meyer explains in his fourth principle,<a href="#meyer2008seven">(23)</a> it is not feasible to manually check the output of hundreds of tests. Automated tests help producing a faster, almost immediate feedback during development on whether certain types of faults are being inserted. In this way they enable efficient CI/CD processes which facilitate the integration of the work of development teams. Automated tests help also preventing <em>regressions</em> that is, the reinsertion of an already solved fault. This is specially true if we adhere to Meyer&#8217;s third principle &#8220;Any failed execution must yield a test case, to remain a permanent part of the projectâs test suite&#8221; <a href="#meyer2008seven">(23)</a>.</p>
</div>
<div class="paragraph">
<p>The accepted practice nowadays is to have most tests automated, while keeping only a small amount of manual tests, mainly as acceptance tests. Most organizations have a large number of unit tests, which are easier to write, faster to execute and easier to understand. Organizations tend to have less system tests which are more complex, expensive and harder to maintain. This is reflected on what is known as the <em>testing pyramid</em> <a href="#testing-pyramid">Figure 12</a>.</p>
</div>
<div id="testing-pyramid" class="imageblock text-center">
<div class="content">
<img src="images/testing-pyramid.png" alt="Testing pyramid" width="600">
</div>
<div class="title">Figure 12. The testing pyramid.</div>
</div>
<div class="paragraph">
<p>So, as we move up in the pyramid from unit tests, which directly assess the implementation of the system, to acceptance tests which check the compliance of the system with the users' needs, we move from the area of verification to the area of validation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_automation_frameworks_junit">3.2. Test automation frameworks: JUnit</h3>
<div class="paragraph">
<p>Test automation allows having more tests to explore more execution scenarios, provides a faster feedback and facilitates integration processes. It is achieved with the help of <em>test automation frameworks</em> or <em>testing frameworks</em>.</p>
</div>
<div class="paragraph">
<p>A testing framework is a set of tools and libraries providing mechanisms to define or specify test cases and execute them. One of the most famous alternatives at the moment is <em>JUnit</em>, initially developed by Kent Beck in 1997. JUnit has become a sort of <em>de-facto</em> standard for Java projects and has inspired the creation of similar frameworks for other languages and platforms which are informally called as the <em>xUnit</em> family.
Despite having &#8220;unit&#8221; in the name and being widely used for unit testing, the framework can be use to implement all sort of automated tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the moment of writing this material the latest stable version of JUnit is 5.7.1. This version will be used for all code examples.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suppose we have the <code>BoundedStack</code> class, shown in <a href="#stack-example">Listing 33</a>, that implements a <em>LIFO</em> (Last In First Out) data structure with a fixed capacity. The class has a <code>void</code> method <code>push</code> to insert an element onto the stack, and <code>pop</code> that removes the element on top of the stack and returns it.</p>
</div>
<div id="stack-example" class="listingblock">
<div class="title">Listing 33. The <code>BoundedStack</code> class represents  a <em>LIFO</em> data structure with maximum capacity.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BoundedStack</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">elements</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">count</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">BoundedStack</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">capacity</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">elements</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">capacity</span><span class="tok-o">];</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-n">elements</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalStateException</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">item</span><span class="tok-o">;</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">NoSuchElementException</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-k">return</span> <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">];</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">count</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">capacity</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">elements</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A typical unit test for this class written with the help of JUnit would look like the code shown in <a href="#junit-example">Listing 34</a>.</p>
</div>
<div id="junit-example" class="listingblock">
<div class="title">Listing 34. A typical unit test written with JUnit.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">BoundedStackTest</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPushPop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">original</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-n">BoundedStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BoundedStack</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span>
        <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-n">original</span><span class="tok-o">);</span>
        <span class="tok-kt">int</span> <span class="tok-n">onTop</span> <span class="tok-o">=</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">original</span><span class="tok-o">,</span> <span class="tok-n">onTop</span><span class="tok-o">,</span> <span class="tok-s">&quot;Element on top of the stack should be &quot;</span> <span class="tok-o">+</span> <span class="tok-n">original</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Test cases in JUnit are implemented inside <em>test classes</em>. These classes declare <em>test methods</em> which contain the main code for the test cases. These test methods are identified with the <code>@Test</code> annotation. In <a href="#junit-example">Listing 34</a> the first four lines of <code>testPushPop</code> provide the input values of the test case and set the instance of <code>BoundedStack</code> in the required state: an element has been pushed and then popped from the stack.</p>
</div>
<div class="paragraph">
<p>The last line uses an oracle to verify that the element obtained from the stack was the same that was pushed in the first place. This type of oracle is known as an <em>assertion</em>. It evaluates a given condition and if the condition is false an <code>AssertionError</code> is thrown. It also includes a message to use as output in the case the assertion fails. In the absence of any assertion in the code, JUnit tests have an implicit oracle that checks if unexpected errors occur, that is, if an unexpected exception is thrown.</p>
</div>
<div class="paragraph">
<p>JUnit provides a set of utility methods implementing different assertions such as: <code>assetEquals</code> that checks if two given objects are equal and it is used in the example, <code>assertNotEqual</code>, the contrary, <code>assertNull</code> which verifies if a given value is <code>null</code>, <code>assertSame</code> to verify if two objects are the same and many more.</p>
</div>
<div class="paragraph">
<p>In some scenarios, a test case should verify whether an operation with the wrong input signals the right error. <a href="#junit-throw">Listing 35</a> shows how to achieve this. The test verifies that invoking <code>pop</code> in an empty <code>Stack</code> should throw an <code>IllegalStateException</code>.</p>
</div>
<div id="junit-throw" class="listingblock">
<div class="title">Listing 35. Verifying the correct error with JUnit.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testErrorPopEmptyStack</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertThrows</span><span class="tok-o">(</span><span class="tok-n">NoSuchElementException</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-o">()</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
        <span class="tok-k">new</span> <span class="tok-n">BoundedStack</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">).</span><span class="tok-na">pop</span><span class="tok-o">();</span>
    <span class="tok-o">});</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While the assertions included in JUnit cover a wide spectrum of scenarios, libraries like <a href="http://hamcrest.org/JavaHamcrest/">Hamcrest</a> and <a href="https://joel-costigliola.github.io/assertj/">AssertJ</a> help creating more expressive and higher level assertions.</p>
</div>
<div class="paragraph">
<p>A test case in JUnit could be more than a single test method, it may include other methods supporting the test execution. For example, methods annotated with <code>@BeforeEach</code> and <code>@AfterEach</code> will be executed before and after each identified test cases in the same test class respectively. These are helpful to set prefix and postfix test inputs.</p>
</div>
<div class="paragraph">
<p>JUnit includes many additional functionalities to facilitate the creation of tests, such as parameterized tests, special oracles to verify the performance of the code and even the dynamic creation of tests.</p>
</div>
<div class="paragraph">
<p>It is important to add information that helps identifying the fault in the event of a test failure. In JUnit, and any other testing framework, a common practice to try to achieve this is to use descriptive names for test methods and set detailed messages for assertions. However, there are many other characteristics that good test cases must have in practice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_best_practices_and_antipatterns_in_testing">3.3. Best practices and antipatterns in testing</h3>
<div class="paragraph">
<p>Automated test cases are code, <em>test code</em>, and like their counter part, the <em>application code</em>, they should be maintained and we should care about their quality. Poorly written test cases bring no value to the development process. They negatively impact the fault detection capabilities of a test suite. They are also hard to understand and hard to leverage to correctly identify faults.</p>
</div>
<div class="paragraph">
<p>As summarized in <a href="#meszaros2003test">(54)</a> automated test cases should be <strong>concise</strong> and <strong>clear</strong>: brief, yet comprehensive and easy to understand, <strong>self-checking</strong>: they should report results without human intervention, <strong>repeatable</strong>, <strong>robust</strong> and <strong>independent</strong>: it should be possible to run them consecutive times without human intervention and they should always produce the same results whether their are run in isolation or with other tests. Tests should also be <strong>efficient</strong>: they should run in a reasonable amount of time and should be <strong>maintainable</strong>: that is, they must be easy to modify and extend even when the system under test changes. Also, with respect to the application and the requirements, tests must be <strong>sufficient</strong> so all requirements of the system are verified, <strong>necessary</strong> so that everything inside each test contributes to the specification of the desired behavior, with no redundancy and unneeded artifacts, each test should be <strong>specific</strong> so tests failures point to the specific fault and the broken functionality, and <strong>traceable</strong> so that it can be easily mapped to the parts of the application code it verifies and the part of the specification it has been derived from.</p>
</div>
<div class="sect3">
<h4 id="_test_smells">3.3.1. Test smells</h4>
<div class="paragraph">
<p>Along the years, the testing community has identified bad practices, <em>smells</em> that deviate from the principles mentioned above and have a negative impact in the quality of tests. Garousi and KÃ¼Ã§Ã¼k <a href="#garousi2018smells">(53)</a> reviewed the scientific and industry literature on the subject and were able to identify 179 different test smells. It is important to notice that test smells are not bugs but affect the tests by lowering their efficiency, maintainability, readability, comprehension and their ability to find faults. This section presents and exemplifies some of these test smells.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Manual intervention</dt>
<dd>
<p>Happens when the person running a test case must do something manually before the test is run, during the execution of the test or she should manually verify the results. This practice undermines test automation.</p>
</dd>
<dt class="hdlist1">Testing Happy Path only</dt>
<dd>
<p>These tests verify only the common scenario and never check boundaries or input values that should result in exceptions. Most of the time developers write code with the happy path / normal situation in mind and it is most likely that this scenario will work. Therefore, testing only the happy path have lower chances to catch a bug. The test case in <a href="#junit-example">Listing 34</a> tests only the most expected scenario or happy path. We need to add test cases like <a href="#junit-throw">Listing 35</a> where we explore extreme scenarios like a pop on an empty stack or when a null element is pushed, or if there is a point at which we can push no more elements to the stack.</p>
</dd>
<dt class="hdlist1">Test logic in production code</dt>
<dd>
<p>The application code deployed in production contains logic that should be exercised only during test execution. This logic is there only to support testing, for example, to help tests gain access to the internal state of the application. It also may happen that part of the production logic can not be executed in testing. This makes the system behaves differently in production and testing. An example is shown in <a href="#test-logic-in-production">Listing 36</a>.</p>
</dd>
</dl>
</div>
<div id="test-logic-in-production" class="listingblock">
<div class="title">Listing 36. Example of test logic in production code.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">...</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-s">&quot;env&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;prod&quot;</span><span class="tok-o">).</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;test&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">User</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">Jane</span> <span class="tok-n">Doe</span><span class="tok-err">&#39;</span><span class="tok-o">,</span> <span class="tok-err">&#39;</span><span class="tok-n">janedoe</span><span class="tok-nd">@example.com</span><span class="tok-err">&#39;</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>
    <span class="tok-n">User</span> <span class="tok-n">user</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">User</span><span class="tok-o">(</span><span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">getParam</span><span class="tok-o">(</span><span class="tok-n">login</span><span class="tok-o">),</span> <span class="tok-n">Request</span><span class="tok-o">.</span><span class="tok-na">getParam</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">));</span>
    <span class="tok-n">validateUser</span><span class="tok-o">(</span><span class="tok-n">user</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">user</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line makes the code return a wired values to use in production.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another example of this type of smell is when a class does not require an implementation of <code>equals</code> and we do need it just for testing purposes. This is known as <em>equality pollution</em>. The application code is filled with unnecessary <code>equals</code> methods, whose logic may actually go against the requirements.</p>
</div>
<div class="paragraph">
<p>In general, all forms of this test smell make the application code more complex and introduces maintainability issues.</p>
</div>
<div class="paragraph">
<p>A way to solve this smell, is to use <em>dependency injection</em>. The code that has to work differently in production and tests can be moved onto a dependency that can be exchanged without affecting the application logic. In case of equality pollution we could use an <em>equality comparer</em>, that is, a class that checks if two objects are equals per our needs.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Eager test</dt>
<dd>
<p>Also known as <strong>Test It All</strong> or <strong>Split Personality</strong>. It is a single test that verifies too many functionalities. <a href="#eager-roulette">Listing 37</a> shows an example of this test smell. When such a test fails, it is hard to tell which code produced the failure. The solution is to separate all verifications into different test cases.</p>
</dd>
</dl>
</div>
<div id="eager-roulette" class="listingblock">
<div class="title">Listing 37. An example of a test that tries to test too much in the same test case (Eager Test) and it is also hard to know the fault in the presence of a test failure. Taken from <a href="#xunitpatterns-assertion">[xunitpatterns-assertion]</a>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testFlightMileage_asKm2</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-c1">// setup fixture</span>
    <span class="tok-c1">// exercise contructor</span>
    <span class="tok-n">Flight</span> <span class="tok-n">newFlight</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Flight</span><span class="tok-o">(</span><span class="tok-n">validFlightNumber</span><span class="tok-o">);</span>
    <span class="tok-c1">// verify constructed object</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">validFlightNumber</span><span class="tok-o">,</span> <span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">number</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">,</span> <span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">airlineCode</span><span class="tok-o">);</span>
    <span class="tok-n">assertNull</span><span class="tok-o">(</span><span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">airline</span><span class="tok-o">);</span>
    <span class="tok-c1">// setup mileage</span>
    <span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">setMileage</span><span class="tok-o">(</span><span class="tok-mi">1122</span><span class="tok-o">);</span>
    <span class="tok-c1">// exercise mileage translater</span>
    <span class="tok-kt">int</span> <span class="tok-n">actualKilometres</span> <span class="tok-o">=</span> <span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">getMileageAsKm</span><span class="tok-o">();</span>
    <span class="tok-c1">// verify results</span>
    <span class="tok-kt">int</span> <span class="tok-n">expectedKilometres</span> <span class="tok-o">=</span> <span class="tok-mi">1810</span><span class="tok-o">;</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-n">expectedKilometres</span><span class="tok-o">,</span> <span class="tok-n">actualKilometres</span><span class="tok-o">);</span>
    <span class="tok-c1">// now try it with a canceled flight:</span>
    <span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">cancel</span><span class="tok-o">();</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">newFlight</span><span class="tok-o">.</span><span class="tok-na">getMileageAsKm</span><span class="tok-o">();</span>
        <span class="tok-n">fail</span><span class="tok-o">(</span><span class="tok-s">&quot;Expected exception&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InvalidRequestException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-s">&quot;Cannot get cancelled flight mileage&quot;</span><span class="tok-o">,</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Assertion roulette</dt>
<dd>
<p>Appears when it is hard to tell which of the many assertions of a test method produced the test failure. This makes harder to diagnose the actual fault. Eager tests tend to also produce assertion roulettes as can be seen in <a href="#eager-roulette">Listing 37</a>. This smell also occurs when assertions do not have any message, as seen in <a href="#no-message-assertion">Listing 38</a>. To solve this smell we should refactor the test code and add a descriptive message to all assertions.</p>
</dd>
</dl>
</div>
<div id="no-message-assertion" class="listingblock">
<div class="title">Listing 38. Example of a test case with several assertions with no message. In the case of a test failure it is hard to know which assertion failed and to diagnose the fault. Taken from <a href="#xunitpatterns-assertion">[xunitpatterns-assertion]</a></div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testInvoice_addLineItem7</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">LineItem</span> <span class="tok-n">expItem</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LineItem</span><span class="tok-o">(</span><span class="tok-n">inv</span><span class="tok-o">,</span> <span class="tok-n">product</span><span class="tok-o">,</span> <span class="tok-n">QUANTITY</span><span class="tok-o">);</span>
    <span class="tok-c1">// Exercise</span>
    <span class="tok-n">inv</span><span class="tok-o">.</span><span class="tok-na">addItemQuantity</span><span class="tok-o">(</span><span class="tok-n">product</span><span class="tok-o">,</span> <span class="tok-n">QUANTITY</span><span class="tok-o">);</span>
    <span class="tok-c1">// Verify</span>
    <span class="tok-n">List</span> <span class="tok-n">lineItems</span> <span class="tok-o">=</span> <span class="tok-n">inv</span><span class="tok-o">.</span><span class="tok-na">getLineItems</span><span class="tok-o">();</span>
    <span class="tok-n">LineItem</span> <span class="tok-n">actual</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">LineItem</span><span class="tok-o">)</span><span class="tok-n">lineItems</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">expItem</span><span class="tok-o">.</span><span class="tok-na">getInv</span><span class="tok-o">(),</span> <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">getInv</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">expItem</span><span class="tok-o">.</span><span class="tok-na">getProd</span><span class="tok-o">(),</span> <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">getProd</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">expItem</span><span class="tok-o">.</span><span class="tok-na">getQuantity</span><span class="tok-o">(),</span> <span class="tok-n">actual</span><span class="tok-o">.</span><span class="tok-na">getQuantity</span><span class="tok-o">());</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The Free Ride</dt>
<dd>
<p>Also known as <strong>Piggyback</strong> and closely related to the two previous test smells. In this smell, rather than write a new test case method to test another feature or functionality, testers add new assertions to verify other functionalities. It can lead to eager tests and assertion roulettes. As with those two other smells, piggybacking makes it hard to diagnose the fault. <a href="#piggybacking">Listing 39</a> shows an actual example of this smell from the Apache Commons Lang project.</p>
</dd>
</dl>
</div>
<div id="piggybacking" class="listingblock">
<div class="title">Listing 39. Actual example of the piggybacking test smell. Code can be consulted in the <a href="https://github.com/apache/commons-lang/blob/649dedbbe8b6ab61fb3c4792c86b7e0af7ec4a73/src/test/java/org/apache/commons/lang3/ArrayUtilsRemoveMultipleTest.java#L34">Apache Commons Lang code repository</a>. This is also an example of an eager test and assertion roulette.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testRemoveAllBooleanArray</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">;</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">EMPTY_BOOLEAN_ARRAY</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">false</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span> <span class="tok-o">},</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">EMPTY_BOOLEAN_ARRAY</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">false</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">false</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span> <span class="tok-o">},</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-mi">6</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>

    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">ArrayUtils</span><span class="tok-o">.</span><span class="tok-na">removeAll</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">);</span>
    <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[]{</span><span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">},</span> <span class="tok-n">array</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">().</span><span class="tok-na">getComponentType</span><span class="tok-o">());</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Interacting Tests</dt>
<dd>
<p>Tests that depend on each other in some way. It may happen when one test depends of the outcome of another, for example, as a result of a test, a file is created which is used to execute another test. In this way a test may fail for reasons other than a fault in the behavior it is verifying.</p>
</dd>
<dt class="hdlist1">The Local Hero</dt>
<dd>
<p>A test case depends on something specific to the development environment. It passes in a matching environment but fails under any other conditions. This may happen when tests depend on the existence of specific services or even machine features. Such assumptions should always be avoided.</p>
</dd>
<dt class="hdlist1">Conditional test logic</dt>
<dd>
<p>Also known as <strong>Guarded Test</strong>. Consists in a test that contains code that may or may not be executed. It makes tests more complicated than actually needed and therefore less readable and maintainable. It usually appears with the use of control structures within a test method. <a href="#conditional-logic">Listing 40</a> shows an example.</p>
</dd>
</dl>
</div>
<div id="conditional-logic" class="listingblock">
<div class="title">Listing 40. An example of conditional logic in a test. In this case, if the element is not returned by the iterator, the test executes without failing.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span> <span class="tok-c1">//  verify Vancouver is in the list:</span>
    <span class="tok-n">actual</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">flightsFromCalgary</span><span class="tok-o">.</span><span class="tok-na">iterator</span><span class="tok-o">();</span>
    <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">())</span> <span class="tok-o">{</span>
        <span class="tok-n">FlightDto</span> <span class="tok-n">flightDto</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">FlightDto</span><span class="tok-o">)</span> <span class="tok-n">i</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">flightDto</span><span class="tok-o">.</span><span class="tok-na">getFlightNumber</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span> <span class="tok-n">expectedCalgaryToVan</span><span class="tok-o">.</span><span class="tok-na">getFlightNumber</span><span class="tok-o">()))</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-o">{</span>
            <span class="tok-n">actual</span> <span class="tok-o">=</span> <span class="tok-n">flightDto</span><span class="tok-o">;</span>
            <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Flight from Calgary to Vancouver&quot;</span><span class="tok-o">,</span> <span class="tok-n">expectedCalgaryToVan</span><span class="tok-o">,</span> <span class="tok-n">flightDto</span><span class="tok-o">);</span>
            <span class="tok-k">break</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Checks the presence of an element. If the element is not there, then the test executes and does not fail.
<div class="dlist">
<dl>
<dt class="hdlist1">Fragile test</dt>
<dd>
<p>A test that fails to compile or run when the system under test is changed in ways that do not affect the part the test is exercising. These tests increase the cost of maintenance. There are many causes for this smell, so code should be carefully inspected and refactored.</p>
</dd>
<dt class="hdlist1">Erratic tests</dt>
<dd>
<p>Also known as <strong>Flaky Tests</strong>. It is a test that behave erratically under the same conditions, sometimes it fails and sometimes it does not. These tests undermine the trust developers have on their test suites. It is hard to know whether the failure is due to an actual fault or not. There are many reasons this could happen, for example: the already mentioned <strong>Interacting Tests</strong> smell, incorrect handling of the resources the test should use, and any type of non-determinism in tests coming from race conditions, synchronization, concurrency, time-outs and randomly generated data. Erratic or flaky tests are more common in higher level testing such as integration or system tests. They are a true plague for companies that develop big systems. As an example, Google has reported that nearly 1.5% of their tests behave erratically  <a href="#micco2016flaky">(56)</a>.</p>
</dd>
<dt class="hdlist1">Get really clever and use random numbers in your tests</dt>
<dd>
<p>Using randomly generated data in tests cases is not necessarily a bad idea. Random tests can discover cases that developers have missed. However, random data has to be carefully managed to avoid creating <strong>Erratic Tests</strong> and to ensure that tests can be <strong>repeatable</strong>. Some of the key actions to consider are to use pseudo-random numbers and to store or log the seed used to generate the data and to log the data used in case of a failure. With this information, the test can be repeated later to diagnose the fault.</p>
</dd>
<dt class="hdlist1">Testing private methods</dt>
<dd>
<p>Also known as  <strong>X-Ray Specs</strong>. Tests should verify results, not the implementation. Results are most likely to remain the same even when the implementation changes. Results usually come from the specification and the implementation should match the specification. Private methods are implementation artifacts hidden from external users. Verifying results should only involve the public interface without knowing the internals of a module or class. Also, trying to test private methods, requires a non-trivial plumbing that would make tests more complicated. So, tests should not directly target private methods, but they <em>must assess their effects</em> through the public interface.</p>
</dd>
</dl>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_real_examples_of_good_testing_practices">3.3.2. Real examples of good testing practices</h4>
<div class="paragraph">
<p>The previous sections presented the features good tests should have and described a selection of common antipatterns in testing. This section presents examples of good testing practices in Apache Commons Math, a popular open-source Java library.</p>
</div>
<div class="paragraph">
<p><a href="#testing-exceptional-case">Listing 41</a> shows a good example on how to handle the verification of exceptional cases and avoiding to test only the happy path. In this example, developers do two things. First, they annotate the expected exception in the test with <code>@Test(expected=&#8230;&#8203;)</code>. With this, JUnit will verify that an exception is thrown and that it should be of the right type. Then, they used the special assertion <code>fail</code> to mark the part of the test code that should not be executed due to the exception. In this way they ensure that the test will not silently pass in the event of any fault and even if they do not annotate the test with the exception. The original code can be consulted <a href="https://github.com/apache/commons-math/blob/eb57d6d457002a0bb5336d789a3381a24599affe/src/test/java/org/apache/commons/math4/filter/KalmanFilterTest.java#L43" class="bare">https://github.com/apache/commons-math/blob/eb57d6d457002a0bb5336d789a3381a24599affe/src/test/java/org/apache/commons/math4/filter/KalmanFilterTest.java#L43</a>
[here]. Note that this uses JUnit 4. In JUnit 5, <code>assertThrows</code> is preferred.</p>
</div>
<div id="testing-exceptional-case" class="listingblock">
<div class="title">Listing 41. A test case, testing the exceptional case, notice the use of <code>fail</code> to avoid finishing the test silently.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// In org.apache.commons.math3.filter.KalmanFilterTest</span>
<span class="tok-nd">@Test</span><span class="tok-o">(</span><span class="tok-n">expected</span><span class="tok-o">=</span><span class="tok-n">MatrixDimensionMismatchException</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testTransitionMeasurementMatrixMismatch</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// A and H matrix do not match in dimensions</span>
    <span class="tok-c1">// A = [ 1 ]</span>
    <span class="tok-n">RealMatrix</span> <span class="tok-n">A</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Array2DRowRealMatrix</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-mf">1d</span> <span class="tok-o">});</span>
    <span class="tok-c1">// no control input</span>
    <span class="tok-n">RealMatrix</span> <span class="tok-n">B</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-c1">// H = [ 1 1 ]</span>
    <span class="tok-n">RealMatrix</span> <span class="tok-n">H</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Array2DRowRealMatrix</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-mf">1d</span><span class="tok-o">,</span> <span class="tok-mf">1d</span> <span class="tok-o">});</span>
    <span class="tok-c1">// Q = [ 0 ]</span>
    <span class="tok-n">RealMatrix</span> <span class="tok-n">Q</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Array2DRowRealMatrix</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-mi">0</span> <span class="tok-o">});</span>
    <span class="tok-c1">// R = [ 0 ]</span>
    <span class="tok-n">RealMatrix</span> <span class="tok-n">R</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Array2DRowRealMatrix</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-mi">0</span> <span class="tok-o">});</span>

    <span class="tok-n">ProcessModel</span> <span class="tok-n">pm</span>
        <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultProcessModel</span><span class="tok-o">(</span><span class="tok-n">A</span><span class="tok-o">,</span> <span class="tok-n">B</span><span class="tok-o">,</span> <span class="tok-n">Q</span><span class="tok-o">,</span>
                                    <span class="tok-k">new</span> <span class="tok-n">ArrayRealVector</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-mi">0</span> <span class="tok-o">}),</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
    <span class="tok-n">MeasurementModel</span> <span class="tok-n">mm</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultMeasurementModel</span><span class="tok-o">(</span><span class="tok-n">H</span><span class="tok-o">,</span> <span class="tok-n">R</span><span class="tok-o">);</span>
    <span class="tok-k">new</span> <span class="tok-n">KalmanFilter</span><span class="tok-o">(</span><span class="tok-n">pm</span><span class="tok-o">,</span> <span class="tok-n">mm</span><span class="tok-o">);</span>
    <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">fail</span><span class="tok-o">(</span><span class="tok-s">&quot;transition and measurement matrix should not be compatible&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotation with an assertion to indicate that a <code>MatrixDimensionMismatchException</code> should be thrown.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This line must not be executed, if the exception is properly thrown. This is therefore a safeguard ensuring that the test should fail in case this line is executed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#random-data">Listing 42</a> shows a test case using random data. Developers fixed the seed to generate the random numbers. It could be argued that this is in fact not random data, as the same numbers will be generated every time. However, this test reflects that the actual numbers play no role in the behavior being tested. On the other hand, the code is an example of a test case that should be divided in two. The actual code can be checked <a href="https://github.com/apache/commons-math/blob/eb57d6d457002a0bb5336d789a3381a24599affe/src/test/java/org/apache/commons/math4/linear/BlockFieldMatrixTest.java#L182">here</a>.</p>
</div>
<div id="random-data" class="listingblock">
<div class="title">Listing 42. Right use of random data. The test case fixes the seed, however it could be argued that it is in fact not exactly random.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// In org.apache.commons.math3.linear.BlockFieldMatrixTest</span>

<span class="tok-cm">/** test copy functions */</span>
<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testCopyFunctions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">Random</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">(</span><span class="tok-mi">66636328996002l</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;</span> <span class="tok-n">m1</span> <span class="tok-o">=</span> <span class="tok-n">createRandomMatrix</span><span class="tok-o">(</span><span class="tok-n">r</span><span class="tok-o">,</span> <span class="tok-mi">47</span><span class="tok-o">,</span> <span class="tok-mi">83</span><span class="tok-o">);</span>
  <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;</span> <span class="tok-n">m2</span> <span class="tok-o">=</span>
	<span class="tok-k">new</span> <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;(</span><span class="tok-n">m1</span><span class="tok-o">.</span><span class="tok-na">getData</span><span class="tok-o">());</span>
  <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">m1</span><span class="tok-o">,</span> <span class="tok-n">m2</span><span class="tok-o">);</span>
  <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;</span> <span class="tok-n">m3</span> <span class="tok-o">=</span>
	<span class="tok-k">new</span> <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;(</span><span class="tok-n">testData</span><span class="tok-o">);</span>
  <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;</span> <span class="tok-n">m4</span> <span class="tok-o">=</span>
	<span class="tok-k">new</span> <span class="tok-n">BlockFieldMatrix</span><span class="tok-o">&lt;</span><span class="tok-n">Fraction</span><span class="tok-o">&gt;(</span><span class="tok-n">m3</span><span class="tok-o">.</span><span class="tok-na">getData</span><span class="tok-o">());</span>
  <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">m3</span><span class="tok-o">,</span> <span class="tok-n">m4</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using a fixed seed to ensure repeatability.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#distribution-test">Listing 43</a> shows another test case using random data. In this code developers are testing a random generator which should produce a collection of vectors uniformly distributed around the unit sphere. Again, developers used a fixed seed. This test case also exemplifies the use of a good strong oracle that validates the property of the distribution without assumptions on the actual numbers. Changing the seed should not not change the outcome of the test or make the test fail unnecessarily. On the other hand, the oracle might be better placed in a separate method in the form of a custom assertion, as we will explain later. The original code can be checked <a href="https://github.com/venkateshamurthy/java-quantiles/blob/master/src/test/java/org/apache/commons/math3/random/UnitSphereRandomVectorGeneratorTest.java#L29">here</a>.</p>
</div>
<div id="distribution-test" class="listingblock">
<div class="title">Listing 43. Another example on the use of random data. This time, he test case also has a strong verii</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// In org.apache.commons.math3.random.UnitSphereRandomVectorGeneratorTest</span>
<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">test2DDistribution</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-n">RandomGenerator</span> <span class="tok-n">rg</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JDKRandomGenerator</span><span class="tok-o">();</span>
    <span class="tok-n">rg</span><span class="tok-o">.</span><span class="tok-na">setSeed</span><span class="tok-o">(</span><span class="tok-mi">17399225432l</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-n">UnitSphereRandomVectorGenerator</span> <span class="tok-n">generator</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">UnitSphereRandomVectorGenerator</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">rg</span><span class="tok-o">);</span>

    <span class="tok-c1">// In 2D, angles with a given vector should be uniformly distributed</span>
    <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">angleBuckets</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
    <span class="tok-kt">int</span> <span class="tok-n">steps</span> <span class="tok-o">=</span> <span class="tok-mi">1000000</span><span class="tok-o">;</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">steps</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">final</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">v</span> <span class="tok-o">=</span> <span class="tok-n">generator</span><span class="tok-o">.</span><span class="tok-na">nextVector</span><span class="tok-o">();</span>
        <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">v</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">);</span>
        <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">length</span><span class="tok-o">(</span><span class="tok-n">v</span><span class="tok-o">),</span> <span class="tok-mf">1e-10</span><span class="tok-o">);</span>
        <span class="tok-c1">// Compute angle formed with vector (1,0)</span>
        <span class="tok-c1">// Cosine of angle is their dot product, because both are unit length</span>
        <span class="tok-c1">// Dot product here is just the first element of the vector by construction</span>
        <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">angle</span> <span class="tok-o">=</span> <span class="tok-n">FastMath</span><span class="tok-o">.</span><span class="tok-na">acos</span><span class="tok-o">(</span><span class="tok-n">v</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]);</span>
        <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">bucket</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span> <span class="tok-o">(</span><span class="tok-n">angleBuckets</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">*</span> <span class="tok-o">(</span><span class="tok-n">angle</span> <span class="tok-o">/</span> <span class="tok-n">FastMath</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">));</span>
        <span class="tok-o">++</span><span class="tok-n">angleBuckets</span><span class="tok-o">[</span><span class="tok-n">bucket</span><span class="tok-o">];</span>
    <span class="tok-o">}</span>
    <span class="tok-c1">// Simplistic test for roughly even distribution</span>
    <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">expectedBucketSize</span> <span class="tok-o">=</span> <span class="tok-n">steps</span> <span class="tok-o">/</span> <span class="tok-n">angleBuckets</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">bucket</span> <span class="tok-o">:</span> <span class="tok-n">angleBuckets</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertTrue</span><span class="tok-o">(</span><span class="tok-s">&quot;Bucket count &quot;</span> <span class="tok-o">+</span> <span class="tok-n">bucket</span> <span class="tok-o">+</span> <span class="tok-s">&quot; vs expected &quot;</span> <span class="tok-o">+</span> <span class="tok-n">expectedBucketSize</span><span class="tok-o">,</span>
                            <span class="tok-n">FastMath</span><span class="tok-o">.</span><span class="tok-na">abs</span><span class="tok-o">(</span><span class="tok-n">expectedBucketSize</span> <span class="tok-o">-</span> <span class="tok-n">bucket</span><span class="tok-o">)</span> <span class="tok-o">&lt;</span> <span class="tok-mi">350</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Fixed seed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Strong verification</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#strong-data">Listing 44</a> is an example of a test case with extensive data that has been carefully crafted to meet the requirements. The input data has been generated beforehand, possibly to ensure efficiency and repeatability. The generation process has been also carefully documented. The full test case can be seen <a href="https://github.com/venkateshamurthy/java-quantiles/blob/1dd682e8a00af5968ec4057b0613dd73d5eb704f/src/test/java/org/apache/commons/math3/special/GammaTest.java#L170">here</a>.</p>
</div>
<div id="strong-data" class="listingblock">
<div class="title">Listing 44. Example of carefully crafted input.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">//In org.apache.commons.math3.special.GammaTest</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Reference data for the {@link Gamma#logGamma(double)} function. This data</span>
<span class="tok-cm">     * was generated with the following &lt;a</span>
<span class="tok-cm">     * href=&quot;http://maxima.sourceforge.net/&quot;&gt;Maxima&lt;/a&gt; script.</span>
<span class="tok-cm">     * &lt;pre&gt;</span>
<span class="tok-cm">     * kill(all);</span>
<span class="tok-cm">     * fpprec : 64;</span>
<span class="tok-cm">     * gamln(x) := log(gamma(x));</span>
<span class="tok-cm">     * x : append(makelist(bfloat(i / 8), i, 1, 80),</span>
<span class="tok-cm">     *     [0.8b0, 1b2, 1b3, 1b4, 1b5, 1b6, 1b7, 1b8, 1b9, 1b10]);</span>
<span class="tok-cm">     * for i : 1 while i &lt;= length(x) do</span>
<span class="tok-cm">     *     print(&quot;{&quot;, float(x[i]), &quot;,&quot;, float(gamln(x[i])), &quot;},&quot;);</span>
<span class="tok-cm">     * &lt;/pre&gt;</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">LOG_GAMMA_REF</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
        <span class="tok-o">{</span> <span class="tok-mf">0.125</span> <span class="tok-o">,</span> <span class="tok-mf">2.019418357553796</span> <span class="tok-o">},</span>
        <span class="tok-o">{</span> <span class="tok-mf">0.25</span> <span class="tok-o">,</span> <span class="tok-mf">1.288022524698077</span> <span class="tok-o">},</span>
        <span class="tok-o">{</span> <span class="tok-mf">0.375</span> <span class="tok-o">,</span> <span class="tok-mi">8630739822706475</span> <span class="tok-o">},</span>
        <span class="tok-c1">//...129 more lines</span>
    <span class="tok-o">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#custom-assertion">Listing 45</a> shows an example of a custom assertion, built to support the testing process. This is a verification used in several test cases inside the test suite. So, it is a good practice to refactor the assertion condition into a method. This is also a way to avoid <strong>Equality Pollution</strong>. In this case, even the JUnit style have been respected. Also notice how <code>doubles</code> are compared using a precision. Floating point types should never be compared with direct equality due to numerical errors. The code can be checked <a href="https://github.com/joulupunikki/math/blob/master/src/test/java/org/apache/commons/math3/TestUtils.java#L165">here</a>.</p>
</div>
<div id="custom-assertion" class="listingblock">
<div class="title">Listing 45. A custom assertion.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// In org.apache.commons.math3.TestUtils</span>

    <span class="tok-cm">/**</span>
<span class="tok-cm">     * Verifies that the relative error in actual vs. expected is less than or</span>
<span class="tok-cm">     * equal to relativeError.  If expected is infinite or NaN, actual must be</span>
<span class="tok-cm">     * the same (NaN or infinity of the same sign).</span>
<span class="tok-cm">     *</span>
<span class="tok-cm">     * @param msg  message to return with failure</span>
<span class="tok-cm">     * @param expected expected value</span>
<span class="tok-cm">     * @param actual  observed value</span>
<span class="tok-cm">     * @param relativeError  maximum allowable relative error</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">assertRelativelyEquals</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">msg</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">expected</span><span class="tok-o">,</span>
            <span class="tok-kt">double</span> <span class="tok-n">actual</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">relativeError</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">isNaN</span><span class="tok-o">(</span><span class="tok-n">expected</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertTrue</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">,</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">isNaN</span><span class="tok-o">(</span><span class="tok-n">actual</span><span class="tok-o">));</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">isNaN</span><span class="tok-o">(</span><span class="tok-n">actual</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertTrue</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">,</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">isNaN</span><span class="tok-o">(</span><span class="tok-n">expected</span><span class="tok-o">));</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">isInfinite</span><span class="tok-o">(</span><span class="tok-n">actual</span><span class="tok-o">)</span> <span class="tok-o">||</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">isInfinite</span><span class="tok-o">(</span><span class="tok-n">expected</span><span class="tok-o">))</span> <span class="tok-o">{</span>
            <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">expected</span><span class="tok-o">,</span> <span class="tok-n">actual</span><span class="tok-o">,</span> <span class="tok-n">relativeError</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">expected</span> <span class="tok-o">==</span> <span class="tok-mf">0.0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">,</span> <span class="tok-n">actual</span><span class="tok-o">,</span> <span class="tok-n">expected</span><span class="tok-o">,</span> <span class="tok-n">relativeError</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-kt">double</span> <span class="tok-n">absError</span> <span class="tok-o">=</span> <span class="tok-n">FastMath</span><span class="tok-o">.</span><span class="tok-na">abs</span><span class="tok-o">(</span><span class="tok-n">expected</span><span class="tok-o">)</span> <span class="tok-o">*</span> <span class="tok-n">relativeError</span><span class="tok-o">;</span>
            <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">msg</span><span class="tok-o">,</span> <span class="tok-n">expected</span><span class="tok-o">,</span> <span class="tok-n">actual</span><span class="tok-o">,</span> <span class="tok-n">absError</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_design">3.4. Test design</h3>
<div class="paragraph">
<p>Any testing process, automatic or manual, could be abstracted as <a href="#testing-process">[testing-process]</a> shows. The system or program under test (SUT) is executed using selected test inputs. The result of the execution is evaluated with the help of an oracle based on the specification. If the oracle deems the result incorrect, then we must find the fault. Otherwise, we continue the testing process until a stopping criterion is met.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/testing-process.png" alt="testing process" width="399" height="564">
</div>
<div class="title">Figure 13. Testing process at a glance.</div>
</div>
<div class="paragraph">
<p>This diagram puts in evidence three main problems to be solved when designing our tests. First we need to identify a set of <strong>test inputs</strong> that will become the starting point for the tests cases. Then, for each test case we need to define a strong <strong>oracle</strong> able to tell when the result of the execution meets the requirements or not. Also we need to know how much should we test, that is, to set a <strong>stopping criterion</strong>. Ideally we would test until there are no more faults or when we explore all possible inputs, but this can not be done in practice. Locating and fixing an identified fault is also a very important problem, but it is out of the scope of testing and more related to <em>debugging</em>. However, tests failures should provide enough information for developers to find and correct the fault.</p>
</div>
<div class="paragraph">
<p>Solving these problems is far from easy. But, no matter the solution or strategy we pick, our ultimate goal should be to design tests capable of discovering faults.</p>
</div>
<div class="sect3">
<h4 id="_reachability_infection_propagation_revealability">3.4.1. Reachability, Infection, Propagation, Revealability</h4>
<div class="paragraph">
<p>The main goal of testing is to reveal the presence of faults. However, there are four concrete conditions that a test case execution should meet to be able to discover a fault. These conditions are expressed in the <em>Reachability, Infection, Propagation, Revealability</em> (RIPR) model <a href="#li2016test">(57)</a>.</p>
</div>
<div class="paragraph">
<p><a href="#ripr-faulty-program">Listing 46</a> shows the <code>findLast</code> method. This method should return the index of the last occurrence of a given <code>element</code> in a given <code>array</code>. If the element is not present the method should return -1 and if the array is <code>null</code> it should throw an instance of <code>NullPointerException</code>. The method in question has a fault, the loop condition should be <code>i &gt;= 0</code> instead of <code>i &gt; 0</code>. Due to this fault this <code>findLast</code> will never compare <code>element</code> to the value in the first position of the array.</p>
</div>
<div id="ripr-faulty-program" class="listingblock">
<div class="title">Listing 46. <code>findLast</code> is supposed to return the index of the last occurrence of a given element in a given array. If the array is <code>null</code> the method should throw a <code>NullPointerException</code> exception. If the element is not present, then it should return -1. This method contains a fault as it never inspects the first element of the array.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">findLast</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">--)</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">element</span><span class="tok-o">)</span>
            <span class="tok-k">return</span> <span class="tok-n">i</span><span class="tok-o">;</span>

    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Loop condition should be <code>i &gt;= 0</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#ripr-no-reachability">Listing 47</a>, <a href="#ripr-no-infection">Listing 48</a>, <a href="#ripr-no-propagation">Listing 49</a> and <a href="#ripr-no-revealability">Listing 50</a> show test cases exercising <code>findLast</code>. However, all these test cases fail to observe the bug for different reasons. We shall use these test cases to illustrate the concepts behind the RIPR model. We shall also discover how the model can explain why the fault is not discovered.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Reachability</dt>
<dd>
<p>For a test case to discover a fault it must first execute/<em>reach</em>, the code location where the bug is present. The test case in <a href="#ripr-no-reachability">Listing 47</a> tests the behavior of the method when the input array is <code>null</code>. Therefore this test case never executes the loop condition and does not reach the fault.</p>
<div id="ripr-no-reachability" class="listingblock">
<div class="title">Listing 47. A test case that does not reach the fault.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testNull</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertThrows</span><span class="tok-o">(</span><span class="tok-n">NullPointerException</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-o">()</span>  <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
        <span class="tok-n">findLast</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-o">});</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Infection</dt>
<dd>
<p>Reaching the location of the fault is not the only condition the execution should meet to discover the fault. The test case should also produce an incorrect program state, that is, it should <em>infect</em> the program state with incorrect values. <a href="#ripr-no-infection">Listing 48</a> fails to do that. In this test case the element in the first position of the array is never inspected. The last occurrence of the element given as input is found at the last position of the array. The test case has the same behavior in the presence of the fault as is the program was correct. On the other hand, <a href="#ripr-no-propagation">Listing 49</a> do infect the state of the program. The first position is not checked in the faulty version which is not the case for the correct program. So, the infection comes for the fact <code>i</code> is never <code>0</code> during the execution while it should have had this value at some point.</p>
<div id="ripr-no-infection" class="listingblock">
<div class="title">Listing 48. A test case that reaches the location of the fault but does not infect the program state.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testLastElement</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">};</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">findLast</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Propagation</dt>
<dd>
<p><a href="#ripr-no-propagation">Listing 49</a> do infect the program but does not reveal the fault. A test case must reach the location of the fault, infect the program state but also <em>propagate</em> the program state infection to the rest of the execution. &lt;<a href="#ripr-no-propagation">Listing 49</a> produces an incorrect program state as the first position of the array is not inspected but returns the right result, so the error does not even reach the code of the test case. On the other hand, <a href="#ripr-no-revealability">Listing 50</a> do propagate the infection to an observable code location. In this new test case <code>findLast</code> produces a wrong result. However, the test case is not yet able to detect the fault.</p>
<div id="ripr-no-propagation" class="listingblock">
<div class="title">Listing 49. A test case that reaches the fault, infects the program state but does not propagate the infection.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testNotFound</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(-</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">findLast</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[]{</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">},</span> <span class="tok-mi">4</span><span class="tok-o">));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Revealability</dt>
<dd>
<p>It is impractical, if not impossible, to create an oracle that observes the entire program state. That is why, for a test case to discover a fault, it must not only reach the location, infect the program state and propagate the infection to the rest of the execution. The test must also observe the right portion of the state and use a strong condition to verify it. <a href="#ripr-no-revealability">Listing 50</a> reaches the fault, infects the program state, produces a wrong result that propagates to the code of the test case, but the oracle is not adequate to <em>reveal</em> the fault. The assertion in the test case validates that no exception is thrown.  The assertion does not verify the result of <code>findLast</code>.</p>
<div id="ripr-no-revealability" class="listingblock">
<div class="title">Listing 50. A test case that fails to reveal the fault, due to a weak oracle. The method returns a wrong value <code>-1</code> when the correct value is <code>0</code>. The assertion inspects a different part of the program state.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kt">void</span> <span class="tok-nf">testExecutesNormally</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertDoesNotThrow</span><span class="tok-o">(()</span> <span class="tok-o">-&gt;</span> <span class="tok-n">findLast</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[]{</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the test case in <a href="#ripr-test">Listing 51</a> meets all the conditions to reveal the fault in the method. The method produces an incorrect value, <code>-1</code>, which is not the expected value <code>0</code>. When this new test case is executed all conditions are met. The fault is reached, the state is infected, the infection is propagated to the code of the test case, there is an oracle observing the right portion of the program state and the oracle is strong enough to make the test case fail with the wrong result.</p>
</div>
<div id="ripr-test" class="listingblock">
<div class="title">Listing 51. A test case able to reveal the fault.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testFirst</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">findLast</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[]{</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">},</span> <span class="tok-mi">0</span><span class="tok-o">));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Not all test cases should discover all faults. Test cases should remain simple as we discussed before. A single test case can not cover all possible execution scenarios and can not discover all potential faults. That is why a test suite should be conformed by many different test cases. These test cases should be carefully designed to select the right input able to reach faults, infect the program state and propagate the infection. Then, test cases need strong oracles to discover the fault. The design of a test suite should be guided by concrete criteria ensuring that these conditions if there is a fault. These criteria not only will ensure the creation of good test cases, they will also provide a concrete way to evaluate the quality of a test suite as a whole.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coverage_criteria_for_test_qualification">3.4.2. Coverage criteria for test qualification</h4>
<div class="paragraph">
<p>Designing tests is hard. We need to choose good inputs to ensure potential faults are <em>reached</em> and that their effects do propagate to an observable point in the program execution. We also need to design strong oracles so the faults can be discovered and we need to know how many test cases our test suite should have to assure certain level of quality in the testing process.Formal <strong>Coverage criteria</strong> help testers solve these problems.</p>
</div>
<div class="paragraph">
<p>According to Ammann and Offutt <a href="#ammann2016introduction">[ammann2016introduction]</a>, a  <em>coverage criterion</em> can be seen as a collection of rules that impose <em>test requirements</em> for a test suite. A <em>test requirement</em> is a specific element of a software artifact that a test case must satisfy or cover.</p>
</div>
<div class="paragraph">
<p>Perhaps the most widely used coverage criterion nowadays in industry is <em>statement coverage</em>. This coverage establishes each program statement as a test requirement, that is, it expects the test suite to execute all statements in the code of the program under test. So, following this criterion we create test cases until all statements are executed by the test suite.</p>
</div>
<div class="paragraph">
<p>In practice it is quite hard, sometimes not even desirable, that all test requirements of a coverage criterion are satisfied or covered by the test suite. For example, making test cases just to execute statements from simple getter methods might be a waste of resources.</p>
</div>
<div class="paragraph">
<p>A coverage criterion has a <em>coverage level</em> associated. The coverage level is the ratio of test requirements that are covered by the test suite. For statement coverage this is the percentage of statements in the program that are executed by the tests.</p>
</div>
<div class="paragraph">
<p>Coverage criteria help testers create more effective and efficient test suites, with fewer tests cases and better fault detection capabilities. Following coverage criteria we are able to better explore the input space. A coverage criterion ensures the traceability from each test case to the test requirements they cover. The purpose of a test case becomes, clear, as it  is designed to cover a specific requirement or a specific set of requirements. Coverage criteria also set a well defined stopping condition for the test creation process and provide an effective way to evaluate the quality of the test suite.</p>
</div>
<div class="paragraph">
<p>The following sections introduce and explain some of the most relevant and known coverage criteria.</p>
</div>
<div class="sect4">
<h5 id="_input_space_partitioning">Input space partitioning</h5>
<div class="paragraph">
<p>The <em>input domain</em> of a system under test is the set of all possible values that the input parameters can take. If there are more than one parameter, then the input domain is the cartesian product of the domains of all parameters. The input domain also includes values that could be incorrect for the program. These are also very important for testing purposes. A test input is then a tuple of values from the domain, one for each parameter.</p>
</div>
<div class="paragraph">
<p>For example, <a href="#isp-findlast">Listing 52</a> shows the signature of the <code>findLast</code> method introduced first in <a href="#ripr-no-infection">Listing 48</a>. This method takes as input an array of integers and an integer. Therefore its input domain is a tuple of all possible integer arrays, including <code>null</code> and empty arrays and all possible integers. Test inputs for this method could be <code>{ array: null, element: 1 }</code>, <code>{ array: {}, element: 2 }</code>, <code>{ array: {1, 2, 3}, element: 4 }</code>.</p>
</div>
<div id="isp-findlast" class="listingblock">
<div class="title">Listing 52. Method from <a href="#ripr-no-infection">Listing 48</a>. The input domain is the tuple of all possible arrays <em>i.e.</em> including a <code>null</code> array, an empty array and so on, and all possible integers.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">findLast</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#isp-isvaliddate">Listing 53</a> shows the signature of a method that takes three integers and says if they form a valid date according to the <a href="https://en.wikipedia.org/wiki/Gregorian_calendar">Gregorian Calendar</a>. The input domain is the set of all possible tuples of three integer elements, including negative integers and zero. Possible test inputs may include: <code>{ day:  1, month:  2, year:  200 }</code>, <code>{ day: 19, month:  9, year: 1983 }</code> or <code>{ day: 33, month: 12, year: 1990 }</code>.</p>
</div>
<div id="isp-isvaliddate" class="listingblock">
<div class="title">Listing 53. A method to check is three integers form a valid date. The input domain is the set of all possible tuples of integers, including negative integers and zero.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isValidDate</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">day</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">month</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#isp-stack">Listing 54</a> shows an extract of the <code>BoundedStack</code> class shown in <a href="#stack-example">Listing 33</a>. In case we are testing methods <code>push</code> and <code>pop</code>, we should consider all possible values of <code>elements</code> and <code>count</code>. That is, when testing classes, instance fields, and even global static fields used by the method are also part of the input. Observe that in this case, <code>elements</code> will never be <code>null</code> since it is created in the constructor.</p>
</div>
<div id="isp-stack" class="listingblock">
<div class="title">Listing 54. Extract from the <code>BoundedStack</code> class presented in <a href="#stack-example">Listing 33</a>. Observe that all values of the fields <code>elements</code> and <code>count</code> form part of the input domain for the <code>push</code> and <code>pop</code> methods.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>
<span class="tok-kd">class</span> <span class="tok-nc">BoundedStack</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">elements</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">count</span><span class="tok-o">;</span>

    <span class="tok-o">...</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-n">elements</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalOperationException</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">item</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">pop</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">elements</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalOperationException</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-k">return</span> <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">];</span>
    <span class="tok-o">}</span>

    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>input space partitioning</em> technique design tests based on a model of the input domain. From this model it is possible to derive several coverage criteria which result in a broad selection of potential test inputs. The technique uses only the interface of the program, the signature of the method or even the specification, but does not need to observe the internal structure of the artifact being tested. In this sense it is said to be a <code>blackbox</code> technique, as opposed to <code>whitebox</code> techniques, that heavily rely on the internal structure, for example, the code of the method.</p>
</div>
<div class="paragraph">
<p>To model the input, this technique creates partitions of the domain. A partition is a subdivision of the domain into subsets or <em>blocks</em> in such a way that the union of all blocks results in the entire input domain and all blocks are disjoint, that is, no element, or test input, can be included in more than one block for the same partition. Each partition is created by identifying characteristics which describe the structure of the input domain. Characteristics and blocks should be designed in such a way that all values in one block are equivalent according to the characteristic that defines the partition.</p>
</div>
<div class="paragraph">
<p>Identifying the right characteristics is hard and requires expertise. There are two main approaches: <em>interface based modeling</em> and <em>functionality based modeling</em>.</p>
</div>
<div class="paragraph">
<p>Interface based modeling considers each parameter separately and takes information only from their specific domain. It is a simple alternative that makes it easier to identify the characteristics. However, it does not use all the information available like the specification and fails to capture the interaction between parameters.</p>
</div>
<div class="paragraph">
<p>Using interface based modeling to describe the input of <code>findLast</code> from <a href="#isp-findlast">Listing 52</a> we may identify the characteristics shown in <a href="#isp-interface-findlast">Table 4</a>. Two characteristics are identified: <em>`array` is <code>null`</em> and <em>`array</code> is empty</em>. Each characteristic defines a partition with two blocks, one to contain the arrays for which the condition of the characteristic is true and another containing arrays for which the characteristic is false.</p>
</div>
<table id="isp-interface-findlast" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Characteristics and blocks identified for <code>findLast</code> from <a href="#isp-findlast">Listing 52</a> considering only the <code>array</code> parameter.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Characteristics</th>
<th class="tableblock halign-left valign-top" colspan="2">Blocks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code> is <code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>True</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>False</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code> is empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>True</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>False</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The same could be done in the parameter <code>element</code>, but it will not yield characteristics interesting enough for the tests. The values of <code>element</code> are irrelevant in isolation. It makes sense to look at them only in relation to the content of <code>array</code>.</p>
</div>
<div class="paragraph">
<p>Functionality based modeling uses semantic information and plays with the specification, the domain of each parameter and the interplay between the values of different parameters. Identifying good characteristics with this approach is harder but may yield better results.</p>
</div>
<div class="paragraph">
<p>For the same <code>findLast</code> method in <a href="#isp-findlast">Listing 52</a>, with this approach we may identify the characteristics in <a href="#isp-functionality-findlast">Table 5</a>. The table shows a characteristic that captures the number of times <code>element</code> appears in <code>array</code> which yields three blocks: one for arrays that do not contain <code>element</code>, one for arrays containing only one occurrence of <code>element</code>, and another for arrays in which <code>element</code> appears more than once. The other two characteristics consider the position of <code>element</code> in the <code>array</code> and each of them yields a partition with two block.</p>
</div>
<table id="isp-functionality-findlast" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Characteristics identified using functionality based modeling for <code>findLast</code> from <a href="#isp-findlast">Listing 52</a>.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Characteristics</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Blocks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times <code>element</code> appears in <code>array</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>element</code> appears in the first position</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>True</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>False</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>element</code> appears in the last position</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>True</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>False</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All characteristics in <a href="#isp-interface-findlast">Table 4</a> and <a href="#isp-functionality-findlast">Table 5</a> could be used in conjunction to design test inputs.</p>
</div>
<div class="paragraph">
<p>Now we shall model the input of <code>isValidDate</code> from <a href="#isp-isvaliddate">Listing 53</a>. We first identify characteristics with the interface based approach. This may yield the following result:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Characteristics</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Blocks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;= 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;= 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;= 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is one characteristic for each parameter and they consider their values separately with respect to their domain. All possible values, valid or invalid are included and all blocks for the same characteristic are disjoint.
Values close to the boundaries between valid and invalid inputs tend to be problematic and often source of bugs. So it is a good idea to include blocks reflecting these values. This way we can expand our initial characteristics as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Characteristics</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Blocks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These blocks may be too broad for testing purposes. Sometimes it is useful to partition blocks into sub-partitions specially in the case of valid inputs.</p>
</div>
<div class="paragraph">
<p>In our example, the meaningful values of <code>month</code> and <code>day</code> depend on each other and the value of <code>year</code>. Actually, the number of valid days depend on the month, and even the year in the case of February, so we turn to a functionality based approach for new characteristics.</p>
</div>
<div class="paragraph">
<p>We first include the notion of leap year and subdivide years greater than 0 into leap and non-leap. Another almost equivalent solution for this could be to add a new characteristic reflecting this condition. We then include a block for valid month numbers and another for valid days which depend on the maximum valid number according to the month, represented as <code>max(month, year)</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Characteristics</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Blocks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid leap year</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid non leap year</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 1 and &lt;= 12]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 1 and &lt;= max(<code>month</code>, <code>year</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; max(<code>month</code>, <code>year</code>)`</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We can go further and sub-partition valid month numbers into groups matching the maximum number of days on each. The result would be as follows:</p>
</div>
<table id="final-partitions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Final partitions and blocks for <code>isValidDate</code>. Each partition and block have been named for future reference.</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2" rowspan="2"><p class="tableblock">Characteristics</p></td>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Blocks</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">b1</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">b2</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">b3</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">b4</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">b5</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">b6</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">q1</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid leap year</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid common year</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">q2</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ 1, 3, 5, 7, 8, 10, 12}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ 4, 6, 9, 11 }</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; 12</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">q3</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 1 and &lt;= max(<code>month</code>, <code>year</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt; max(<code>month</code>, <code>year</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now we have a block for months with 31 days, another for months with 30 days and one for February which is a very special case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice that this is not the only input model that we can design, and it might not even be the optimal. For example, it could be argued that, for this particular method, the blocks where each parameter is zero is equivalent to the blocks where each parameter is negative. <em>There is no silver bullet</em> when it comes to modeling the input. That is why experience and knowledge about the application domain are so important here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the input contains a parameter with a enumerative domain of a few values, it could make sense to create a partition with one block per value. In our example we could have one block for each month, but there is no substantial different among months with the same amount of days for this particular method we are testing.</p>
</div>
<div class="paragraph">
<p>It should be taken into account that, when testing classes, different methods of the same class could share the same characteristics to define partitions. For example, both the <code>push</code> and <code>pop</code> methods in the stack implementation shown in <a href="#stack-example">Listing 33</a> could partition the input considering when the stack is empty or not. Therefore it is a good idea, when testing a class, to first find the characteristics for all methods and reuse them.</p>
</div>
<div class="paragraph">
<p>Once the features and blocks have been identified, the concrete test inputs are built by picking values matching a selection of blocks from different partitions. For example: <code>{day: 1, month: 2, year:2000}</code> is an input matching the third block for each of the partitions identified in <a href="#final-partitions">Table 6</a>, that is, blocks <code>q1b3</code>, <code>q2b3`and `q3b3</code>.</p>
</div>
<div class="paragraph">
<p>Test inputs can be immediately translated to concrete test cases. For example, if we select blocks <code>q1b4</code>, <code>q2b5</code> and <code>q3b4</code> we can pick <code>{ day: 29, month: 2, year: 2019}</code>. The test case could be written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">test29DaysFebruaryCommonYear</span> <span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertFalse</span><span class="tok-o">(</span><span class="tok-n">isValidDate</span><span class="tok-o">(</span><span class="tok-mi">29</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">2019</span><span class="tok-o">),</span> <span class="tok-s">&quot;February in common years should not have more than 28 days.&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how designing test cases from block selections makes the test case clear and helps trace it back to the requirements.</p>
</div>
<div class="paragraph">
<p>The challenge now is to create effective block combinations. For that we can use the following coverage criteria:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Each choice coverage (ECC)</dt>
<dd>
<p>This criterion sets each block from each partition as a test requirement. That is, we must select a set of inputs in such a way that all blocks are represented at least once.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following set of inputs achieve ECC coverage. All blocks from <a href="#final-partitions">Table 6</a> are covered by at least one input:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blocks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ day:  1, month:  1, year:   -1}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>q1b1</code>, <code>q2b3</code>, <code>q3b3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ day: -1, month: -1, year:    0}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>q1b2</code>, <code>q2b1</code>, <code>q3b1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ day:  0, month:  4, year: 2020}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>q1b3</code>, <code>q2b4</code>, <code>q3b2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ day: -2, month:  0, year: 2019}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>q1b4</code>, <code>q2b2</code>, <code>q3b1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ day: 29, month:  2, year: 2019}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>q1b3</code>, <code>q2b5</code>, <code>q3b4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ day:  0, month: 13, year: 2018}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>q1b4</code>, <code>q2b6</code>, <code>q3b2</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Sometimes it is not feasible to select certain blocks at the same time. For example, we should not pick <code>q3b3</code>: <code>day</code> larger than the maximum according to <code>month</code> and <code>year</code>, if <code>month</code> does not have a valid value, for example if we pick <code>q2b1</code>. Such combinations can be dropped when creating test inputs. However, if an input model contains too many of these restrictions it might be a good idea to redesign the partitions.</p>
</div>
<div class="paragraph">
<p>While this coverage criterion is easy to achieve, it may not yield good results, as it may miss interesting combinations between blocks.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">All combinations coverage (ACoC)</dt>
<dd>
<p>As a counterpart to ECC, to meet this criterion we must combine all blocks from all characteristics. This could lead to a very high number of combinations making it impractical. So fewer combinations are desirable. For partitions in <a href="#final-partitions">Table 6</a> this criterion yields 82 test requirements or combinations after dropping unfeasible block selections.</p>
</dd>
<dt class="hdlist1">Pair-wise coverage (PWC)</dt>
<dd>
<p>Instead of all combinations, a value from each block, for each partition must be combined with a value from every block for each other partition. That is, all pair of blocks from different partitions are selected as test requirements. For partitions in <a href="#final-partitions">Table 6</a> this criterion produces 62 test requirements, which can be covered by only 25 inputs. The number of inputs could still be high for some partitions.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An extension of PWC is to combine <code>T</code> characteristics or partitions at the same time (aka. T-wise test case generation), but it has been shown that this does not produce any improvement in practice.</p>
</div>
<div class="paragraph">
<p>Combining more than one invalid value is not useful in general. Most of the times, the program recognizes only of them and the effects of the others are masked. The following two criteria provide a good alternative to avoid that and produce a smaller number of inputs.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Base choice coverage (BCC)</dt>
<dd>
<p>A <em>base choice</em> block is chosen for each partition or characteristic. A <em>base test</em> is formed with the base choice for each partition. Subsequent test inputs are formed by changing only one base choice from this base test and replacing it with another non-base block for the same partition and keeping the others. Base choices should always be the simplest, smallest, most common choices.</p>
</dd>
<dt class="hdlist1">Multiple base choice coverage (MBCC)</dt>
<dd>
<p>It is an extension of the previous criterion. This criterion may select more than one base choice for each partition. An initial test set is built using an ECC coverage on the base choices, then subsequent inputs are formed in the same way as in BCC: by replacing one base choice for another non-base block in the same partition and keeping the others.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For partitions in <a href="#final-partitions">Table 6</a>, we can pick <code>q1b3</code> and <code>q1b4</code> as base choices for the first characteristic, <code>q2b3</code>, <code>q2b4</code>, <code>q2b5</code> for the second and <code>q3b3</code> for the third one. With this setup we could pick the following inputs covering base choices: <code>{ day:  1, month: 3, year: 2019 }</code>, <code>{ day: 30, month: 9, year: 2018 }</code>, <code>{ day: 29, month: 2, year: 2020 }</code>. Then, more inputs could be added by exchanging one basic block by another non-basic choice. For example, if we take <code>{ day: 29, month: 2, year: 2020 }</code>, it matches blocks <code>q1b4</code>, <code>q2b5</code> and <code>q3b3</code>. Changing <code>q3b3</code> by <code>q3b4</code> implies to change the value of <code>day</code> to a value larger than the maximum according to the month. With this we could change 29 by 30 and obtain a new input <code>{ day: 30, month: 2, year: 2020 }</code>. The process continues until no new inputs can be added.</p>
</div>
<div class="paragraph">
<p>Input space partitioning helps defining an initial set of tests inputs. However, the criteria explained in this section do not ensure any of the conditions to discover a fault as stated by the RIPR model.</p>
</div>
</div>
<div class="sect4">
<h5 id="_structural_coverage">Structural coverage</h5>
<div class="paragraph">
<p>As their name implies, <em>structural coverage criteria</em> rely on the internal structure of the artifact under test, that is, the code of the method, class or complete program we are testing. This section present some of the more commonly used criteria in this category.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Statement coverage</dt>
<dd>
<p>The simplest structural criterion is <strong>statement coverage</strong>. This criterion establishes each statement in a program as a test requirement, that is, the test suite should be designed in such a way that all statements in the program are executed by at least one test case. In this way it ensures the <em>reachability</em> of the RIPR model. If all statements are covered, then all potential faults will be reached.</p>
<div class="paragraph">
<p>It is a simple criterion, easy to interpret and also very easy and fast to compute. Nowadays, most practitioners use the <em>statement coverage level</em>, that is, the ratio of statements executed by the test suite as a proxy for the quality of their tests. The practice is so common that the statement coverage level is known as <em>code coverage</em> or simply <em>coverage</em>. There are many available tools to compute code coverage and they are supported by most mainstream IDEs and CI/CD servers.</p>
</div>
<div class="paragraph">
<p><a href="#findlast-coverage-found">Listing 55</a> highlights the statements executed/covered/reached by the test case shown in <a href="#ripr-no-infection">Listing 48</a> on the code of the method included in <a href="#ripr-faulty-program">Listing 46</a>. With coverage information it is easy to see that, in the absence of more test cases, we miss a test where the element could not be found in the array, as the last statement is not executed.</p>
</div>
<div id="findlast-coverage-found" class="listingblock">
<div class="title">Listing 55. Statements covered by the test case in <a href="#ripr-no-infection">Listing 48</a> on the code of the method from <a href="#ripr-faulty-program">Listing 46</a>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><pre><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">findLast</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="hll">    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">--)</span> <span class="tok-o">{</span>
</span><span class="hll">        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">element</span><span class="tok-o">)</span>
</span><span class="hll">            <span class="tok-k">return</span> <span class="tok-n">i</span><span class="tok-o">;</span>
</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The last statement can be covered by a test case such as the one shown in <a href="#ripr-no-propagation">Listing 49</a>. <a href="#findlast-coverage-not-found">Listing 56</a> highlights the statements covered by this test case on the code from <a href="#ripr-faulty-program">Listing 46</a>.</p>
</div>
<div id="findlast-coverage-not-found" class="listingblock">
<div class="title">Listing 56.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><pre><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">findLast</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="hll">    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">--)</span> <span class="tok-o">{</span>
</span><span class="hll">        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">element</span><span class="tok-o">)</span>
</span>            <span class="tok-k">return</span> <span class="tok-n">i</span><span class="tok-o">;</span>

    <span class="tok-o">}</span>
<span class="hll">    <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span>
</span><span class="tok-o">}</span>
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that both test cases together cover all the instructions of the method. However they are not able to discover the fault. This criterion ensures reachability but does not ensure any of the other conditions for the fault to be found. It is extremely useful to rapidly known which pieces of code haven&#8217;t been tested but is not a good quality metric for a test suite.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Other structural criteria can be defined over the control flow graph of a method or a sequence of instructions. Recalling the procedure explained in <a href="#cyclomatic">[cyclomatic]</a>, the control flow graph of a method is built as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initially, the graph has two special nodes: the <em>start</em> node and the <em>end</em> node.</p>
</li>
<li>
<p>A sequence of instructions with no branches is called a <em>basic block</em>. Each basic block becomes a node of the graph.</p>
</li>
<li>
<p>Each branch in the code becomes an edge. The direction of edge coincides with the direction of the branch.</p>
</li>
<li>
<p>There is an edge from the start node to the node with the first instruction.</p>
</li>
<li>
<p>There is an edge from all nodes that could terminate the execution of the code, to the end node.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#control-flow-findlast">Figure 14</a> shows the control flow of the <code>findLast</code> method presented in <a href="#ripr-faulty-program">Listing 46</a>.</p>
</div>
<div id="control-flow-findlast" class="imageblock">
<div class="content">
<img src="images/control-flow-findlast.png" alt="control flow findlast" width="453" height="583">
</div>
<div class="title">Figure 14. Control flow graph from the <code>findLast</code> method, presented in <a href="#ripr-faulty-program">Listing 46</a>.</div>
</div>
<div class="paragraph">
<p>The execution of a test case produces an <em>execution path</em> or <em>execution test</em> over the control flow graph. This path goes from the <code>start</code> node to the <code>end</code> node and includes all nodes containing instructions executed by the test case and all edges connecting those nodes.</p>
</div>
<div class="paragraph">
<p>For example, the test case in <a href="#ripr-no-infection">Listing 48</a> produces the following path <code>start &#8658; (1) &#8658; (2) &#8658; (3) &#8658; (5) &#8658; end</code>. With this path, the test case covers the nodes/blocks <code>(1)</code>, <code>(2)</code>, <code>(3)</code> and <code>(5)</code>. Nodes <code>start</code> and <code>end</code> are covered by all execution paths. The same path covers edges <code>start &#8658; (1)</code>, <code>(1) &#8658; (2)</code>, <code>(2) &#8658; (3)</code>, <code>(3) &#8658; (5)</code>, <code>(5) &#8658; end</code>. The test does not cover nodes <code>(4)</code> and <code>(6)</code> and edges <code>(3) &#8658; (4)</code>, <code>(4) &#8658; (2)</code>, <code>(2) &#8658; (6)</code> and <code>(6) &#8658; end</code>. <a href="#coverage-over-cfg">Figure 15</a> shows in blue the elements covered by this test case in the graph.</p>
</div>
<div id="coverage-over-cfg" class="imageblock">
<div class="content">
<img src="images/coverage-over-cfg.png" alt="coverage over cfg" width="453" height="583">
</div>
<div class="title">Figure 15. In blue we show the elements of the control flow graph from <a href="#ripr-faulty-program">Listing 46</a> covered by the execution of the tests case shown in <a href="#ripr-no-infection">Listing 48</a>.</div>
</div>
<div class="paragraph">
<p>The following coverage criteria are precisely defined over the nodes, edges and paths of a control flow graph.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Block coverage</dt>
<dd>
<p>With <strong>block coverage</strong> we consider each basic block or control flow graph node as a test requirement. This is very related to statement coverage, as basic blocks guarantee that if one instruction from the block is executed, all the other instructions in the same block will be executed as well. In fact, some tools actually compute block coverage to report statement coverage. In the example discussed before, the test from <a href="#ripr-no-propagation">Listing 49</a> was able to cover all blocks but nodes <code>(4)</code> and <code>(6)</code>.</p>
</dd>
<dt class="hdlist1">Branch coverage</dt>
<dd>
<p>This criterion sets branches in the program, that is, edges in the control flow graph as test requirements. Instead of the nodes, here we consider the edges in the execution paths. It helps determine whether all outcomes from decision branches have been explored by the test cases. In the example discussed before, the test from <a href="#ripr-no-propagation">Listing 49</a> was able to cover all edges but <code>(3) &#8658; (4)</code>, <code>(4) &#8658; (2)</code>, <code>(2) &#8658; (6)</code> and <code>(6) &#8658; end</code>.</p>
</dd>
<dt class="hdlist1">Path coverage</dt>
<dd>
<p>This criterion sets all possible execution paths as test requirements. That is, we aim to design a test suite that traces all execution paths in the control flow graph. Executing all possible paths leads to exhaustive testing, and this is, however ideal, not possible in practice. For example, if the control flow graph contains a loop as in <a href="#control-flow-findlast">Figure 14</a> the number of possible execution paths is infinite. Therefore, we need to select which paths to cover in practice. The two following criteria are examples of how to select which paths to execute.</p>
</dd>
<dt class="hdlist1">Path basis testing</dt>
<dd>
<p>A directed graph is said to be <em>strongly connected</em> if for every pair of nodes we can find a path that starts in the first node and ends in the second node. A control flow graph can be made strongly connected if we add a bogus edge from the end node to the star node. A circuit in a graph is which ends at the same node it begins.</p>
<div class="paragraph">
<p>If we add the bogus edge, the execution of the test case in <a href="#ripr-no-infection">Listing 48</a> produces the circuit <code>start &#8658; (1) &#8658; (2) &#8658; (3) &#8658; (5) &#8658; end &#8658; start</code>.</p>
</div>
<div class="paragraph">
<p>A set of circuits from a graph is said to be linearly independent if all of the circuits differ in at least one edge. This set of circuits is said to be a basis for all circuits in the graph if all edges are included in at least one circuit from the set. All circuits in the graph can be formed by combining circuits in the base.</p>
</div>
<div class="paragraph">
<p>If a directed graph is strongly connected, then, the cyclomatic complexity, as discussed in <a href="#cyclomatic-section">Section 2.1.3.2</a>, is equal to the maximum number of linearly independent circuits, that is, the number of circuits in the base. The basis is not unique. In general we can find more than one basis for the same graph.</p>
</div>
<div class="paragraph">
<p>For the graph in <a href="#control-flow-findlast">Figure 14</a> the number of circuits in the basis is 3 which is the number of conditionals: 2 plus 1. The following could be a basis of circuits:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>start &#8658; (1) &#8658; (2) &#8658; (3) &#8658; (5) &#8658; end &#8658; start</code></p>
</li>
<li>
<p><code>start &#8658; (1) &#8658; (2) &#8658; (6) &#8658; end &#8658; start</code></p>
</li>
<li>
<p><code>(2) &#8658; (3) &#8658; (4) &#8658; (2)</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If we set all linearly independent circuits as test requirements, then we create a test for each circuit in the base and we ensure that we are testing, at least once, each outcome from a decision or conditional node. For example, the test case in <a href="#ripr-no-infection">Listing 48</a> covers the first circuit in the basis, in which the element appears in the last position. Testing with an empty array would cover the second circuit in the basis. Any test case that loops over the array covers the third and last circuit in the basis, such as the test case in <a href="#ripr-no-propagation">Listing 49</a>. See that with these three test cases we are able to cover the entire basis but we still do not reveal the fault.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The cyclomatic complexity sets a lower bound for the number of different tests executing all branches. In this example the cyclomatic complexity is 3 which is also the number of test cases that cover the basis.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Prime path coverage</dt>
<dd>
<p>A <em>simple path</em> in a graph is a path where no node appears more than once, except perhaps the first node, that could be also the last one. A <em>prime path</em> in a graph is a simple path that is no proper sub-path of any other simple path. This means that a prime path is a simple maximal path.</p>
<div class="paragraph">
<p>In <a href="#control-flow-findlast">Figure 14</a> <code>(2) &#8658; (3) &#8658; (4) &#8658; (2)</code> is a prime path that starts and ends in <code>(2)</code>. Computing all prime paths from a graph is simple. We start with all edges, which are simple paths of length one. From there we form more simple paths by adding edges until we reach the initial node, there are no more edges to add or the next node already appears somewhere in the path. Finally, we keep the paths that are no proper sub-paths of any other. For the graph of the example the prime paths are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>start &#8658; (1) &#8658; (2) &#8658; (3) &#8658; (5) &#8658; end</code></p>
</li>
<li>
<p><code>start &#8658; (1) &#8658; (2) &#8658; (6) &#8658; end</code></p>
</li>
<li>
<p><code>start &#8658; (1) &#8658; (2) &#8658; (3) &#8658; (4)</code></p>
</li>
<li>
<p><code>(4) &#8658; (2) &#8658; (3) &#8658; (5) &#8658; end</code></p>
</li>
<li>
<p><code>(3) &#8658; (4) &#8658; (2) &#8658; (6) &#8658; end</code></p>
</li>
<li>
<p><code>(2) &#8658; (3) &#8658; (4) &#8658; (2)</code></p>
</li>
<li>
<p><code>(4) &#8658; (2) &#8658; (3) &#8658; (4)</code></p>
</li>
<li>
<p><code>(3) &#8658; (4) &#8658; (2) &#8658; (3)</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Prime path coverage sets each prime path as a test requirement. That is, at least one test case should cover each prime path. For example, <a href="#ripr-no-infection">Listing 48</a> covers the first prime path of the list. The test case in <a href="#ripr-no-propagation">Listing 49</a> produces the following path: <code>start &#8658; (1) &#8658; (2) &#8658; (3) &#8658; (4) &#8658; (2) &#8658; (3) &#8658; (4) &#8658; (2) &#8658; (6) &#8658; end</code>. This test traces the entire array and does not find the element. It is able to cover prime paths 3, 5, 6, 7 and 8 from the list above. This criterion is useful when testing loops in a program. It ensures the creation of tests cases that skip the loops and test cases that execute several iterations of each loop. In our example, prime path 2 corresponds to a scenario where the <code>for</code> loop is never entered, <em>i.e.</em> <code>array</code> is empty. The execution of prime paths 6, 7, 8 produces tests performing more than one iteration.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Many software artifacts can be represented as graphs. As an example, <em>Finite State Machines</em> are a special type of graph that have been widely used to represent the behavior of software elements. Actually, most embedded software is modeled as a state machine. Finite state machines can also be used to describe specifications for software and even how a user interface should behave.</p>
</div>
<div class="paragraph">
<p>In a finite state machine, a node represent a state of the artifact and edges represent changes in those states. As an example, recall <a href="#microwave">Figure 5</a> where a state machine was used to model the behavior of a microwave oven.</p>
</div>
<div class="paragraph">
<p>The structural criteria defined over the control flow graph of a method can be extended to any type of graph. Branch coverage can be generalized as <em>edge coverage</em> and block coverage is just a special case of <em>node coverage</em>. In the particular case of finite state machines, designing test cases to achieve edge coverage ensures that all state transitions are explored and targeting node coverage ensures that all possible states of the artifact have been observed in at least one test case.</p>
</div>
<div class="paragraph">
<p>But, as explained before, the structural criteria discussed in this section only ensure that most parts of the software under test are executed. Therefore they guarantee that, if there is a fault, it will be executed by at least one test case. However, these criteria do not ensure that the input will infect the program state, or that the effects will be propagated to an observable point or that there will be an oracle strong enough observing the right portion of the state.</p>
</div>
</div>
<div class="sect4">
<h5 id="_logic_coverage">Logic coverage</h5>
<div class="paragraph">
<p>A predicate is a boolean expression. They are used in all kinds of software. Predicates define branches in source code and also define the state of finite state machines like the microwave oven in <a href="#microwave">Figure 5</a>.</p>
</div>
<div class="paragraph">
<p>The coverage criteria presented in this section are designed specifically for predicates. They are also designed in such a way that, if there is a fault, test cases created with the help of these criteria guarantee that the state of the program will be, at least, infected by the fault. This means that, if there is a fault in the code of the predicate, there will be at least one test case where the predicate will produce the wrong result.</p>
</div>
<div class="paragraph">
<p>A predicate is defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A clause is a predicate. Clauses are the shortest predicates. They are the simplest boolean expressions that do not contain logical operators. They can be:</p>
<div class="ulist">
<ul>
<li>
<p>a variable reference <em>i.e.</em> \$a\$</p>
</li>
<li>
<p>a comparison or any other relational expression <em>i.e</em> \$a &lt; 3\$, \$a = b\$</p>
</li>
<li>
<p>a function call <em>i.e.</em> \$f(a, b+3)\$</p>
</li>
</ul>
</div>
</li>
<li>
<p>If \$p\$ and \$q\$ are predicates, then the following are also predicates:</p>
<div class="ulist">
<ul>
<li>
<p>\$\neg p\$ (negation)</p>
</li>
<li>
<p>\$p \wedge q\$ (conjunction)</p>
</li>
<li>
<p>\$p \vee q\$ (disjunction)</p>
</li>
<li>
<p>\$p \implies q\$ (implication)</p>
</li>
<li>
<p>\$p \iff q\$ (equivalence)</p>
</li>
<li>
<p>\$p \oplus q\$ (exclusive disjunction)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>\$ a &lt; 3 \vee c \implies fn(b)\$ is a predicate with three clauses: \$a &lt; 3\$, \$c\$ and \$fn(b)\$.</p>
</div>
<div class="paragraph">
<p><a href="#isleapyear-predicate">Listing 57</a> shows the <code>isLeapYear</code> method which implements a predicate to determine if a given integer represents a leap year or not. The predicate has three clauses, \$c_400\$: <code>year % 400 == 0</code>, \$c_4\$ <code>year % 4 == 0</code> and we conveniently represent <code>year % 100 == 0</code> as \$c_100\$ \$c_100\$: <code>year % 100 == 0</code> negated. In this example the clauses are not independent from each other. Also, given the short-circuit behavior of logical operators in most programming languages, the order in which the clauses are evaluated play a role in the evaluation of the predicate.</p>
</div>
<div id="isleapyear-predicate" class="listingblock">
<div class="title">Listing 57. A method that says if a given integer value corresponds to a leap year or not.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isLeapYear</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">400</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">4</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">100</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The simplest logic coverage criteria sets test requirements according to the value that takes the predicate as a whole and the value of each clause.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Predicate Coverage (PC)</dt>
<dd>
<p>This coverage criterion sets two test requirements: one on which the predicate evaluates to <code>true</code> and another where the predicate evaluates to <code>false</code>.</p>
<div class="paragraph">
<p>To fulfill this criterion we require only two inputs one making the predicate <code>true</code> and another making the predicate <code>false</code>. It is a simple criterion but the clauses are not considered individually. Taking the predicate, \$((a &gt; b) \wedge C) \vee p(x)\$ we can cover both requirements with \$(a = 5, b = 4, C = true, p(x) = true)\$ and \$(a = 5, b = 4, C = false, p(x) = true)\$, however, in both interpretations, the first and last clauses of the predicate have always the same value.</p>
</div>
</dd>
<dt class="hdlist1">Clause Coverage (CC)</dt>
<dd>
<p>This criterion sets two test requirements for each clause in a predicate. For one requirement, the selected clause should be <code>true</code> and for the other the same clause should be false <code>false</code>.</p>
<div class="paragraph">
<p>For the predicate \$((a &gt; b) \wedge C) \vee p(x)\$ we have six requirements, two for each clause. The criterion can be covered using the following two sets of values: \$(a = 5, b = 4, C = true, p(x) = true)\$ and \$(a = 5, b = 6, C = false, p(x) = false)\$. The first set of values covers all requirements where clauses are <code>true</code> and the second covers the scenarios where the clauses evaluate to <code>false</code>. So, with only two inputs it is possible to cover all six requirements.</p>
</div>
<div class="paragraph">
<p>This criterion does enforce combinations between the clauses. Also, it is possible to fulfill clause coverage and not predicate coverage at the same time. Take as example the predicate \$a \vee b\$. Using \$a = true, b = false)\$ and \$(a = false, b = true)\$ we can cover all clauses but the predicate always evaluates to <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1">Combinatorial Coverage (CoC)</dt>
<dd>
<p>This criterion sets a test requirement for each combination or truth value of all clauses.</p>
<div class="paragraph">
<p>For example, for the predicate \$[((a &gt; b) \wedge C) \vee p(x)\$] we create the following test requirements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$a &gt; b\$</th>
<th class="tableblock halign-left valign-top">\$C\$</th>
<th class="tableblock halign-left valign-top">\$p(x)\$</th>
<th class="tableblock halign-left valign-top">\$((a &gt; b) \wedge C) \vee p(x)\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This criterion accounts for any truth value combination of all clauses and ensures all possible values for the predicate. However, it is not feasible in practice for large predicates. The number of requirements is exponential with respect to the number of clauses in the predicate, that is  we have \$2^N\$ requirements for \$N\$ clauses.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>So, we need a set of criteria able to evaluate the effects of each clause over the result of the predicate while keeping the number of test requirements reasonable low.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Active Clause Coverage</dt>
<dd>
<p>This criterion verifies each clause under conditions where they affect the value of the entire predicate. When we select a clause, we call it a <em>major clause</em> and rest are called <em>minor clauses</em>. So when defining the requirements for this criterion each clause become <em>major</em> at some point.</p>
<div class="paragraph">
<p>A major clause <em>determines</em> the predicate if the minor clauses have values such that changing the truth value of the major clause also changes the value of the predicate.</p>
</div>
<div class="paragraph">
<p>For the predicate  \$((a &gt; b) \wedge C) \vee p(x)\$ if we select \$a &gt; b\$ as the major clause, \$C\$ and \$p(x)\$ are the minor clauses. If we assign values \$(C = true, p(x) = false)\$ to the minor clauses, \$a &gt; b\$ determines the predicate because, when the major clause is <code>true</code> the entire predicate is <code>true</code> and when the major clause is <code>false</code> the predicate evaluates to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>This criterion selects each clause in the predicate as a major clause. Then, for each major clause \$c\$, we select values for the minor clauses in a way that \$c\$ determines the predicate. Then the criterion sets one test requirement for \$c = true\$ and another for \$c = false\$.</p>
</div>
<div class="paragraph">
<p>For example, for the predicate \$p = a \vee b\$ is easy to see that each clause determines the predicate when the other is <code>false</code>. So, selecting \$a\$ as the major clause we obtain requirements \$(a = true, b = false)\$ and \$(a = false, b = false)\$. We proceed in a similar way with clause \$b\$ and obtain \$(a = false, b = true)\$ and \$(a = false, b = false)\$. One of the requirements is common for both clauses, so in the end we have three test requirements \$(a = true, b = false)\$, \$(a = false, b = true)\$ and \$(a = false, b = false)\$.</p>
</div>
<div class="paragraph">
<p>A major challenge for the active clause criterion is the handling of the minor clauses. We need first to obtain the possible values for the minor clauses to make the major clause determine the predicate.</p>
</div>
<div class="paragraph">
<p>Given a predicate \$p\$ and a major clause \$c \in p\$, the predicate \$p_c = p_{c=true} \oplus p_{c=false}\$ represents the condition for \$c\$ to determine \$p\$. That is, the values of the minor clauses that make \$p_c\$ be <code>true</code> also make \$c\$ determine \$p\$.</p>
</div>
<div class="paragraph">
<p>The following examples illustrate how to use this result to find the values for the minor clauses.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The following examples make heavy use of <a href="https://en.wikipedia.org/wiki/Boolean_algebra"><em>Boolean Algebra</em></a>. It would be better to refresh the main rules before going any further.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Take the predicate \$p = a \vee b\$, selecting \$a\$ as the major clause we need to find a condition for \$b\$ so \$a\$ dominates the predicate. We proceed as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{eqnarray*}
    p_a &amp; = &amp; p_{a=true} \oplus p_{a=false} \\
        &amp; = &amp; (true \vee b) \oplus (false \vee b) \\
        &amp; = &amp; true \oplus b \\
        &amp; = &amp; \neg b
\end{eqnarray*}\]
</div>
</div>
<div class="paragraph">
<p>Which means that \$a\$ determines the predicate, only when \$b\$ is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take now the predicate \$p = a \wedge (b \vee c)\$ and again \$a\$ as the major clause. We obtain:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{eqnarray*}
    p_a &amp; = &amp; p_{a=true} \oplus p_{a=false} \\
        &amp; = &amp; (true \wedge (b \vee c)) \oplus (false \wedge (b \vee c)) \\
        &amp; = &amp; (b \vee c) \oplus false \\
        &amp; = &amp; (b \vee c)
\end{eqnarray*}\]
</div>
</div>
<div class="paragraph">
<p>This means that any values for \$b\$ or \$c\$ making \$b \vee c\$ <code>true</code> will also make \$a\$ determine \$p\$. In this case we could use \$(b = true, c = true)\$, \$(b = false, c = true)\$ or \$(b = true, c = false)\$.</p>
</div>
<div class="paragraph">
<p>On another example, if we take \$p = a \iff b\$, we obtain:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{eqnarray*}
    p_a &amp; = &amp; p_{a=true} \oplus p_{a=false} \\
        &amp; = &amp; (true \iff b) \oplus (false \iff b) \\
        &amp; = &amp; b \oplus \neg b \\
        &amp; = &amp; true
\end{eqnarray*}\]
</div>
</div>
<div class="paragraph">
<p>We observe that \$p_a\$ is always <code>true</code>. Therefore, \$a\$ determines \$p\$ no matter the value of \$b\$. On the other hand, it could be that \$p_a\$ would result in <code>false</code>. In that case it would be impossible for the clause \$a\$ to determine \$p\$.</p>
</div>
<div class="paragraph">
<p>As seen in the examples above, we can obtain four possible outcome when finding the condition for a major clause to determine the predicate: <strong>(1)</strong> the clause can not determine the predicate,
<strong>(2)</strong> there is only one possible assignment (also known as interpretation) for the values of the minor clauses, <strong>(3)</strong> there is more than one possible interpretation and <strong>(4)</strong> the clause always determines the predicate.</p>
</div>
<div class="paragraph">
<p>ACC sets two test requirements for each major clause: one in which the clause is <code>true</code> and another in which the clause is <code>false</code>. If there is more than one possible interpretation for the minor clauses we may decide to use different values on each requirement or force the same values of the minor clauses. If we force the use of the same values for the minor clauses, then we are using what is known as <strong>Restricted Active Clause Coverage</strong> (RACC). This is a stronger criterion but it can not be always satisfied when clauses are not independent.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In fact, it could be possible that a test requirement becomes infeasible due to dependencies between the clauses for any of the previous coverage criteria. Given the case, we simply discard those inputs.</p>
</div>
<div class="paragraph">
<p>The literature often describes <em>Modified Condition/Decision Coverage</em> (MC/DC). This coverage criterion is defined as follows <a href="#comar2012formalization">(58)</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
Every point of entry and exit in the program has been invoked at least once, every condition in a decision in the program has taken all possible outcomes at least once, every decision in the program has taken all possible outcomes at least once, and each condition in a decision has been shown to independently affect that decisionâs outcome. A condition is shown to independently affect a decisionâs outcome by varying just that condition while holding fixed all other possible conditions.
</blockquote>
</div>
<div class="paragraph">
<p>In this definition, a <em>decision</em> is a predicate and a <em>condition</em> is a clause. Therefore, achieving RACC for all predicates in a program ensures MC/DC.</p>
</div>
<div class="paragraph">
<p>Now, we use ACC to derive test requirements for the method in <a href="#isleapyear-predicate">Listing 57</a>. We rewrite the predicate encoded in the method as \$p = c_400 \vee (c_4 \wedge \neg c_100)\$, where \$c_x\$ is equivalent to <code>year % x == 0</code>.</p>
</div>
<div class="paragraph">
<p>Selecting \$c_400\$ as the major clause we obtain \$p_{c_400} = \neg c_4 \vee c_100\$. The following table shows the values, or interpretations of the clauses that make \$p_{c_400}\$ <code>true</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p_{c_400}\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>But, these clauses are not independent. In fact the first row of the table is not feasible. The same number can not be divisible by 100 (\$c_100 = true\$) and not by 4 (\$c_4 = false\$). Therefore we throw it away and keep only the two last rows, which leads us to the following truth values for \$p\$:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Again, the clauses are not independent in this example. The fourth row also lead to and impossible situations so we keep only the rest.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For this clause we can pick the the first and second rows to satisfy RACC.</p>
</div>
<div class="paragraph">
<p>Now we select \$c_4\$ as the major clause and obtain \$p_{c_4} = \neg c_100 \wedge \neg c_400\$ which is <code>true</code> only for the following interpretation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$p_{c_4}\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Therefore, we obtain the following two additional test cases:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Finally we pick \$c_100\$ as the major clause obtaining \$p_{c_100} = \neg C_400 \wedge c_4\$. The only possible interpretation to make \$c_100\$ dominate the predicate is:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$p_{c_100}\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Which leads to the following test cases:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some of the test cases for different clauses are the same, so we combine them and obtain as final requirements the following inputs:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p\$</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the end we have created four different test cases. Ensuring ACC, also ensures PC and CC and produces fewer tests than CoC while observing the effect of each clause.</p>
</div>
<div class="paragraph">
<p>The inputs created above have to interpreted with respect to <code>year</code> which is the actual parameter of the method and defines the value of all clauses and their relationship. To satisfy the first requirement in the table above we need a value that is divisible by 4, 100 and 400 at the same time, which actually means that we need a value divisible by 400 as it implies the other two conditions. For the second requirement we need a value divisible by 100 but not by 400. The third row requires a value not divisible by 4 and the last needs one divisible by 4 but not by 100. The following table summarizes the result:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">\$c_400\$</th>
<th class="tableblock halign-left valign-top">\$c_4\$</th>
<th class="tableblock halign-left valign-top">\$c_100\$</th>
<th class="tableblock halign-left valign-top">\$p\$</th>
<th class="tableblock halign-left valign-top"><code>year</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1900</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2017</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here we picked values that resemble recent years to be closer to the intention of the method. We could have picked, 400, 100, 3 and 4 as well but these values are not so intention revealing as the others.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mutation_testing">Mutation testing</h5>
<div class="paragraph">
<p>We can use the coverage criteria studied so far to select meaningful sets of test inputs, to create test cases able to reach most potential faults and even to guarantee the program state infection for predicates. However, they do not ensure the creation of test cases able to reveal faults. In particular they do not consider the propagation and revealability conditions of the RIPR model. As an extreme example, we could remove all the assertions in a test suite. The test suite will be able to cover the same number of statements as before while it will loose its ability to evaluate the result of the tests. See for instance, that removing the assertion invocation in <a href="#ripr-test">Listing 51</a> leaving the method invocation, will produce the same coverage for <code>findLast</code>, but it will not uncover the fault anymore. Statement coverage, is useful to discover the code that is not tested but it is not good when it comes to evaluate the capability of the test suite to reveal bugs, which is, in the end, the main purpose of testing.</p>
</div>
<div class="paragraph">
<p><em>Mutation testing</em> or <em>mutation analysis</em> is a coverage criterion that directly assesses the capability of a test suite to discover bugs. It was first proposed in by DeMillo <em>et.al.</em> in the late 70&#8217;s of the last century <a href="#demillo1978hints">(59)</a>.</p>
</div>
<div class="paragraph">
<p>The idea behind this criterion is simple: if a test suite should reveal bugs, then we can assess how effective it is by using artificial faults. That is, we insert  artificial faults in the program and then we execute the test suite for each fault. The test suite should fail under these conditions, otherwise it needs to be improved.</p>
</div>
<div class="paragraph">
<p>By inserting the artificial fault we <em>mutate</em> the original program to create a faulty version. This version is called a <em>mutant</em>. If there is at least one test case in the test suite that fails when it is executed with the mutant, then the mutant is considered as detected and it is said to be <em>killed</em>. Otherwise it is a <em>live</em> mutant. As a coverage criterion, mutation testing targets all live mutants as test requirements. This means that we design test cases to fail with those mutants that are not detected by the current set of test cases.</p>
</div>
<div class="paragraph">
<p>The <em>mutation score</em> is the ratio of killed mutants to the total number of mutants used. It is the the coverage level for this criterion and it is often used to quantitatively evaluate the bug revealing capabilities of a test suite. We aim to design test suite with high mutation score.</p>
</div>
<div class="paragraph">
<p>In general, mutation testing works under following two assumptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Programmers create programs that are close to being correct (<em>The competent programmer hypothesis</em>) and</p>
</li>
<li>
<p>A test suite that detects all simple faults can detect most complex faults. That is, complex errors are coupled to simple errors. (<em>The coupling effect</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, to create a mutant, mutation testing inserts only small and well localized syntactic changes. These changes follow predefined fault or transformation models called <em>mutation operators</em>. A mutation operator could, for example, change <code>+</code> by <code>-</code> in an arithmetic expression. Other operators may change a comparison operator, for example <code>&gt;</code> by <code>&gt;=</code>, change a constant in the code, for example, change any constant by <code>0</code>, remove a method invocation and so on.</p>
</div>
<div class="paragraph">
<p><a href="#mutation-testing-algorithm">[mutation-testing-algorithm]</a> shows in pseudo-code how mutation testing works. The procedure takes as input a program under test, the test suite designed to verify the program and a set of mutation testing operators. All mutation operators are used to create a set of mutants. Each mutant is then challenged against the test suite. If the test suite does not fail when executing a mutant, the faulty program version is kept as a <em>live mutant</em>. In the end, the procedure reports the list of live mutants and the mutation score.</p>
</div>
<div id="mutantion-testing-algorithm" class="listingblock">
<div class="title">Listing 58. Pseudo-code of the mutation testing process.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-nb">input</span><span class="tok-p">:</span> <span class="tok-n">program</span><span class="tok-p">,</span> <span class="tok-n">test_suite</span><span class="tok-p">,</span> <span class="tok-n">mutation_operators</span>
<span class="tok-n">ouput</span><span class="tok-p">:</span> <span class="tok-n">live_mutants</span><span class="tok-p">,</span> <span class="tok-n">mutation_score</span>
<span class="tok-n">procedure</span><span class="tok-p">:</span>
    <span class="tok-n">live_mutants</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>
    <span class="tok-k">for</span> <span class="tok-n">mutant</span> <span class="tok-ow">in</span> <span class="tok-n">generate_mutants</span><span class="tok-p">(</span><span class="tok-n">program</span><span class="tok-p">,</span> <span class="tok-n">mutation_operators</span><span class="tok-p">):</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-n">fails</span> <span class="tok-o">=</span> <span class="tok-n">execute</span><span class="tok-p">(</span><span class="tok-n">test_suite</span><span class="tok-p">,</span> <span class="tok-n">mutant</span><span class="tok-p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">fails</span><span class="tok-p">:</span>
            <span class="tok-n">live_mutants</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-n">mutant</span><span class="tok-p">)</span>
    <span class="tok-n">mutation_score</span> <span class="tok-o">=</span> <span class="tok-n">size</span><span class="tok-p">(</span><span class="tok-n">live_mutants</span><span class="tok-p">)</span><span class="tok-o">/</span><span class="tok-n">size</span><span class="tok-p">(</span><span class="tok-n">mutants</span><span class="tok-p">)</span>
    <span class="tok-k">return</span>  <span class="tok-n">live_mutants</span><span class="tok-p">,</span> <span class="tok-n">mutation_score</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create mutants based on the mutation operators.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Execute the entire test suite with the mutant. <code>fails</code> is <code>false</code> if no test case failed in the execution.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The procedure returns the set of live mutants and the mutation score.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To illustrate the functioning of mutation testing we go back to the code of <a href="#stack-example">Listing 33</a>. We will consider the <code>BoundedStack</code> class as the program under test. <a href="#mutants-test-suite-example">Listing 59</a> shows the test suite we shall evaluate with the help of mutation testing. This test suite contains only two test cases: one verifying the <code>push</code> method and another verifying the <code>pop</code> method.</p>
</div>
<div id="mutants-test-suite-example" class="listingblock">
<div class="title">Listing 59. Test suite to evaluate using mutation testing.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BoundedStackTest</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPush</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">BoundedStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BoundedStack</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
        <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">BoundedStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BoundedStack</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
        <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
        <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
        <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the following four mutation operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Negate the boolean expression of conditional statements.</p>
</li>
<li>
<p>Replace <code>+</code> by <code>-</code> in arithmetic expressions.</p>
</li>
<li>
<p>Replace <code>-</code> by <code>+</code> in arithmetic expressions.</p>
</li>
<li>
<p>If a method returns an integer, we change the return value by <code>0</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#mutants-stack-example">Listing 60</a> shows the same <code>BoundedStack</code> class as in <a href="#stack-example">Listing 33</a> and highlights are the locations where the artificial faults are inserted to create the mutants.</p>
</div>
<div id="mutants-stack-example" class="listingblock">
<div class="title">Listing 60. Examples of mutants created for the <code>BoundedStack</code> shown in <a href="#stack-example">Listing 33</a>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BoundedStack</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">elements</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">count</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">BoundedStack</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">capacity</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">elements</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">capacity</span><span class="tok-o">];</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-n">elements</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalStateException</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">item</span><span class="tok-o">;</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">NoSuchElementException</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
        <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tok-k">return</span> <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">];</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">count</span><span class="tok-o">;</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">capacity</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">elements</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Negate the conditional: <code>count != elements.length</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Replace <code>+</code> by <code>-</code>: <code>count = count - 1</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Negate the conditional: <code>count != 0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Replace <code>+</code> by <code>-</code>: <code>count = count + 1</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Replace the result by <code>0</code>: <code>return 0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Replace the result by <code>0</code>: <code>return 0</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Replace the result by <code>0</code>: <code>return 0</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the four mutation operators we obtain seven mutants in total. Two mutants, (&lt;1&gt; and &lt;3&gt;) are produced by negating conditionals inside <code>push</code> and <code>pop</code>. A mutant (&lt;2&gt;) is produced by changing the arithmetic operator in the increment inside <code>push</code> and another by changing the decrement inside <code>pop</code> (&lt;4&gt;). The other three are created by changing the result of <code>pop</code>, <code>size</code> and <code>capacity</code>. No fault was inserted in the constructor of the class.</p>
</div>
<div class="paragraph">
<p>Now, each fault is inserted in isolation from the rest and that each mutant is challenged by the execution of the test suite. The outcome for each mutant is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mutant <strong>1</strong> is killed. It makes <code>pop</code> throw an unexpected exception which also makes both test cases <code>testPush</code> and <code>testPop</code> fail.</p>
</li>
<li>
<p>Mutant <strong>2</strong> is killed. After the fault is executed, <code>count</code> results in <code>-1</code> then the assertion in <code>testPush</code> fails as it expects the result of <code>size</code> to be 1 and not <code>-1</code>;</p>
</li>
<li>
<p>Mutant <strong>3</strong> is killed in the same way as mutant &lt;1&gt;: <code>pop</code> throws an unexpected exception and <code>testPop</code> fails.</p>
</li>
<li>
<p>Mutant <strong>4</strong> is killed. At the end of the invocation of <code>pop</code> in <code>testPop</code>, <code>count</code> is equal to <code>2</code> which is not the expected value per the assertion and the test case fails.</p>
</li>
<li>
<p>Mutant <strong>5</strong> lives. It is not detected by any of the two test cases. In the code of the mutant <code>pop</code> returns <code>0</code>. However, the <code>testPop</code> does not verify the result of the method. Therefore the test case does not fail and the mutant lives.</p>
</li>
<li>
<p>Mutant <strong>6</strong> is killed. The result of <code>size</code> changed to return <code>0</code>. This does not make <code>testPop</code> fail but it does make <code>testPush</code> fail as the expected value is <code>1</code>.</p>
</li>
<li>
<p>Mutant <strong>7</strong> lives. The method is not invoked by any test case, therefore the mutated code is never reached and the mutant lives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Out fo the seven mutants, two survived the analysis. Then, this small test suite has a score of \$\frac{2}{7}\$. Inspecting both live mutants we can find hints on how to improve our test suite.</p>
</div>
<div class="paragraph">
<p>The fault introduced to create mutant <strong>7</strong> is not executed by the test suite. In this sense we say that the mutant is not reached by the test suite. <code>capacity</code> is a simple getter, it might be a waste of time to create a test case only to verify it but it exposes part of the internal state of a <code>BoundedStack</code> instance. The fact that it is not executed means that we are not verifying this part of the state. So, instead of creating a test case designed to check the functionalities of <code>capacity</code> it might be better to check that the other methods do not affect the part of the state that <code>capacity</code> exposes. In the case of our example we might verify that the capacity of the stack never changes. See that unreached mutants produce the same information as code coverage.</p>
</div>
<div class="paragraph">
<p>On the other hand, mutant <strong>5</strong>, is reached by the test suite. The artificial fault actually infects the program state as the result of <code>pop</code> is changed in the execution from <code>1</code> to <code>0</code>. However the oracle in <code>testPop</code> does not check the result of <code>pop</code> and it becomes evident that we should either add a new assertion for this or even create a new test case designed to check the result of the method.</p>
</div>
<div class="paragraph">
<p>Mutation testing evaluates the test suite as a whole. So, it is not required to improve <code>testPop</code> to detect mutant &lt;6&gt; as it is detected by <code>testPush</code>. In the same way no test case can cover all scenarios, all test cases shall not kill all mutants.</p>
</div>
<div class="paragraph">
<p>Although it has gained some attention in the last few years and in spite of being several decades old, mutation testing has still a scarce adoption in industry when compared with code coverage. The main reason for that lay in the limitations of the criterion:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mutation testing process is complex. There is a true lack of tooling support with easy integration in the development process beyond academic circles. However, this has been changing with emergence of industrial level tools like PIT, for Java programs <a href="#coles2016pit">(60)</a>.</p>
</li>
<li>
<p>Mutation testing is very expensive in terms of execution time. This is one of the main arguments used against it. The test suite has to be executed for each mutant that is created in the process. The number of mutants, even for very small programs is potentially huge. Also, if the mutants are inserted in the source code then the program needs to be recompiled after the fault is inserted every execution, which increases even more the execution costs.</p>
</li>
<li>
<p>It is hard to interpret the mutation score as a global metric for the quality of the test suite. Code coverage is simpler, it represents the percentage of code that is executed by the test suite. However, the mutation score is tied to the mutation operators we use. It does not mean that we can catch that portion of all possible faults.</p>
</li>
<li>
<p>Live mutants need to be inspected by hand which may be tedious and difficult. The manual inspection has to main goals: understand why the mutant is not killed and obtain hints to improve the test cases and, to sort out mutants equivalent to the original code. Equivalent mutant are a major problem in mutation testing. These are artificial faults that turn out to be functionally equivalent to the original code. They pollute the value of the mutation score and waste the time of developers. In the general case, there is undecidable to determine if a mutant is equivalent to the original program.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Along the years, the community has developed many strategies to cope with the limitations of mutation testing. First, equivalent mutants my not be totally negative. According to Henry Coles, the creator of PIT, they can be often an indication that the original program is redundant and that it could be refactored. <a href="#equivalent-mutant">Listing 61</a> shows an example of this phenomenon explained by Coles in <a href="#coles2018making">(61)</a>.</p>
</div>
<div class="paragraph">
<p>The first method corresponds to the original method under test. The second is the mutant created by changing the comparison operator or the second conditional statement. The mutant is equivalent to the original code. The case where <code>i</code> is equal to <code>100</code> is already contained in the first condition. However, this situation reveals that the second condition is redundant and that it could be removed to make the code of the method simpler.</p>
</div>
<div id="equivalent-mutant" class="listingblock">
<div class="title">Listing 61. Example of an equivalent mutant and how it signals the need for refactoring.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">//Original code</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">someLogic</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">doSomething</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-c1">//Mutant</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">someLogic</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">doSomething</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-c1">// Refactored code</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">someLogic</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
  <span class="tok-n">doSomething</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Original method code.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A mutant is created by changing the comparison operator from <code>&gt;</code> to <code>&gt;=</code>. The mutant is equivalent to the original code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Refactored method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several strategies to reduce the cost of executing the mutation analysis. Here are some of them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We can use a statistically significative sample instead of all mutants created in the process.</p>
</li>
<li>
<p>We may use only a handful of mutation operators. In fact, some research results indicate that using mutation operators that only remove statements produces much fewer mutants making the analysis more efficient and still highly effective <a href="#deng2013empirical">(62)</a>.</p>
</li>
<li>
<p>The execution of the test suite  against each mutant can be parallelized, for example in concurrent processes or even in more specialized infrastructures like clusters.</p>
</li>
<li>
<p>The test suite execution can stop after the first test case failure. In general there may be no need to run the rest of the tests once one of them has failed as the mutant is already detected.</p>
</li>
<li>
<p>When executing the test suite with a mutant, we should consider only the test cases reaching the mutant and not the entire test suite. As a consequence, the test suite will not be executed if a mutant is not reached by any test case. This strategy requires computing beforehand the statement coverage, but it has been proven to a huge real time saver in practice with tools like PIT.</p>
</li>
<li>
<p>To avoid compilation cycles, mutants could be inserted in-memory in the compiled code. Another strategy inserts  the code of all mutants at once with only one compilation cycle. Mutants are then activated with the help of external parameters <a href="#untch1993mutation">(63)</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mutation testing is a strong coverage criterion to evaluate and improve a test suite. It can produce the same information as code coverage but leads to a more meaningful hints for the creation and hardening of test cases. This is particularly true if live mutants are analyzed with the RIPR model. A mutant that does not infect the state of any test case execution signals the need of additional test inputs. A live mutant that propagates the state infection to the test code signals the need for better oracles as seen in the examples above. In this sense, it is the strongest coverage criteria explained in this chapter. However, this strength comes at a high cost as evidenced by the limitations discussed before.</p>
</div>
</div>
<div class="sect4">
<h5 id="_coverage_criteria_in_practice">Coverage criteria in practice</h5>
<div class="paragraph">
<p>All coverage criteria discussed before are used in practice. This section presents some examples on how are they used in industry along with some of the available tools for their computation.</p>
</div>
<div class="paragraph">
<p>Logic coverage criteria are often used for embedded systems. In particular Modified Condition /Decision Coverage (MC/DC) is included as a requirement in the DO-178C standard: <em>Software Considerations in Airborne Systems and Equipment Certification</em>. It is the main guideline emitted by the corresponding certification authorities to approve commercial software-based aerospace systems. The same coverage metric is highly recommended by the ISO 26262 standard: <em>Road vehicles â Functional safety</em>: an international regulation for the functional safety of electrical and electronic systems in serial production road vehicles.</p>
</div>
<div class="paragraph">
<p>Structural coverage criteria applied to code artifacts, that is, code coverage, are arguably the most used criteria in practice. The coverage outcome is easy to interpret: code coverage signals the code locations not executed by the test suite, so we need new test cases to reach them. There are also many available tools able to compute coverage efficiently and these tools can be easily integrated in the development process either in IDEs or as a build step of CI builds.</p>
</div>
<div class="paragraph">
<p>For Java projects three of the most used tools to compute code coverage are JaCoco\footnote{\url{https://www.jacoco.org/jacoco/}}, Cobertura\footnote{\url{https://cobertura.github.io/cobertura/}} and OpenClover\footnote{\url{http://openclover.org/}}. These tools instrument the original code to insert instructions to store the coverage information. JaCoCo and Cobertura instrument the compiled bytecode, while OpenClover instruments the source code before compiling it using Aspect Oriented Programming. As an example, <a href="#coverage-instrumentation">Listing 62</a> shows how OpenClover instruments the <code>BoundedStack</code> class from <a href="#stack-example">Listing 33</a> to compute coverage. The tool creates a custom inner class <code><em>CLR4_4_100kheirnt4</code> in charge of recording the coverage informations. Then it inserts <code></em>CLR4_4_100kheurnt4.R.inc</code> invocations to record the code location once it is executed. See how these invocations identify each code location by a number and how similar actions are taken inside the conditions. The instrumentation does not harm the execution time of the code, so computing coverage is as efficient as executing the test suite.</p>
</div>
<div id="coverage-instrumentation" class="listingblock">
<div class="title">Listing 62. Extract of the <code>BoundedStack</code> class from <a href="#stack-example">Listing 33</a> instrumented by OpenClover to compute coverage.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">BoundedStack</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">__CLR4_4_100kheurnt4</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>
    <span class="tok-o">...</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">try</span><span class="tok-o">{</span>
            <span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">inc</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">);</span>
            <span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">inc</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">);</span>
            <span class="tok-k">if</span><span class="tok-o">(((</span><span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-n">elements</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">iget</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">)!=</span><span class="tok-mi">0</span><span class="tok-o">|</span><span class="tok-kc">true</span><span class="tok-o">))</span>
                <span class="tok-o">||</span> <span class="tok-o">(</span><span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">iget</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">)==</span><span class="tok-mi">0</span><span class="tok-o">&amp;</span><span class="tok-kc">false</span><span class="tok-o">))</span>
                <span class="tok-o">{</span>
                    <span class="tok-o">{</span>
                        <span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">inc</span><span class="tok-o">(</span><span class="tok-mi">7</span><span class="tok-o">);</span>
                        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalStateException</span><span class="tok-o">();</span>
                    <span class="tok-o">}</span>
                <span class="tok-o">}</span>
                <span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">inc</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">);</span>
                <span class="tok-n">elements</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">item</span><span class="tok-o">;</span>
                <span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">inc</span><span class="tok-o">(</span><span class="tok-mi">9</span><span class="tok-o">);</span>
                <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">count</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-k">finally</span><span class="tok-o">{</span>
            <span class="tok-n">__CLR4_4_100kheurnt4</span><span class="tok-o">.</span><span class="tok-na">R</span><span class="tok-o">.</span><span class="tok-na">flushNeeded</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
        <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tools like JaCoCo, Cobertura and OpenClover are able to report line coverage, statement coverage, basic block coverage and branch coverage. See in <a href="#coverage">Figure 16</a> and example of a report generated by OpenClover for <code>BoundedStack</code>. On the left we have the line numbers. The other number indicated how many times the line has been executed by the test suite. The green code indicates areas that are covered while the red color indicates a coverage issue. Notice that line 15 is reported as not executed. Line 14 on the other hand is reported as executed twice but the tool also reports that only the <code>false</code> branch of the condition has been executed.</p>
</div>
<div id="coverage" class="imageblock text-center">
<div class="content">
<img src="images/openclover-coverage.png" alt="Coverage report example produced by OpenClover">
</div>
<div class="title">Figure 16. An example of a coverage report produced by OpenClover.</div>
</div>
<div class="paragraph">
<p>Code coverage has been widely adopted by software companies. Google, for example, has its own guidelines when interpreting and using code coverage. They can be consulted for more details in <a href="#arguelles2020code">(64)</a> and <a href="#ivankovic2019code">(65)</a>. In these guidelines, Google developers express that there is no âideal code coverage numberâ that can be applied to all software products. The coverage level depends on the relevance of the code, how often a code location changes and how long is the code expected to be used. In broad terms they consider a 60% coverage as <em>acceptable</em>, 75% as <em>commendable</em> and 90% as <em>exemplary</em>. They argue that developers should aim at improving code coverage, but the effort should be directed to improve badly covered code, for example to go from 30% to 70% instead of going from 90% to 95% in a project. Raising an already very high code coverage may require a lot of effort with little gain. Coverage metrics are used inside the company together with static analysis to support code reviews.</p>
</div>
<div class="paragraph">
<p>These practices are not exclusive of big companies like Google. The XWiki Project\footnote{http://www.xwiki.org/} builds a Java platform to develop collaborative applications. The contributors of this project pay close attention to the quality of their test suite and have incorporated coverage monitoring into their development practices. The main XWiki codebase is composed by 3 Maven multi-module projects with more than 40 submodules each. These modules may contain more than 30K lines of application code and more than 9K of test code implementing several thousands of test cases. The entire development process is monitored in a <a href="https://ci.xwiki.org/">CI server running Jenkins</a>.</p>
</div>
<div class="paragraph">
<p>The build pipeline in the CI includes actions to check the quality of the code and tests. In particular, they monitor the coverage achieved by the test suite. Each module in the codebase has a predefined threshold and the code coverage can not decrease below this value, otherwise the build will fail. In this way, if a developer adds some code she has to also provide new tests cases so the coverage ratio remains above or equal the predefined value. If a developer achieves a coverage above threshold, then she is given the possibility to raise the value for the module. In this way it is ensured that the code coverage never decreases. This is what they call the <em>Ratchet Effect</em>. This strategy has led to an effective use of the code coverage metric and a substantial increment on coverage levels <a href="#massol2013tip">(66)</a>.</p>
</div>
<div class="paragraph">
<p>Mutation testing has not gained an adoption as broad as code coverage has. The mutation analysis provides a better criterion for the quality of the tests but it is a complex and expensive process, sometimes hard to interpret. In terms of tooling, there are a few options available. Among them, the most popular alternative is <a href="http://pitest.org">PIT or PITest</a>. PIT instruments mutants in the compiled bytecode and integrates with all major build systems like Ant, Gradle and Maven. Other tools for Java include <a href="https://www.st.cs.uni-saarland.de/mutation/">Javalanche</a> which also manipulates bytecode to inject faults and <a href="http://mutation-testing.org/">Major</a> that operates at the source code level. Major is integrated with the Java compiler and provides a mechanism to define new mutation operators.</p>
</div>
<div class="paragraph">
<p>PIT was develop for industry use unlike many other tools that have been developed mainly for research purposes. Apart for a good integration with most build systems, the tool has a pluggable architecture allowing its configuration and extension. The implements many of the traditional mutation operators like: changing instances of comparison operators, arithmetic operators, removing method invocations, perturbing method results and many others. PIT also implements many strategies to make mutation testing affordable. For example it creates mutants in memory from the compiled code and not the source code. It computes code coverage before running the analysis, so only mutants reached by test cases are inspected and only the test cases reaching each mutant are executed. The test cases are also prioritized, so faster test cases are executed first.</p>
</div>
<div class="paragraph">
<p>Mutation testing has gained some traction in the last few years. Companies like Google have started using it. Petrovic and Ivankovic <a href="#petrovic2018state">(67)</a> have described how the company uses mutation analysis in their codebase. They explain that the Google repository contains about two billion lines of code and on average, 40000 changes are incorporated every workday and 60\% of them are created by automated systems. In this environment it is not practical to compute a mutation score for the entire codebase, and it is very hard to provide an actionable feedback to developers</p>
</div>
<div class="paragraph">
<p>Most changes to the code pass through a code review process. So, the mutation testing feedback is incorporated into code reviews along with static analysis and code coverage. This eliminates the need for developers to run a separated program and act upon its output. To make the mutation analysis feasible the system shows at most one mutant by covered line. To further reduce the number of mutants, they classify each node of the Abstract Syntax Tree (AST) as important or non-important. To do this, they maintain a curated collection of simple AST nodes classified by experts. The system keeps updating this database with the feedback from the reviewing process. This selection may suppress relevant live mutants but there is a good tradeoff between correctness and usability as as the number of potential mutants is always much larger than what can be presented to reviewers.</p>
</div>
<div class="paragraph">
<p>The system analyses programs written in C++, Java, Python, Go, JavaScript, TypeScript and Common Lisp. It has been validated with more than 1M mutants in more than 70K diffs. 150K live mutants were presented and 11K received feedback. 75% of the findings with feedback were reported to be useful for test improvement. The company has also noticed differences related to the survival ratio of mutants when contrasted with the programming language and mutation operator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_doubles">3.4.3. Test doubles</h4>
<div class="paragraph">
<p>Often, code units depend on other software components to achieve their functionalities. When testing a unit it may happen that some of its dependencies are not yet implemented and we only have an interface. It could also happen that these dependencies perform actions that can&#8217;t be undone, like sending an email to a customer which makes them not suited for testing. In such scenarios we use test doubles. Doubles as in stunt doubles.</p>
</div>
<div class="paragraph">
<p>Ammann and Offutt <a href="#amman2017introduction">(4)</a> define test doubles as software components implementing only partial functionalities that are used during testing in place of actual production components. That is, we create classes that do not contain the actual functionality but provide a minimal working code that we can leverage in our tests.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s illustrate test doubles with a simplified example. Suppose we are building an e-commerce website. In our code (<a href="#test-doubles-example-scenario">Listing 63</a>) we have notions about customers, products and shopping carts. A product has a base price. A shopping cart belongs to a user and contains a collection of products. This class uses a service <code>PromoService</code> to obtain the active promotions for a user. A promotion applies to a product and informs the net discount for a product with <code>getDisscountFor</code>. A shopping cart computes the final price of the collection of products using the active promotions and applies all discounts.</p>
</div>
<div id="test-doubles-example-scenario" class="listingblock">
<div class="title">Listing 63. Components of a simplified e-commerce website.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">User</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">Product</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>

    <span class="tok-kd">public</span> <span class="tok-n">BigDecimal</span> <span class="tok-nf">getBasePrice</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ShoppingCart</span> <span class="tok-o">{</span>

    <span class="tok-n">User</span> <span class="tok-n">user</span><span class="tok-o">;</span>
    <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">Product</span><span class="tok-o">&gt;</span> <span class="tok-n">products</span><span class="tok-o">;</span>
    <span class="tok-n">PromoService</span> <span class="tok-n">service</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-n">BigDecimal</span> <span class="tok-nf">getTotalBasePrice</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Sum of all base prices</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">BigDecimal</span> <span class="tok-nf">getFinalPrice</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Uses PromoService to obtain the active propomotions for the user</span>
        <span class="tok-c1">// Computes the final price of each product by using the disccounts</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>

<span class="tok-kd">interface</span> <span class="tok-nc">PromoService</span> <span class="tok-o">{</span>

    <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">Promotion</span><span class="tok-o">&gt;</span> <span class="tok-nf">getActivePromotions</span><span class="tok-o">(</span><span class="tok-n">User</span> <span class="tok-n">user</span><span class="tok-o">);</span>

<span class="tok-o">}</span>

<span class="tok-kd">interface</span> <span class="tok-nc">Promotion</span> <span class="tok-o">{</span>

    <span class="tok-kt">boolean</span> <span class="tok-nf">appliesTo</span><span class="tok-o">(</span><span class="tok-n">Product</span> <span class="tok-n">product</span><span class="tok-o">);</span>

    <span class="tok-n">BigDecimal</span> <span class="tok-nf">getDiscountFor</span><span class="tok-o">(</span><span class="tok-n">Product</span> <span class="tok-n">product</span><span class="tok-o">);</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose we are given the task to test <code>getFinalPrice</code>. <code>ShoppingCart</code> depends on <code>PromoService</code>. The actual implementation of this interface could be still under development at the moment we will test <code>ShoppingCart</code>. It could also be the case, that the actual implementation requires access to a database which might make the test slower. To avoid dealing with these issues we can create test doubles for <code>PromoService</code>.</p>
</div>
<div class="paragraph">
<p>For example, one scenario we would like to test is when the user has no active promotions. Instead of messing with the actual production code, we can create a simple test double like in <a href="#empty-service-stub-example">Listing 64</a>. This double returns a predefined constant value. Such test doubles are usually called <em>stubs</em>. Apart from returning fixed values, stubs could also return values selected from a collection, or values that depend on the input or even random values.</p>
</div>
<div id="empty-service-stub-example" class="listingblock">
<div class="title">Listing 64. A simple test double for <code>PromoService</code> to test the scenario where the user has no active promotions and an extract of a test case using the test double.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>
<span class="tok-kd">class</span> <span class="tok-nc">NoPromoServiceStub</span> <span class="tok-kd">implements</span> <span class="tok-n">PromoService</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">Promotion</span><span class="tok-o">&gt;</span> <span class="tok-nf">getActivePromotions</span><span class="tok-o">(</span><span class="tok-n">User</span> <span class="tok-n">user</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">Collections</span><span class="tok-o">.</span><span class="tok-na">empty</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-o">...</span>

<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPriceNoActivePromotion</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">ShoppingCart</span> <span class="tok-n">cart</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
    <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">setPromoService</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">NoPromoServiceStub</span><span class="tok-o">());</span>

    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">getTotalBasePrice</span><span class="tok-o">(),</span> <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">getFinalPrice</span><span class="tok-o">(),</span>
                <span class="tok-s">&quot;With no promotions the final price must be equal to the total base price&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we are testing the interaction between software components, sometimes it is useful to add verifications inside the code of a test double. This could help us verify, for example, that a method has been called a certain number of times. In our example, we could verify that <code>getActivePromotions</code> is invoked only once. Test doubles implementing verifications on the interaction of components are usually called <em>mocks</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some authors state that mocks are a kind of specialized stubs. As Ammann and Offutt say, whether a mock is also a stub is not relevant for practical purposes. Other authors may include more classifications for test doubles such as: <em>dummies</em>, <em>spies</em> and <em>fakes</em>, depending on the amount of functionality they implement.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Test doubles have several advantages in practice. We already discussed that test doubles are helpful when a component has not been implemented to create test cases matching the specification. Then, the implementation can leverage these early tests and the development of other functionalities is not blocked. As we discussed before, test doubles also avoid the execution during testing of actions that are permanent or hard to undone, like writing to a database or sending an email. Test doubles also provide a nice sandbox when dealing with external components that may not always be available or their execution takes a lot of time, for example, using a remote REST API. In such scenarios, using test doubles guarantee that our test cases will remain fast and will not fail if the service is not available.</p>
</div>
<div class="paragraph">
<p>We can choose to create test doubles manually, like we did before with the stub. In such a simple example manually creating the stub was enough. But, for more complex scenarios and to perform more complex verifications inside mocks we might better use available <em>mocking frameworks</em>.</p>
</div>
<div class="sect4">
<h5 id="_mocking_frameworks_mockito">Mocking frameworks: Mockito</h5>
<div class="paragraph">
<p>Our tests should be simple to understand, as we need to map them to the specification and we need to maintain them. Creating test doubles by hand could make our test cases more complex. <em>Mocking frameworks</em> are software tools that keep the creation of test doubles clean and easy to incorporate to our test code. One of such frameworks for Java is <a href="https://site.mockito.org/"><em>Mockito</em></a></p>
</div>
<div class="paragraph">
<p>Mockito has an easy to use and understand fluent API. With it we can create and verify stubs and mocks almost declaratively. <a href="#empty-mockito-stub-example">Listing 65</a> shows an example of who to rewrite <a href="#empty-service-stub-example">Listing 64</a> with Mockito.</p>
</div>
<div id="empty-mockito-stub-example" class="listingblock">
<div class="title">Listing 65. Rewriting <a href="#empty-service-stub-example">Listing 64</a> with the help of Mockito.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPriceNoActivePromotion</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-n">PromoService</span> <span class="tok-n">service</span> <span class="tok-o">=</span> <span class="tok-n">mock</span><span class="tok-o">(</span><span class="tok-n">PromoService</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="tok-n">when</span><span class="tok-o">(</span><span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">getActivePromotionsFor</span><span class="tok-o">(</span><span class="tok-n">any</span><span class="tok-o">()))</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-o">.</span><span class="tok-na">thenReturn</span><span class="tok-o">(</span><span class="tok-n">Collections</span><span class="tok-o">.</span><span class="tok-na">emptyList</span><span class="tok-o">());</span>

    <span class="tok-n">ShoppingCart</span> <span class="tok-n">cart</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
    <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">setPromoService</span><span class="tok-o">(</span><span class="tok-n">service</span><span class="tok-o">);</span>

    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">getTotalBasePrice</span><span class="tok-o">(),</span> <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">getFinalPrice</span><span class="tok-o">(),</span>
                <span class="tok-s">&quot;With no promotions the final price must be equal to the total base price&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instructs Mockito to create a test double for <code>PromoService</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies the behavior on <code>getActivePromotionsFor</code>. The double is instructed to return an empty list for any argument.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#empty-mockito-mock-example">Listing 66</a> shows an extract of a test case verifying that <code>getFinalPrice</code> invokes <code>getActivePromotionsFor</code> only once. If during the execution of the test case, the method is not invoked or it is invoked two or more times, the test case will fail.</p>
</div>
<div id="empty-mockito-mock-example" class="listingblock">
<div class="title">Listing 66.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPromotionsConsutledOnce</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">PromoService</span> <span class="tok-n">service</span> <span class="tok-o">=</span> <span class="tok-n">mock</span><span class="tok-o">(</span><span class="tok-n">PromoService</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
    <span class="tok-n">ShoppingCart</span> <span class="tok-n">cart</span> <span class="tok-o">=</span> <span class="tok-o">...</span>
    <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">setPromoService</span><span class="tok-o">(</span><span class="tok-n">service</span><span class="tok-o">)</span>
    <span class="tok-n">BigDecimal</span> <span class="tok-n">finalPrice</span> <span class="tok-o">=</span> <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">getFinalPrice</span><span class="tok-o">();</span>

    <span class="tok-o">...</span>

    <span class="tok-n">verify</span><span class="tok-o">(</span><span class="tok-n">service</span><span class="tok-o">,</span> <span class="tok-n">times</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">)).</span><span class="tok-na">getActivePromotionsFor</span><span class="tok-o">(</span><span class="tok-n">any</span><span class="tok-o">());</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Assertion to verify the number of times the method was invoked.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In both examples Mockito prevented the manual creation of classes and provided an easy to understand mechanism to incorporate the test doubles. The test code remains simple and self-contained. Also, the same general mechanism can be used for all our classes. The framework also allows mocking concrete classes beyond only interfaces. It also provides ways to verify that a method was invoked with specific arguments, and even to still invoke concrete methods while observing their behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="_best_practices_and_misuses">Best practices and misuses</h5>
<div class="paragraph">
<p>Test doubles are powerful allies for testing, but they can be often misused. There are even testing smells that concern only mocks and stubs.</p>
</div>
<div class="paragraph">
<p>One of the test smells coined for mocks is the <em>Mock Happy</em> smell. It refers to test cases that require many mocks to run. These test cases are often fragile and hard to understand <a href="#garousi2018smells">(53)</a> and maintain.</p>
</div>
<div class="paragraph">
<p>In general terms, the overuse of mocks can damage the quality of our test code. For example, we should avoid mocking value types or any other immutable type or any class that is simple enough to control and observe. Mocking those classes may result in a test code that brings little value and it may even be harder to understand than using the original class directly.</p>
</div>
<div class="paragraph">
<p>We should avoid mocking third party classes as much as possible. When we mock a class we make assumptions on their behavior. Those assumptions may be wrong if we don&#8217;t fully understand how external classes behave in all scenarios. We should create mocks mostly for our own code. Expressing an incorrect behavior of external dependencies with mocks leads to test cases that do not fail, yet, the code will break in production <a href="#freeman2007everything">(68)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_role_of_testability">3.5. The role of testability</h3>
<div class="paragraph">
<p>High quality test cases are concise, clear, repeatable, independent, efficient and maintainable <a href="#meszaros2003test">(54)</a>. A good test suite facilitates the development of our product as it catches bugs earlier. However, code quality has also an important effect over the quality of the test cases. Low quality code is hard to test. If the classes in the code are tightly coupled, or the software has hidden external dependencies, or if it forcibly depends on external services, then it is hard for test cases to instantiate the components and set them in the specific states required for testing <a href="#day2014available">(69)</a>.</p>
</div>
<div class="paragraph">
<p>Therefore, we should design software with tests in mind, that is, we should design software to be testable. <em>Testability</em> is the property of a system that characterizes how easy it is to test. It can be defined in terms of two other sub-properties: <em>controllability</em>: how easy it is so set a software component in the desired state and, <em>observability</em>: how easy it is to observe and verify the state of the component. In other words, a software is testable if its state is easy to control an observe. High quality code leads to a highly testable software.</p>
</div>
<div class="paragraph">
<p>For example, loosely coupled classes with high cohesion, that observe the <em>Single Responsibility Principle</em> are easier to instantiate and also lead to easier and more understandable test cases. Complex code will necessary produce complex and hard to understand test cases. Coupled classes will also make the test code unnecessarily large and harder to read since we will need to create many objects at the same time to test one of them.</p>
</div>
<div class="paragraph">
<p>These symptoms of bad code often manifest themselves during testing. In most occasions it is better to go back and redesign our software components than creating complex test cases. For example repeating the same mocking setup across many test cases might be a signal of tight coupling that should be better solved in the application code than making the test code repetitive <a href="#miller2008patterns">(70)</a>.</p>
</div>
<div class="paragraph">
<p>Design patterns are general solutions to recurring problems in programming <a href="#source2020design">(72)</a>. These solutions are proven to be effective and, if well used, they help making the code easier to understand. The good application of design patterns also make the code more testable <a href="#day2014available">(69)</a>, <a href="#moore2019designing">(71)</a>. Two patterns often used as examples of testing facilitators and in particular to make mocking easier are <em>Dependency Injection</em> and <em>Repository</em>.</p>
</div>
<div class="paragraph">
<p>Using <em>Dependency Injection</em>, classes receive their dependencies instead of explicitly creating them. Classes then depend on abstractions, interfaces, that can be easily exchanged. Also, since classes are not in charge of creating their dependencies their code is simpler. Our example with <code>PromoService</code> is loosely based in this design pattern. This pattern makes it extremely easy to exchange the dependency, which is helpful for mocking and stubbing as we saw in the example. It also makes the component more controllable as we can create dependencies more easily than production code.</p>
</div>
<div class="paragraph">
<p>With the <em>Repository</em> pattern we create a class that manages all access to the data. This class encapsulates and hides the actual data access operations, separating even more our components from the data access implementation and the concrete storage method used in production. Using this design pattern facilitates mocking the data access mechanisms which in turn facilitates the verification of how our code interacts with the data components. We also avoid making actual database modifications that we might need to undo to keep our tests repeatable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_driven_development">3.6. Test Driven Development</h3>
<div class="paragraph">
<p><em>Test Driven Development</em> (TDD) is an approach to software development that encourages writing tests first, before writing any application code. The concepts behind TDD are derived from the <em>Extreme Programming</em> movement in the late 90&#8217;s. The popularization of this methodology is credited to Kent Beck, who also created SUnit, a unit testing framework for Smalltalk and inceptor of the entire xUnit framework family. Beck also participated in the development of JUnit together with Erich Gamma.</p>
</div>
<div class="paragraph">
<p>In his seminal book, <em>Test-driven development: by example</em> <a href="#beck2003test">(73)</a> Beck states that TDD follows two simple rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Donât write a line of new code unless you first have a failing automated test.</p>
</li>
<li>
<p>Eliminate duplication.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two rules induce the organization of programming tasks in a cycle, known as the <em>Red/Green/Refactor</em> cycle:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Red</dt>
<dd>
<p>Write a simple and short test that does not work. Since the application code isn&#8217;t already entirely written, the test might not even compile. The name of this phase makes allusion to the fact that failing tests are usually shown in red in many programming environments.</p>
</dd>
<dt class="hdlist1">Green</dt>
<dd>
<p>Take any quick coding action required to make the failing test work. In this phase we will introduce low quality code with repetitions and non-optimal solutions. Our only goal is to make the test pass, hence the <em>Green</em> name.</p>
</dd>
<dt class="hdlist1">Refactor</dt>
<dd>
<p>Eliminate any redundancy or duplication and improve the code added to make the test pass by refactoring. This refactoring benefits for the previously created tests. If we make a mistake during this phase, the tests in place will catch it early enough.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If we use TDD, whenever we add a new feature to our product we must start this cycle. At the end of each phase of the cycle we must execute all tests that have been created and not only the one we just added. In the <em>Red</em> phase only the new test should fail for the expected reasons. If the test does not fail, then it is wrong or does not bring any value to the test suite. No other test should fail by the addition of this new test. After the <em>Green</em> phase all tests must pass. The new code should not brake any existing test and it must be created to make the new test pass. During the <em>Refactoring</em> phase the test suite becomes a safety net in which we can rely to improve the quality of our code without introducing changes that break the expected behavior.</p>
</div>
<div class="paragraph">
<p>TDD requires an efficient test suite that can be executed regularly to obtain early feedback from tests. It also requires developers to write their own test cases. These premises are actually at the core of modern software development.</p>
</div>
<div class="paragraph">
<p>The methodology has true practical advantages <a href="#moore2019designing">(71)</a>. On the one hand, it forces the creation of tests that might otherwise never been written. On the other hand, the application code is designed from the users' perspective and it enforces developers to write testable application code. The effective use of TDD shall produce in the long term code with fewer bugs and shall reduce the need for debugging as tests should be informative enough to diagnose any fault.</p>
</div>
<div class="paragraph">
<p>Like any other methodology TDD has gained adepts and detractors which regularly engage in never-ending discussions. Both sides use strong arguments to make their cases. However, we must keep in mind that, again, as any practical approach, TDD fits better the practices of ones and not the ways of others. We should not use it blindly and we should think whether its application may bring more damage than good.</p>
</div>
<div class="paragraph">
<p>Applying TDD does not mean that we don&#8217;t need a careful design of our product. An initial and comprehensive design phase is crucial for the quality of our software <a href="#li2018why">(74)</a>. A good design actually facilitates the application of TDD, as it helps keeping the tests focused. But it is not true in the opposite sense. Without a clear design, we will be making the design on the fly and TDD may lead to bad design choices.</p>
</div>
<div class="paragraph">
<p>Real life is not the same as the small and carefully crafted examples, often used to introduce TDD. In those examples, the requirements are clear and will not change. However, in a real development projects the requirements may change in time and are often vague. We should take that into account otherwise we will find ourselves adapting our code and our prematurely created tests many times increasing the cost of maintenance and development <a href="#fox2019test">(75)</a>.</p>
</div>
<div class="paragraph">
<p>TDD favors a strong focus on unit testing. Over-specifying our code with unit tests may lead to unuseful test cases that may well verify assertions that under no circumstances will be false. It may also lead to an important amount of tests for very simple code. It may also induce to the overuse of mocks, whose perils we already discussed in the previous section. In practice, there are scenarios when a couple of higher level tests can be more useful than tens of unit tests. This tradeoff should be carefully taken into account <a href="#schranz2014case">(76)</a>.</p>
</div>
<div class="paragraph">
<p>Projects with well defined functional requirements unlikely to change much seem to be a good match for TDD. Take as example the creation of a compiler. The specification of the source and target language do not change much in time. The structure of the tests is also well define in the for of input and expected output. In such a project we will be creating tests cases directly matching the specification and main goal of the product.</p>
</div>
<div class="paragraph">
<p>Maybe, as Eric Gunnerson puts it, the most relevant phase of TDD is not creating the tests but the regular code refactoring. Refactoring should lead to a better designed product with high quality code, with low coupling and better testability <a href="#gunnerson2017notdd">(77)</a>.</p>
</div>
<div class="paragraph">
<p>But, should we use TDD or not? There is no simple answer. We must use the approach that better fits our practices. In the words of Martin Fowler <a href="#fowler2014is">(78)</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
Everything still boils down to the point that if you&#8217;re involved in software development you have to be thoughtful about it, you have to build up what practices work for you and your team, you can&#8217;t take any technique blindly. You need to try it, use it, overuse it, and find what works for you and your team. We&#8217;re not in a codified science, so we have to work with our own experience.
</blockquote>
<div class="attribution">
&#8212; Martin Fowler<br>
<cite>Is TDD Dead?</cite>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fuzzing">4. Fuzzing</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section follows the structure of the <a href="https://www.fuzzingbook.org/html/02_Lexical_Fuzzing.html">Lexical Fuzzing</a> chapter from <a href="https://www.fuzzingbook.org/">The Fuzzing Book</a>. It also replicates part of the experiments from this book using a different tools. The supporting code can be checked at <a href="https://github.com/oscarlvp/simplefuzzing" class="bare">https://github.com/oscarlvp/simplefuzzing</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Last section discussed the main ideas behind software testing. There, we explored the best testing practices and the advantages of automated test execution. However, not only test execution can be automated. It is also possible to automatically create test cases.</p>
</div>
<div class="paragraph">
<p><em>Fuzzing</em> is one of the most successful techniques exploited in practice to generate test cases and discover program failures. The main idea behind fuzzing is simple: we generate random inputs and then check if the execution of the program fails while using those inputs.</p>
</div>
<div class="paragraph">
<p>According to <em>The Fuzzing Book</em> <a href="#zeller2019fuzzing">(79)</a>, fuzzing was born in the late 1980&#8217;s when professor Barton Miller from the University of Wisconsin-Madison was connected to his workstation via a telephone line. There was a thunderstorm that caused noise in the line, which, in turn, caused the terminal commands get random inputs. The programs he was using crashed continuously. This inspired him to study the robustness of programs against random inputs. So, professor Miller wrote an assignment for his students asking them to create a <em>fuzz</em> generator (<em>fuzzer</em>). The generator should produce random character streams that students should use as input of UNIX utilities to find failures, that is, <em>to break them</em>. With this <em>naive</em> technique, Miller and his students were able to find actual failures and bugs in well tested utilities like <em>vi</em> and <em>emacs</em>. Since then, fuzzing has become a mainstream technique to test programs. A lot of research has been invested on improving fuzzing and several industry-level <em>fuzzers</em> have been developed through the years.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Coming from a country where we still use the telephone line to connect to the Internet I find this fuzzing <em>origin story</em> quite amusing. First, I&#8217;m surprised to know how reliable professor Miller&#8217;s telephone line was in regular days. Mine is always noisy. Second, I consider a thunderstorm a <em>red alert</em> situation requiring instant and total disconnection to avoid my modem getting fried. Anyways, this cool short story gave us one of the coolest testing techniques, that <em>boldly</em> took us where no tester <em>has gone before</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#fuzzing-algorithm">Listing 67</a> shows a pseudo-code outline of a simple fuzzing algorithm.</p>
</div>
<div id="fuzzing-algorithm" class="listingblock">
<div class="title">Listing 67. Pseudo-code of a general fuzzing algorithm.</div>
<div class="content">
<pre class="pygments highlight"><code><span></span>input: program
output: failures // Failure inducing inputs
procedure:
until stopping conditions:
    input = generate random input
    failure = execute program with input
    if failure:
        add (input, failure) to failures
return failures</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this pseudo-code we may identify three subproblems whose solutions directly affect the effectiveness of a fuzzing process: <em>what to observe during the program execution</em>, <em>how to generate the inputs</em> and <em>when to stop fuzzing the program</em>. Not by chance, these questions are closely related to the problems we identified from <a href="#testing-process">[testing-process]</a> when discussing the general testing process. Fuzzing can be seen as a fully automated instance of this general process.</p>
</div>
<div class="paragraph">
<p>The answer to the third question might be a matter of resources. The longer we let a fuzzer run the higher the chances it has to discover new execution paths and faults. But, a fuzzer can not run forever. Commonly, we stop fuzzing a program after the first failure has been detected or after a certain amount of hours. This time depends on our infrastructure and even the program under test. It makes no sense to fuzz a small program for a whole week. We may also stop fuzzing after a certain number of generated inputs or a certain number of program executions, that can be limited by our budget if we run the fuzzer in the cloud. It is also possible to rely on theoretical statistical results to estimate the likelihood with which a fuzzer may discover new execution paths and assess how well it is performing in that sense. A nice overview on this particular idea can be found in the corresponding chapter <a href="https://www.fuzzingbook.org/html/WhenToStopFuzzing.html">When to Stop Fuzzing</a> of <em>The Fuzzing Book</em> <a href="#zeller2019fuzzing">(79)</a>.</p>
</div>
<div class="sect2">
<h3 id="_what_to_observe">4.1. What to observe?</h3>
<div class="paragraph">
<p>Fault triggering inputs are detected by observing the execution of the program under test. Observing different program properties enables the discovery of different types of program faults.</p>
</div>
<div class="paragraph">
<p>The first obvious observation we can make is to check whether a program terminates abruptly or <em>crashes</em> with a given input. A program crash indicates the presence of a fault.</p>
</div>
<div class="paragraph">
<p>A crash may occur when the program under test throws an unhandled exception. In POSIX systems, some unhandled signals as SIGILL (invalid instruction), SIGSEGV (segmentation fault) and SIGABRT (execution aborted) also produce an abnormal program termination.</p>
</div>
<div class="paragraph">
<p>There may be many reason behind a program crash, for example, a program may:
* try to execute actions without having the right privileges: accessing to a restricted file, the camera or any other resource.
* try to write or read outside the assigned memory location. This is known as a segmentation fault. IN POSIX systems this program receives a SIGSEGV signal. In Windows it gets an access violation exception.
* pass the wrong parameters to a machine instruction or to a function which may end, for example, in a division by zero.
* abort the execution due an invalid internal state that produces an assertion failure.</p>
</div>
<div class="paragraph">
<p>Some programs do not check the boundaries of the memory buffers they modify. These programs may corrupt the memory adjacent to the buffer. This is known as a buffer overflow. Buffer overflows may cause the aforementioned segmentation faults. However, not all overflows cause a program crash and many of them become vulnerabilities that can be exploited to execute non-authorized code or to leak unwanted information like the Heartbleed bug we saw in <a href="#heartbleed-xkcd">Figure 2</a>. Actually, the Heartbleed vulnerability was discovered with the help of fuzzing.</p>
</div>
<div class="paragraph">
<p>Some compilers, such as <a href="https://clang.llvm.org/docs/AddressSanitizer.html">Clang</a>, are able to instrument the compiled code of a program to include memory error checks and signal the occurrence of buffer overflows. These instrumented programs can be fuzzed to find this type of fault. Other similar instrumentations can be used to spot uninitialized memory accesses, type conversions and numeric operations that may end in overflows and even concurrent actions that may end in race conditions.</p>
</div>
<div class="paragraph">
<p>In the last section we used assertions to verify the state of a program after the execution of a test case. In fuzzing we use randomly generated inputs. Therefore, it is hard to create an assertion with the expected program result for each input. However, we can use assertions to verify invariants, that is, properties the output of a program must meet no matter the input. This is known as <em>property testing</em>.</p>
</div>
<div class="paragraph">
<p>Suppose we have a function that computes the height of a given tree. For any tree the height must be greater or equal to zero. To test this function, using property testing, we can generate random tree instances and check that all heights are non-negative. In other contexts we could verify, for example, that all resources has been closed after processing a sequence of random inputs.</p>
</div>
<div class="paragraph">
<p>There are many good libraries implementing property testing and we shall discuss them in a later section. However, this approach is not hard to implement using built-in JUnit functionalities. <a href="#junit-property-testing">Listing 68</a> shows a general template that can be used for that.</p>
</div>
<div id="junit-property-testing" class="listingblock">
<div class="title">Listing 68. An example of how property testing can be implemented in JUnit.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@TestFactory</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">Stream</span><span class="tok-o">&lt;</span><span class="tok-n">DynamicTest</span><span class="tok-o">&gt;</span> <span class="tok-nf">checkProperty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">Iterator</span><span class="tok-o">&lt;</span><span class="tok-n">TInput</span><span class="tok-o">&gt;</span> <span class="tok-n">inputs</span> <span class="tok-o">=</span> <span class="tok-o">...;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">Function</span><span class="tok-o">&lt;</span><span class="tok-n">TInput</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-o">...;</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-n">Predicate</span><span class="tok-o">&lt;</span><span class="tok-n">TInput</span><span class="tok-o">&gt;</span> <span class="tok-n">property</span> <span class="tok-o">=</span> <span class="tok-o">...;</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-n">ThrowingConsumer</span><span class="tok-o">&lt;</span><span class="tok-n">TInput</span><span class="tok-o">&gt;</span> <span class="tok-n">verification</span> <span class="tok-o">=</span> <span class="tok-n">input</span> <span class="tok-o">-&gt;</span> <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">property</span><span class="tok-o">.</span><span class="tok-na">test</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">));</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="tok-k">return</span> <span class="tok-n">DynamicTest</span><span class="tok-o">.</span><span class="tok-na">stream</span><span class="tok-o">(</span><span class="tok-n">inputs</span><span class="tok-o">,</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">verification</span><span class="tok-o">);</span> <i class="conum" data-value="6"></i><b>(6)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@TestFactory</code> annotation marks a method as a producer of test cases. The method should return a collection or a stream of <code>DynamicTest</code> instances. Each test instance is considered as an independent test case.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here we implement the input generation as an <code>Iterator</code>. The iterator should return random input values.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Each test case in JUnit should have a name. Here we use a function to generate string representation for each input value. This name can not be null or blank.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The property to verify is implemented as a predicate that must return <code>true</code> for every input.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This is the actual verification that each test case shall perform. It simply uses <code>assertTrue</code> to check that the property is <code>true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Returns the stream of <code>DynamicTest</code> instances.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using <code>@TestFactory</code> each test case is executed independently and even in parallel. At the end of the test case stream JUnit reports all failing inputs.
Provided we have a tree generator, we could implement the tree height verification as shown in <a href="#tree-height-property">Listing 69</a>.</p>
</div>
<div id="tree-height-property" class="listingblock">
<div class="title">Listing 69. Verifying the tree height property  with JUnit.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@TestFactory</span>
<span class="tok-n">Stream</span><span class="tok-o">&lt;</span><span class="tok-n">DynamicTest</span><span class="tok-o">&gt;</span> <span class="tok-nf">checkProperty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">DynamicTest</span><span class="tok-o">.</span><span class="tok-na">stream</span><span class="tok-o">(</span>
            <span class="tok-n">getTreeGenerator</span><span class="tok-o">(),</span>
            <span class="tok-n">Tree</span><span class="tok-o">::</span><span class="tok-n">toString</span><span class="tok-o">,</span>
            <span class="tok-n">tree</span> <span class="tok-o">-&gt;</span> <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">height</span><span class="tok-o">()</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
    <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Property verification is simple. Generating interesting inputs remains the hardest part, as in all fuzzing approaches.</p>
</div>
<div class="paragraph">
<p>A scenario that is particularly well suited for property testing and fuzzing appears when we must implement a pair of <em>encoding</em>, <em>decoding</em> functions. An encoding function takes a value from domain <em>A</em> and transforms it into a value of domain <em>B</em>. The decoding function takes a value from <em>B</em> and produces a value from <em>A</em>. In many cases, we can pass the result of the encoding function as input to the decoding function and obtain the initial input. Using this property we can verify at the same time both, the encoding and the decoding functions.</p>
</div>
<div class="paragraph">
<p>Consider an example in which we are implementing two pairs of functions: <code>encodeBase64</code> that takes an array of bytes and obtains a string in base 64 representing the array and <code>decodeBase64</code>, implementing the opposite functionality, it takes an string in base 64 and produces the corresponding byte array. We can verify both functions by generating a random byte array, encoding it into a string, then decoding the string and verify that the final result is equal to the input.</p>
</div>
<div class="paragraph">
<p>This example could be implemented as shown in <a href="#encode-decode-junit">Listing 70</a>.</p>
</div>
<div id="encode-decode-junit" class="listingblock">
<div class="title">Listing 70. Example of a encode-decode function pair verification.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@TestFactory</span>
<span class="tok-n">Stream</span><span class="tok-o">&lt;</span><span class="tok-n">DynamicTest</span><span class="tok-o">&gt;</span> <span class="tok-nf">checkProperty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">Iterator</span><span class="tok-o">&lt;</span><span class="tok-kt">byte</span><span class="tok-o">[]&gt;</span> <span class="tok-n">generator</span> <span class="tok-o">=</span> <span class="tok-n">getByteArrayGenerator</span><span class="tok-o">();</span>
    <span class="tok-k">return</span> <span class="tok-n">DynamicTest</span><span class="tok-o">.</span><span class="tok-na">stream</span><span class="tok-o">(</span><span class="tok-n">generator</span><span class="tok-o">,</span> <span class="tok-n">Arrays</span><span class="tok-o">::</span><span class="tok-n">toString</span><span class="tok-o">,</span>
            <span class="tok-n">array</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
                <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">decodeBase64</span><span class="tok-o">(</span><span class="tok-n">encodeBase64</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">)));</span>
            <span class="tok-o">});</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes we have a reference implementation of the functionality we are building. This may happen, or example, when we are migrating a dependency of our program from one version to another, or when we are porting an already existing functionality to another programming language or framework. If those changes are not supposed to affect the output of the program under test, we can verify the new implementation by comparing the output to the result produced by the reference implementation. In such scenario we can generate random inputs and assert that both results are equal as shown in <a href="#comparing-with-reference">Listing 71</a>.</p>
</div>
<div id="comparing-with-reference" class="listingblock">
<div class="title">Listing 71. Comparing result against a reference implementation.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@TestFactory</span>
<span class="tok-n">Stream</span><span class="tok-o">&lt;</span><span class="tok-n">DynamicTest</span><span class="tok-o">&gt;</span> <span class="tok-nf">checkProperty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">DynamicTest</span><span class="tok-o">.</span><span class="tok-na">stream</span><span class="tok-o">(</span><span class="tok-n">getInputGenerator</span><span class="tok-o">(),</span> <span class="tok-n">PropertyTesting</span><span class="tok-o">::</span><span class="tok-n">name</span><span class="tok-o">,</span>
            <span class="tok-n">input</span> <span class="tok-o">-&gt;</span> <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">reference</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">),</span> <span class="tok-n">implementation</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">))</span>
    <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also use automatically generated inputs to test at the same time multiple programs with the same functionality. Any difference in their behavior or result with these random inputs may indicate the presence of faults. This is known as <em>differential fuzzing</em> or <em>differential testing</em> and has been very successful at discovering program vulnerabilities <a href="#hamidy2020differential">(80)</a> <a href="#nilizadeh2019diffuzz">(81)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_generate_random_inputs">4.2. How to generate random inputs?</h3>
<div class="paragraph">
<p>An effective fuzzing strategy generates random inputs able to discover faults. This is arguably the hardest challenge for fuzzing. Recalling the RIPR model, the generated inputs should be able to reach the faults, infect the program state and propagate the effects of the fault to the output of the program. Therefore, the generated inputs should be able to produce as many executions paths as possible and reach as much program instructions and branches as possible.</p>
</div>
<div class="paragraph">
<p><em>American Fuzzy Lop</em> (AFL), one of the most used fuzzers, focuses on reaching as much program branches as it can. Its authors claim that branch coverage provides more insight on the execution path than block coverage <a href="#moroz2019afl">(82)</a>. Two execution paths may have the same block or statement coverage, but different branch coverage. Branch coverage can discover faults in conditions that become noticeable through wrong control changes. The AFL authors explain that security vulnerabilities are often associated with these incorrect program state transitions.</p>
</div>
<div class="paragraph">
<p>The simplest approach to generate program inputs might be to randomly generate from scratch any value in the input domain. This could be fairly easy if the inputs consists on numeric values and byte arrays or strings with no format.</p>
</div>
<div class="paragraph">
<p>However, this approach is quite limited when trying to test programs expecting structured inputs. In programs that process images, JSON files, or strings with a syntactic structure like an expression or code, it is really hard to achieve a high statement or branch coverage using only random inputs generated from scratch. These generated inputs can help test the program against unexpected values but, in many cases, faults can appear after parts of the input has been processed. That is, when the input contains correct and incorrect fragments at the same time.</p>
</div>
<div class="paragraph">
<p>Structured inputs are commonly composed by keywords or recurrent fragments. For example, HTML documents are composed by tags such as <code>&lt;a&gt;</code>, <code>&lt;/a&gt;</code>, <code>&lt;i&gt;</code>, program code contain keywords and literals or a configuration file contains the name of the configuration options. A way to increase the chances to generate inputs able to cover more branches is to use a dictionary containing those keywords. We can generate better inputs by randomly combining these keywords or terms. These terms can be manually selected or even extracted from the code of the program under test.</p>
</div>
<div class="paragraph">
<p>Suppose we have created an <code>ExpressionParser</code> class that implements a recursive descent parser for simple arithmetic expressions that may contain the usual arithmetic operators <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, negation, parenthesis, usual floating point literals, references to predefined constants such as <code>PI</code> or <code>E</code> and invocations to predefined functions such as <code>min</code>, <code>exp</code>, <code>log</code> and alike. The parser can be used as shown in <a href="#expression-parser-usage">Listing 72</a>. For a given string, the parser produces an <code>Expression</code> containing an abstract syntax tree of the given input. If the input is incorrect, the parser throws a <code>ParseException</code>.</p>
</div>
<div id="expression-parser-usage" class="listingblock">
<div class="title">Listing 72. Usage of the simple expression parser.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">ExpressionParser</span> <span class="tok-n">parser</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ExpressionParser</span><span class="tok-o">();</span>
    <span class="tok-n">Expression</span> <span class="tok-n">exp</span> <span class="tok-o">=</span> <span class="tok-n">parser</span><span class="tok-o">.</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-s">&quot;2 * - (1 + sin(PI))&quot;</span><span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">exp</span><span class="tok-o">.</span><span class="tok-na">evaluate</span><span class="tok-o">());</span>
<span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">ParseException</span> <span class="tok-n">exc</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Incorrect input&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can try the input generation strategies on this class to evaluate their performance according to the number of branches they can reach and to check if we can find any unexpected error (other than a <code>ParseException</code>) like <code>NullPointerException</code>.</p>
</div>
<div class="paragraph">
<p>To generate strings we pick a random sequence of characters from the following predefined alphabet: ` \tabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+-*/(),.!@;[]{}`. This alphabet contains whitespaces, letters, numbers and symbols that can be used to conform valid expressions, but it also contains invalid symbols according to the parser specification such as <code>!@;[]{}</code>. Each generated string has a random length between 0 and 100. Here are samples of the strings that can be generated in this way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>q]Mwd7)9.f-5A}E</code></p>
</li>
<li>
<p><code>HI- q1H2Cs}r9KTmOeqBu/rO+V7VG]s[B[</code></p>
</li>
<li>
<p><code>i.U07X)XAKJI2VTVn)qbqhHQ5X30kk 5j;2mlrbVow[(HCEblAsMVe9K CGq9Fg@)93eUho9JTUxU</code></p>
</li>
<li>
<p><code>{D@</code></p>
</li>
<li>
<p><code>;!/hQW/c3nmS	0UGj4kWIJQ{2Gjb.Jlx)BeWz. Ay.]RO mrH!GICyVR</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notice how they do not resemble valid expression. It is extremely hard to get a string close to be a valid expression with pure random character selection.</p>
</div>
<div class="paragraph">
<p>To generate inputs using a dictionary of terms we can use the following keywords: <code>"pow"<code>, `"min"</code>, `"sin"<code>, `"cos"</code>, `"1"<code>, `".5"</code>, `"1e-5"<code>, `"("</code>, `")"<code>, `"+"</code>, `"-"<code>, `"*"</code>, `"/"<code>, `"PI"</code>, `"E"`</code>, <code>" "</code>. These keywords contain whitespaces, valid function and constant identifiers, valid literals and valid symbols. To create an input we randomly select between 0 and 10 of these terms, with possible repetitions. The dictionary approach is not exactly very advantageous in this example. It would suite better in actual code, such as SQL queries where it has been shown to be quite efficient <a href="#zalewski2015aflfuzz">(83)</a>. While still random, the inputs generated this way are closer to a valid expression:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/-</code></p>
</li>
<li>
<p><code>1</code></p>
</li>
<li>
<p><code>cospow++E+1e-5+min</code></p>
</li>
<li>
<p><code>(  PIE1/(</code></p>
</li>
<li>
<p><code>//pow.5pow(-pow</code></p>
</li>
<li>
<p><code>+1e-5 powpowcos</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To compare the performance of these two strategies we replicate the experiment model from <em>The Fuzzing Book</em>. We fuzz the <code>ExpressionParser</code> with different numbers of generated inputs from 1 to 100. For each input, we execute each fuzzing strategy 30 times and compute the average number of branches reached using the generated inputs. This shall tell us what is the expected number of branches for a given number of inputs that each strategy can reach. <a href="#expressions-blackbox">Figure 17</a> shows the result of this experiment.</p>
</div>
<div id="expressions-blackbox" class="imageblock text-center">
<div class="content">
<img src="images/expressions-blackbox.png" alt="Average branches with random inputs" width="600">
</div>
<div class="title">Figure 17. Average number of branches reached by generating random strings, random inputs using keywords and random valid inputs generated with a grammar.</div>
</div>
<div class="paragraph">
<p>The plots shows that, when generating only 9 inputs, the random string approach (<em>Random</em> series in the plot) reaches 60 branches on average, while the dictionary based generation reaches more than 80 branches. As we increase the number of inputs both approaches discover more branches, but the dictionary based generation requires less inputs in general to discover more branches.</p>
</div>
<div class="paragraph">
<p>In most cases the structure of valid inputs can be expressed through  <em>finite automata</em> or their equivalent <em>regular expressions</em> or with <em>formal grammars</em>. These formalism can be leveraged to quickly  generate a large sets of valid inputs. The efficient generation of strings from formal grammars has its own practical challenges. The topic is largely discussed in the <a href="https://www.fuzzingbook.org/html/03_Syntactical_Fuzzing.html"><em>Syntactical Fuzzing</em></a> chapter of <em>The Fuzing Book</em> <a href="#zeller2019fuzzing">(79)</a>. Using grammars to create valid inputs help us to rapidly reach more branches than with random inputs. However, these valid inputs are often closer to the <em>happy path</em> than corner cases where most faults arise.</p>
</div>
<div class="paragraph">
<p>Valid inputs for our <code>ExpressionParser</code> can be generated using the following context free grammar:</p>
</div>
<div id="expression-grammar" class="listingblock">
<div class="title">Listing 73. Expression grammar in EBNF.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>
<span class="tok-k">expression </span><span class="tok-o">=</span> <span class="tok-k">term</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-p">(</span> <span class="tok-s2">&quot;+&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;-&quot;</span> <span class="tok-p">),</span> <span class="tok-k">term </span><span class="tok-p">}</span> <span class="tok-p">;</span>

<span class="tok-k">term </span><span class="tok-o">=</span> <span class="tok-k">factor</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-p">(</span><span class="tok-s2">&quot;*&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;/&quot;</span><span class="tok-p">),</span> <span class="tok-k">factor </span><span class="tok-p">}</span> <span class="tok-p">;</span>

<span class="tok-k">factor </span><span class="tok-o">=</span> <span class="tok-s2">&quot;-&quot;</span><span class="tok-p">,</span> <span class="tok-k">atom </span><span class="tok-p">;</span>

<span class="tok-k">atom </span><span class="tok-o">=</span> <span class="tok-k">number </span><span class="tok-p">|</span> <span class="tok-k">identifier </span><span class="tok-p">|</span> <span class="tok-k">invocation </span><span class="tok-p">|</span> <span class="tok-s2">&quot;(&quot;</span><span class="tok-p">,</span> <span class="tok-k">expression</span><span class="tok-p">,</span> <span class="tok-s2">&quot;)&quot;</span> <span class="tok-p">;</span>

<span class="tok-k">invocation </span><span class="tok-o">=</span> <span class="tok-k">identifier</span><span class="tok-p">,</span> <span class="tok-s2">&quot;(&quot;</span> <span class="tok-p">[</span> <span class="tok-k">arguments </span><span class="tok-p">]</span> <span class="tok-s2">&quot;)&quot;</span> <span class="tok-p">;</span>

<span class="tok-k">arguments </span><span class="tok-o">=</span> <span class="tok-k">expression</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-s2">&quot;,&quot;</span> <span class="tok-k">expresssion </span><span class="tok-p">}</span> <span class="tok-p">;</span>

<span class="tok-k">identifier </span><span class="tok-o">=</span> <span class="tok-k">letter</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-k">letter </span><span class="tok-p">|</span> <span class="tok-k">digit </span><span class="tok-p">}</span> <span class="tok-p">;</span>

<span class="tok-k">digits </span><span class="tok-o">=</span> <span class="tok-k">digit</span><span class="tok-p">,</span> <span class="tok-p">{</span> <span class="tok-k">digit </span><span class="tok-p">}</span> <span class="tok-p">;</span>

<span class="tok-k">number </span><span class="tok-o">=</span> <span class="tok-p">(</span>  <span class="tok-k">digits</span><span class="tok-p">,</span> <span class="tok-p">[</span> <span class="tok-s2">&quot;.&quot;</span><span class="tok-p">,</span> <span class="tok-k">digits </span><span class="tok-p">]</span> <span class="tok-p">),</span> <span class="tok-p">[</span> <span class="tok-s2">&quot;e&quot;</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s2">&quot;-&quot;</span><span class="tok-p">],</span> <span class="tok-k">digits </span><span class="tok-p">]</span> <span class="tok-p">;</span>

<span class="tok-k">letter </span><span class="tok-o">=</span> <span class="tok-s2">&quot;A&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;B&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;C&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;D&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;E&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;F&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;G&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;H&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;I&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;J&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;K&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;L&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;M&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;N&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;O&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;P&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;Q&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;R&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;S&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;T&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;U&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;V&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;W&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;X&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;Y&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;Z&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;a&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;b&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;c&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;d&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;e&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;f&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;g&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;h&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;i&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;j&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;k&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;l&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;m&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;n&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;o&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;p&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;q&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;r&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;s&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;t&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;u&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;v&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;w&quot;</span>
       <span class="tok-p">|</span> <span class="tok-s2">&quot;x&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;y&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;z&quot;</span> <span class="tok-p">;</span>

<span class="tok-k">digit </span><span class="tok-o">=</span> <span class="tok-s2">&quot;0&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;1&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;2&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;3&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;4&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;5&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;6&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;7&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;8&quot;</span> <span class="tok-p">|</span> <span class="tok-s2">&quot;9&quot;</span> <span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We used Extended BackusâNaur form to write the grammar and we omitted the whitespace sequences for readability.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the help of this grammar we can generate inputs such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>R * 9 + 4 - 9</code></p>
</li>
<li>
<p><code>X - -i * (1) + 4</code></p>
</li>
<li>
<p><code>1 * 2 + e * x</code></p>
</li>
<li>
<p><code>(I * 4 / R / (H))</code></p>
</li>
<li>
<p><code>(I(8, 3) * (u - -b))</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <a href="#expressions-blackbox">Figure 17</a> the series named <em>Grammar</em> shows the results of fuzzing <code>ExpressionParser</code> with inputs generated with this grammar. It can be noticed that these inputs quickly reach a high number branches but do not make any progress beyond that. All generated inputs are syntactically valid, therefore this generation strategy never reaches branches executed for invalid inputs.</p>
</div>
<div class="paragraph">
<p><em>Mutation based fuzzing</em> proposes to use valid inputs in a different way. This approach uses a set of valid inputs as initial <em>seeds</em>. These inputs  may be generated with the help of a grammar, or they can be manually specified. They are first used to execute the program. Then to generate a new input, we randomly pick one of the seeds and we <em>mutate</em> it. That is, we perform a small modification on the seed to create a new input. <a href="#mutation-based-fuzzing">Listing 74</a> shows the pseudo-code of this strategy.</p>
</div>
<div id="mutation-based-fuzzing" class="listingblock">
<div class="title">Listing 74. An approach to guide input generation using coverage information.</div>
<div class="content">
<pre class="pygments highlight"><code><span></span>input: program, seeds
output: failures
procedure:

for seed in seeds:
    failure = execute program with seed
    if failure:
        add (seed, failure) to failures

until stopping conditions:
    take seed from seeds
    input = mutate seed
    failure = execute program with input
    if failure:
        add (input, failure) to failures
return failures</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mutations (not to confuse them with the mutation from mutation testing) can be very simple changes. For example, if the input is a string, we can mutate the seed by inserting a random character at a random position, or removing a random character or even removing a random slice of the string. We could also use a dictionary to insert a random keyword in a random position of the input. It may also make sense to perform more than one mutation at once on the same seed to increase the difference between the seed and the new input.</p>
</div>
<div class="paragraph">
<p>For our example, we use a mutation based fuzzer with the following seeds <code>" "</code>, <code>"1"</code>, <code>"1 + 2"</code>, <code>"min(1, 2)"</code>, <code>"-1"</code>. As mutations we use the following:
- remove a random character from the seed.
- add a random character from the alphabet we used in our first fuzzer in a random position
- replace a random character from the seed with another random character from the same alphabet</p>
</div>
<div class="paragraph">
<p>For each seed we perform between 2 and 5 random mutations. This produces inputs like the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>1 +</code></p>
</li>
<li>
<p><code>9 mp(1, 2)</code></p>
</li>
<li>
<p><code>min(12)</code></p>
</li>
<li>
<p><code>m,n( 2)</code></p>
</li>
<li>
<p><code>+d2E</code></p>
</li>
<li>
<p><code>P-M{R</code></p>
</li>
<li>
<p><code>1 + 2H</code></p>
</li>
<li>
<p><code>n(1,82)</code></p>
</li>
<li>
<p><code>*in,O)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results of the mutation based fuzzing strategy can be seen in the <em>Mutation</em> series shown in <a href="#expressions-blackbox">Figure 17</a>. Notice how this strategy reaches the highest number of branches and even converges faster to the final results.</p>
</div>
<div class="paragraph">
<p>The effectiveness of mutation based fuzzing depends on the initial seed selection and the nature of the mutations. In our example, including seeds with more arithmetic operators and even combinations on the operators might make the strategy discover more branches.</p>
</div>
<div class="paragraph">
<p>The input generation strategies discussed so far do not rely on any information about the internal structure of the program under test or the program execution to generate a new input. This is known as <em>black box</em> fuzzing. However, monitoring the program execution can lead to valuable information for the generation process. We can for, example, exploit more the inputs that execute hard-to-reach branches using them as seeds.</p>
</div>
<div class="paragraph">
<p><em>Greybox fuzzing</em> observes partial information from the program execution. For example, it can collect the branches executed with each input. This information can be used to affect the input generation. We can extend the mutation based fuzzing approach by augmenting the seeds with inputs that reach new branches. This approach is outlined in <a href="#greybox-fuzzing">Listing 75</a>. The rationale behind this idea is that mutating inputs reaching new branches increases the chances to discover new execution paths.</p>
</div>
<div id="greybox-fuzzing" class="listingblock">
<div class="title">Listing 75. A greybox fuzzing strategy that augments the seeds with inputs reaching new branches</div>
<div class="content">
<pre class="pygments highlight"><code><span></span>input: program, seeds
output: failures
procedure:

covered_branches = {}

for seed in seeds:
    failure, path = execute program with seed
    if failure:
        add (seed, failure) to failures
    else:
        add all branches in path to covered_branches

pool = [...seeds]
until stopping conditions:
    take seed from pool
    input = mutate seed
    failure, path = execute program with input
    if failure:
        add (input, failure) to failures
    else:
        if exists branch in path not in covered_branches:
            add all branches in path to covered_branches
            add input to pool
return failures</code></pre>
</div>
</div>
<div class="paragraph">
<p>In both, the approach above and the initial mutation based approach, all seeds are selected with the same probability to generate a new input. We can extend the original idea to favor the selection of more desirable seeds, for example, those producing less frequent execution paths. This new approach should help the fuzzing process cover more program elements in less time. It uses a <em>power schedule</em> assigning an <em>energy</em> value to each seed. The energy is the likelihood of a seed to be selected. The concrete energy assigned to each input depends on the characteristics we want to explore with seeds. Its value could be, for instance, inversely proportional to the number of times the same path has been executed, if we want to favor seeds with least explored program locations. It could also depend on the size of the seed or the number of branches covered in the execution. The overall process remains the same, the only thing that changes in this new approach with respect to greybox fuzzing is that each seed is selected according to the probability distribution defined by the energy of the seeds.</p>
</div>
<div class="paragraph">
<p>Both, the greybox strategy shown in <a href="#greybox-fuzzing">Listing 75</a> and the strategy using power schedules should lead to a faster branch discovery than the initial mutation based fuzzing. To compare them, we replicate the previous experiment. This time we use as seed a single empty string and the same mutations as before in all three fuzzing approaches. Since the initial seed is reduced we extend the number of inputs until 1000. The results are shown in <a href="#expressions-seeding-empty">Figure 18</a>.</p>
</div>
<div id="expressions-seeding-empty" class="imageblock text-center">
<div class="content">
<img src="images/expressions-seeding-empty.png" alt="Average branches for mutation based strategies" width="600">
</div>
<div class="title">Figure 18. Average number of branches reached by mutation based fuzzing, greybox fuzzing and fuzzing using a power schedule to select the seeds. Here the initial seed is the empty string and all three strategies use the same mutations as in the previous experiment.</div>
</div>
<div class="paragraph">
<p>Notice in the plot how the approach using power schedules is faster at discovering new branches and obtains the higher number in the end. In our example, both the blackbox mutation based fuzzer and the greybox fuzzer have comparable results with the latter reaching branches faster at some moments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_libraries_tools_and_practice">4.3. Libraries, tools and practice</h3>
<div class="paragraph">
<p>Fuzzing has become a mainstream testing technique. It has shown to be really effective in practice, in particular, to detect security issues in real software. One of the most used fuzzers is the already mentioned <a href="https://github.com/google/AFL">American Fuzzy Lop (AFL)</a>, a fuzzer for compiled C programs.</p>
</div>
<div class="paragraph">
<p>Roughly speaking, AFL takes an initial collection of user-provided files as seeds. New inputs are generated by subsequently mutating these seeds. First it applies simpler, deterministic and almost exhaustive mutations, like sequentially flipping from one to four bits in a row for the entire seed to generate several new inputs or replacing parts of the seed with predefined integer values, known to cause troubles like <code>-1</code> <code>MAX_INT-1</code> and so on. Then, it applies random mutations that could be the deletion, insertion or replacement of parts of the seed. The tool keeps track of the branch coverage for each input. The initial set of seeds is augmented with those inputs that reach new branches. Inputs are actually processed in a queue that gives priority to smaller files. Inputs for which the program under test crashes are reported at the end along with the set of all inputs reaching new branches.</p>
</div>
<div class="paragraph">
<p>AFL has been able to discover a large number of faults and security vulnerabilities in real life, well tested and widely used software like ImageMagick, gcc, qemu, git, OpenSSL, sqlite and many others.</p>
</div>
<div class="paragraph">
<p>The success of the tool has originated many derived projects and extensions to other languages like <a href="https://github.com/dvyukov/go-fuzz">go-fuzz</a> for Go, <a href="http://jwilk.net/software/python-afl">python-afl</a> for Python, <a href="http://llvm.org/docs/LibFuzzer.html">libFuzzer</a> for LLVM and the <a href="https://github.com/isstac/kelinci">Kelinci project</a> which implements a Java interface for AFL.</p>
</div>
<div class="paragraph">
<p>On its side, property based testing has been popularized among developers through libraries like <a href="https://hackage.haskell.org/package/QuickCheck">QuickCheck</a> for Haskell and its many derivate projects. Among the most popular alternatives for Java we may find: <a href="https://github.com/pholser/junit-quickcheck">junit-quickcheck</a>, <a href="https://github.com/quicktheories/QuickTheories">QuickTheories</a> and <a href="https://jqwik.net/">jqwik</a>. These libraries offer an alternative to write tests with random inputs closer to the way developers usually write their test cases, as opposed to an external tool like AFL. They generally provide different levels of integration with testing frameworks like JUnit, a set of general purpose and configurable value generators and an API to create our custom generators.</p>
</div>
<div class="paragraph">
<p><em>junit-quickcheck</em> has been implemented as a set of extensions for JUnit 4. <a href="#encode-decode-jqc">Listing 76</a> shows how to write our previous example from <a href="#encode-decode-junit">Listing 70</a> using this library. In the example we verify that the same input array is obtained after encoding it to base 64 and decoding it back. For this library properties are written inside methods annotated as <code>@Property</code>. These should be included in classes annotated with <code>@RunWith(JUnitQuickcheck.class)</code> which is a custom runner for test classes. In the best spirit of JUnit, the configuration of value generators can be done through built-in and custom annotations like ` @InRange(min = "0", max = "20")<code>. The library provides generators for all primitive Java types, strings, standard classes like `java.lang.Date</code>, enums, arrays and collections of supported types and many others.</p>
</div>
<div id="encode-decode-jqc" class="listingblock">
<div class="title">Listing 76. Encode-decode property testing with junit-quickcheck.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">JUnitQuickcheck</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EncoderDecoderTest</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Property</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">encodeDecode</span><span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">assertArrayEquals</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">decodeBase64</span><span class="tok-o">(</span><span class="tok-n">encodeBase64</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">)));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>jqwik</em> has been implemented as an alternative JUnit 5 test engine. A test engine is a component in charge of discovering and executing tests written with a particular convention. In fact, JUnit 5 includes Jupiter as a standard test engine and Vintage, an engine compatible with JUnit 4 tests. jqwik can be combined with those other engines or can be used as a standalone engine. With this library properties are implemented in methods marked with <code>@Property</code>. These methods should be <code>void</code> or <code>boolean</code>. A a <code>void</code> property should throw an exception when the property is not met and we can use any assertion library. A <code>boolean</code> method should return false in that case. This library also includes generators for primitive values, strings, collections, arrays, enums and streams, functional types, and iterators. The configuration of generators is achieved through parameter annotations. <a href="#encode-decode-jqwik">Listing 77</a> shows the corresponding implementation of the example from <a href="#encode-decode-junit">Listing 70</a>.</p>
</div>
<div id="encode-decode-jqwik" class="listingblock">
<div class="title">Listing 77. Encode-decode property testing with jqwik.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">EncoderDecoderTest</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Property</span>
    <span class="tok-kt">boolean</span> <span class="tok-nf">encodeDecodeReturnsInput</span><span class="tok-o">(</span><span class="tok-nd">@ForAll</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">decodeBase64</span><span class="tok-o">(</span><span class="tok-n">encodeBase64</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">)));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>QuickTheories</em> is actually independent from any testing framework and any assertion library. It proposes a fluent API to create, configure and run value generators.  <a href="#encode-decode-qt">Listing 78</a> shows how to use the library to implement the example from <a href="#encode-decode-junit">Listing 70</a>. Here <code>qt</code>, <code>byteArrays</code>, <code>range</code> and <code>bytes</code> are all QuickTheories utilities that we have used to create a byte array generator producing arrays of lengths between 0 and 100 and including the entire range of byte values. <code>check</code> takes a <code>Predicate</code> or a <code>Consumer</code>. The former should return <code>false</code> if the property is not met by the given input and the latter should throw an <code>AssertionError</code> in the same case</p>
</div>
<div id="encode-decode-qt" class="listingblock">
<div class="title">Listing 78. Encode-decode property testing with QuickTheories.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kt">void</span> <span class="tok-nf">testEncoderDecoder</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">qt</span><span class="tok-o">().</span><span class="tok-na">forAll</span><span class="tok-o">(</span><span class="tok-n">byteArrays</span><span class="tok-o">(</span>
            <span class="tok-n">range</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">),</span>
            <span class="tok-n">bytes</span><span class="tok-o">(</span><span class="tok-n">Byte</span><span class="tok-o">.</span><span class="tok-na">MIN_VALUE</span><span class="tok-o">,</span> <span class="tok-n">Byte</span><span class="tok-o">.</span><span class="tok-na">MAX_VALUE</span><span class="tok-o">,</span> <span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">)</span> <span class="tok-mi">0</span><span class="tok-o">)))</span>
        <span class="tok-o">.</span><span class="tok-na">check</span><span class="tok-o">(</span><span class="tok-n">array</span> <span class="tok-o">-&gt;</span>
                <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">decodeBase64</span><span class="tok-o">(</span><span class="tok-n">encodeBase64</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">))));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Apart from the already mentioned functionalities, these three libraries try to shrink an input that does not met the property in order to report the smallest possible value manifesting the failure.</p>
</div>
<div class="paragraph">
<p>Fuzzing can be incorporated to CI/CD processes. For example, we can launch a fuzzing build step once a week, or after a push identifying a release candidate revision in our project. In December 2016, Google moved in that direction by launching <a href="https://github.com/google/oss-fuzz">OSS-Fuzz</a>, a platform for <em>continuous fuzzing</em> of open-source projects. The platform runs fuzzers configured in open-source projects or selected commits or pull requests. It relies underneath on AFL, libFuzzer and <a href="https://github.com/google/honggfuzz">Honggfuzz</a>. Any issue found is reported back to the developers. At the moment, OSS-Fuzz has found thousands of verified issues in well known software like curl, sqlite, zlib, LibreOffice, FFmpeg and many others.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graphical_user_interface_testing">5. Graphical User Interface testing</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first part of this section and the discussion about Test* follow the same structure as the <a href="https://www.youtube.com/playlist?list=PL3bOx_OjZk8EvOo3un0xeGpXlqGT2YQXa">online material on GUI testing</a> published by professor Tanja Vos from the University of Valencia.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most applications: desktop, mobile, web and even embedded systems from cards and medical equipment have a Graphical User Interface (GUI). The GUI stands between the user and the underlying code of the application and provides access to all the functionalities. It is also the place where users find failures. Therefore, testing the GUI can potentially discover those unwanted failures.</p>
</div>
<div class="paragraph">
<p>A GUI is conformed by visual elements we call <em>widgets</em>. These can be text boxes, checkboxes, buttons, menus, scrollbars and often custom made widgets.  Widgets are usually organized in a tree in which container widgets hold children widgets and so on. Each widget has a set of properties, for example, the position of the widget, the size, the background color, the font and the values it handles like the text in a text box. The concrete values at runtime of these properties conform the state of the widget. By extension, the state of the GUI is conformed by the widget tree and the state of all widgets. Users can affect the state of the GUI by performing actions on the widgets. That is, users can <em>click</em> on a checkbox or a button, enter a text, select an option in a list or drag an image.</p>
</div>
<div id="gui-example" class="imageblock text-center">
<div class="content">
<img src="images/gui-example.png" alt="GUI example" width="600">
</div>
<div class="title">Figure 19. A very simple GUI</div>
</div>
<div class="paragraph">
<p><a href="#gui-example">Figure 19</a> shows an example of a very simple GUI of a subscription application. The root of the widget tree is a form. This form contains several widgets for users to enter their information: text boxes for the name and email, a combobox to select the country, a submit button and a link. The combobox on its side contains a menu whose children are items corresponding to each possible selection. Initially, the <em>Name</em> text box has as properties: <code>width = 300</code>, <code>height = 15</code>, <code>placeholder = "Name"</code> and <code>text = ""</code>. After a user enters her name, then the <code>text</code> property changes with the corresponding value. The same goes for the rest of the widgets.</p>
</div>
<div class="paragraph">
<p>GUI tests are a form of system tests, as they execute the entire application. They are designed from the user&#8217;s perspective. In general terms, a GUI test initializes the system under test, performs a series of GUI actions and then, it checks if the GUI state is correct.</p>
</div>
<div class="paragraph">
<p>For our small GUI a test case could be designed as following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the subscription form</p>
</li>
<li>
<p>Enter "Jane Doe" in <em>Name</em></p>
</li>
<li>
<p>Enter "<a href="mailto:jave@example.com">jave@example.com</a>" in <em>Email</em></p>
</li>
<li>
<p>Select "Canada" in <em>Country</em></p>
</li>
<li>
<p>Click <em>Submit</em></p>
</li>
<li>
<p>Expect success message</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This test checks that a user, entering the right information, is able to subscribe to the system. A test checking if the application detects an error in the data, for example, that the email is valid would do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the subscription form</p>
</li>
<li>
<p>Enter "Jane Doe" in <em>Name</em></p>
</li>
<li>
<p>Enter "not an email" in <em>Email</em></p>
</li>
<li>
<p>Click <em>Submit</em></p>
</li>
<li>
<p>Expect an error under <em>Email</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In general, GUI tests should verify that the required information is visible in the screen, that the position and size of the widgets is correct, that the appropriate error messages are shown at the right time and that the application does not crash or closes unexpectedly.</p>
</div>
<div class="paragraph">
<p>As with the rest of tests, manually executing GUI tests is tedious an extremely error prone, so we need to automate their execution. There are four main approaches to GUI test automation, all with their pros and cons:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Capture and replay</dt>
<dd>
<p>Tests are executed manually once and a specialized tool records the actions performed by the user. Then, the tests can be executed as many times as we want and the result should be the same. This is a simple option to automate GUI tests that do not require testers to have programming skills. On the other side this form of test is highly sensitive to GUI changes. Any small modification to the interface renders the tests invalid and they have to be recreated again.</p>
</dd>
<dt class="hdlist1">Develop test scripts</dt>
<dd>
<p>We can develop scripts that emulate user actions and query the GUI state. This approach requires programming skills and it is arguably the most appealing for developers. There are plenty of libraries, frameworks and even domain specific languages (DSLs) to develop GUI test scripts for desktop, web and mobile applications, being <a href="https://selenium.dev/">Selenium</a> one of the most used for the web. These tests can be usually integrated with testing frameworks like JUnit. As with other forms of tests, these have to be maintained and changed whenever the GUI changes. <a href="#simple-selenium-test">Listing 79</a> shows an implementation of a test verifying that the application shows an error if the user forgets to enter the name. It uses Selenium combined with JUnit and Hamcrest.</p>
<div id="simple-selenium-test" class="listingblock">
<div class="title">Listing 79. A simple Selenium test checking that the application shows an error if the user forgets to specify the name.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testMissingName</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-n">String</span> <span class="tok-n">url</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://localhost:5000&quot;</span><span class="tok-o">;</span>

    <span class="tok-n">WebDriver</span> <span class="tok-n">driver</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChromeDriver</span><span class="tok-o">();</span>

    <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">(</span><span class="tok-s">&quot;email&quot;</span><span class="tok-o">)).</span><span class="tok-na">sendKeys</span><span class="tok-o">(</span><span class="tok-s">&quot;jane@example.com&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-n">Select</span> <span class="tok-n">countrySelector</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Select</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">(</span><span class="tok-s">&quot;country&quot;</span><span class="tok-o">)));</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-n">countrySelector</span><span class="tok-o">.</span><span class="tok-na">selectByValue</span><span class="tok-o">(</span><span class="tok-s">&quot;Canada&quot;</span><span class="tok-o">);</span> <i class="conum" data-value="4"></i><b>(4)</b>

    <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">(</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-o">)).</span><span class="tok-na">click</span><span class="tok-o">();</span> <i class="conum" data-value="5"></i><b>(5)</b>

    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">WebElement</span><span class="tok-o">&gt;</span> <span class="tok-n">errors</span> <span class="tok-o">=</span>  <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElements</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">className</span><span class="tok-o">(</span><span class="tok-s">&quot;error&quot;</span><span class="tok-o">));</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">errors</span><span class="tok-o">,</span> <span class="tok-n">hasSize</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">));</span> <i class="conum" data-value="7"></i><b>(7)</b>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Go to the address where the application is deployed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Find the email text box and fill it with <code>jave@example.com</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Find the combobox for the country.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enter <code>Canada</code> as the country value.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Find and click the <code>Submit</code> button.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Find error elements in the page.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Check that there is at least one error element.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, the code of this test is hard to follow, as it contains many GUI queries cluttering its actual intent. This particular test is also tangled with the GUI design. For example, errors are discovered by finding HTML elements with an <code>error</code> class. If the GUI design changes, we need to change this part of the code in all tests doing the same. Therefore we need to find a way to develop these tests so they have a simpler code and are robust to changes. We shall discuss the <em>Page Object Model</em> <a href="#fowler2013page">(84)</a> pattern for this matter.</p>
</div>
</dd>
<dt class="hdlist1">Visual scripts</dt>
<dd>
<p>An interesting alternative to test scripts. The widgets participating in the tests are specified using images from screen captures of the application. The test execution uses image recognition techniques to detect the position of the widgets. <a href="https://eyeautomate.com/">EyeAutomate</a> provides a set of tools to achieve this. While it is a simple alternative to put into practice, it still requires a sophisticated machinery underneath and it is still highly sensitive to GUI changes.</p>
<div id="eyeautomate-script" class="imageblock text-center">
<div class="content">
<img src="images/eyeautomate-script.png" alt="EyeAutomate script" width="600">
</div>
<div class="title">Figure 20. EyeAutomate script</div>
</div>
</dd>
<dt class="hdlist1">Automated GUI testing</dt>
<dd>
<p>In the previous section we saw that we can automatically generate interesting test inputs and even test code. GUI tests are not an exception on that. Automating the GUI testing process requires a way to obtain the GUI state and the possible GUI actions. This allows to execute the application and automatically decide a sequence of actions to perform and a way to check the consistency of the GUI state. This can be seen as a type of fuzzing directed to the user actions as the input domain of the application. <a href="https://testar.org/">Test*</a> implements this idea and automatically check the robustness of applications against random actions.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the remaining sections we shall discuss how to write our GUI tests with the help of Selenium and how tools like Test* achieve GUI test automation.</p>
</div>
<div class="sect2">
<h3 id="_writing_test_scripts">5.1. Writing test scripts</h3>
<div class="paragraph">
<p><a href="#simple-selenium-test">Listing 79</a> shows an example of a test written with Selenium to check the response of the subscription form when the user forgets to enter her name.</p>
</div>
<div class="paragraph">
<p>Selenium is a set of libraries and tools designed to automate the interaction with web browsers. Although it is widely used for testing, it can be employed in many other automation tasks. Its core functionalities are based on the <em>WebDriver</em>, an API that makes possible to inspect remotely control browsers by emulating user actions and allows code to inspect the content presented by the browser. Other alternatives like <a href="https://pptr.dev/">Puppeteer</a> do the same based on the Chrome DevTools protocol.</p>
</div>
<div class="paragraph">
<p>Concrete WebDrivers are specific to each browser, but the API is general enough so the code we write works no matter the browser we are using. In <a href="#simple-selenoum-test">[simple-selenoum-test]</a> we can notice that it is possible to search for web elements using their identifiers <code>By.id</code> or style class name <code>By.className</code>. We see that we can send keyboard input with <code>sendKeys</code>, select an element with <code>selectByValue</code> and even <code>click</code> on web page elements. The functionalities of Selenium go way beyond this basic operations as they permit to inspect every aspect of the web page and to build more complex interactions like drag and drops.</p>
</div>
<div class="paragraph">
<p>Suppose we want to write a similar test case for our application to verify the scenario in which the user forgets to enter the country. The code will be pretty much the same as before. But we know applications change in time. In particular, the GUI changes to improve the user experience, make the application more appealing or because we are incorporating a new framework with better user controls.</p>
</div>
<div class="paragraph">
<p>If, for example, we decide to show errors differently, or we decide to change the way the country is selected, then we have to change the code of all test cases we wrote this way. The GUI changed but the requirements are the same: there should be an error when the user forgets some of the form values. The test cases should be changed for technical reasons and tests should reflect more the requirements than the application implementation. Also, the GUI queries to obtain the visual elements are interweaved inside the test code. This makes the test case harder to read and understand. Its intent gets hidden by the machinery to build the tests.</p>
</div>
<div class="paragraph">
<p>The <em>Page Object Model</em> is a code design pattern that precisely aims at solving these two issues. Here we illustrate the pattern with a web application, but it could be used to test other forms of GUI as well.</p>
</div>
<div class="sect3">
<h4 id="_page_object_model">5.1.1. Page Object Model</h4>
<div class="paragraph">
<p><em>Page Object Model</em> or simply <em>Page Object</em> is a design pattern that proposes to separate the test code from the page/GUI specific code <a href="#fowler2013page">(84)</a>. The main idea is to create classes to model each page in our application. These classes shall become the interface between the tests and the GUI. Page objects should allow the tests to do and see anything human users would do while providing a simple programming interface.</p>
</div>
<div class="paragraph">
<p>In a page object, any information exposed by the page, should become a property, any action a user can do should become a behavior or method of the class. This is an Object-Oriented approach to encapsulate GUI specific code and hide the structural complexity of the GUI. If the GUI changes, then only the page objects will change and not the test code. <a href="#page-object-example">Listing 80</a> shows how the test case from <a href="#simple-selenium-test">Listing 79</a> could be written with a page object <code>SubscribePage</code> representing the subscription page. The <code>SubscribePage</code> has methods to emulate the possible actions: <code>typeEmail</code>, <code>selectCountry</code> and <code>submit</code>. It also has <em>accessors</em> to retrieve this information and the errors shown in the page.</p>
</div>
<div id="page-object-example" class="listingblock">
<div class="title">Listing 80. Rewriting the test case shown in <a href="#simple-selenium-test">Listing 79</a> using a page object.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testMissingName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;http://localhost:5000&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">SubscribePage</span> <span class="tok-n">page</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SubscribePage</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">);</span>
    <span class="tok-n">page</span><span class="tok-o">.</span><span class="tok-na">typeEmail</span><span class="tok-o">(</span><span class="tok-s">&quot;jane@example.com&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">selectCountry</span><span class="tok-o">(</span><span class="tok-s">&quot;Canada&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">submit</span><span class="tok-o">();</span>
    <span class="tok-n">assertThat</span><span class="tok-o">(</span><span class="tok-n">page</span><span class="tok-o">.</span><span class="tok-na">errors</span><span class="tok-o">(),</span> <span class="tok-n">hasSize</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">));</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When creating page objects there is no need to represent the entire page, not even all pages in the application. We should focus on what is essential for testing. Doing otherwise will create an unnecessary burden as these objects have to be maintained. On the other hand, a page object may be composed by other page objects representing recurrent components in the application. Page objects should not contain assertions, so they can be reused among different tests, but they may include general purpose checks, for example, verify that the  webdriver navigates the right page and that application the hasn&#8217;t crashed.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s explore this pattern in a more complete example. We shall use Selenium from Java to test the <a href="https://github.com/barais/doodlestudent">Simba Organizer</a> web application. This application is composed by a backend developed in Java using <a href="https://quarkus.io/">Quarkus</a> and a frontend developed in TypeScript using <a href="https://angular.io/">Angular</a> and third party libraries like <a href="https://www.primefaces.org/primeng/">PrimeNG</a> and <a href="https://fullcalendar.io/">FullCalendar</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Testing an Angular application from Java using Selenium is not the ideal option. However, it is feasible and the Java+Selenium stack can be applied to web applications developed in any other framework than Angular. For Angular applications the best choice is to use <a href="https://www.protractortest.org/">Protractor</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Simba Organizer is a teaching project used in different student assignments at <a href="https://istic.univ-rennes1.fr/">ISTIC</a>, University of Rennes 1. It is  a doodle-like application that allows a set of users to agree on the schedule of a meeting. One user creates an initial poll to decide the schedule of a meeting and proposes some time slots. Then the participants shall pick the option that best fits their availability and possibly send some comments. The application also interacts with services to create a shared pad for the meeting, to create a chatroom and to let users check their calendars when picking the time slot.</p>
</div>
<div class="paragraph">
<p>The workflow to create a poll for a meeting starts with a landing page shown in <a href="#simba-starting-page">Figure 21</a>. This page shows some instructions and the only action a user can do is to click the button at the bottom to start creating a poll. The actual poll creation page can be directly accessed, then modeling the landing page is not essential.</p>
</div>
<div id="simba-starting-page" class="imageblock text-center">
<div class="content">
<img src="images/simba-start-page.png" alt="Landing page" width="600">
</div>
<div class="title">Figure 21. Landing page of Simba Organizer</div>
</div>
<div class="paragraph">
<p>The poll creation page is shown in <a href="#simba-information-page">Figure 22</a>. In this page a user must enter the general information of the meeting: mandatory title and place, optional description and whether the meeting will include a meal. Then, the user must click <em>Next</em> to move into the next creation step. If the user forgets one of the mandatory elements, then an error will be shown and the page will not change.</p>
</div>
<div id="simba-information-page" class="imageblock text-center">
<div class="content">
<img src="images/simba-information-page.png" alt="Meeting poll page" width="600">
</div>
<div class="title">Figure 22. Meeting poll initial page. The user must enter a title a place and optionally a description, to be able to go to the next step.</div>
</div>
<div class="paragraph">
<p>This page can be modeled by the class shown in <a href="#simba-information-page-model">Listing 81</a>. The class has a constructor taking the <code>WebDriver</code> it should use to locate the web elements and interact with the browser. The class includes getter or accessor methods for all values shown in the form: title, place, description and <code>hasMeal</code> to know whether this value has been selected. In general, the accessor should be simple, they just find somehow the web element and returns the corresponding value. The result type of these methods should be as simple as possible: primitive types, string or simple data types. The goal is to reflect what is shown in the page and nothing more. Notice in the code how <code>title</code> was implemented: we use the driver to locate an input web element with id <code>titre</code> and then return the text value. Each action is represented as a method returning a page object. The implementation of <code>typeTitle</code> first finds the element and then instructs the browser to type the corresponding value. There may two possible outcomes when the user clicks <em>Next</em>: if there is an error the page does not change and error messages are shown. Otherwise the application shows the next step. We model these two scenarios with methods <code>next</code> and <code>nextExectingErrors</code>. Having two separate methods for this makes the test more readable and keeps the implementation simpler.</p>
</div>
<div id="simba-information-page-model" class="listingblock">
<div class="title">Listing 81. A model for the first poll creation page.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">InformationPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">InformationPage</span><span class="tok-o">(</span><span class="tok-n">WebDriver</span> <span class="tok-n">driver</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">title</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">(</span><span class="tok-s">&quot;titre&quot;</span><span class="tok-o">)).</span><span class="tok-na">getText</span><span class="tok-o">();</span>
     <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">typeTitle</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">(</span><span class="tok-s">&quot;titre&quot;</span><span class="tok-o">)).</span><span class="tok-na">sendKeys</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">place</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">typePlace</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">description</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">typeDescription</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasMeal</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">setHasMeal</span><span class="tok-o">(</span><span class="tok-kt">boolean</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">errors</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">DateselectionPage</span> <span class="tok-nf">next</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">cssSelector</span><span class="tok-o">(</span><span class="tok-s">&quot;p-button[label=Next]&quot;</span><span class="tok-o">)).</span><span class="tok-na">click</span><span class="tok-o">();</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">DateselectionPage</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">);</span>

    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">nextExpectingErrors</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">cssSelector</span><span class="tok-o">(</span><span class="tok-s">&quot;p-button[label=Next]&quot;</span><span class="tok-o">)).</span><span class="tok-na">click</span><span class="tok-o">();</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#simba-information-page-model">Listing 81</a> we have repeated <code>driver.findElement</code> queries several times. These can be avoided by simply having instance fields holding the right value and filling them in the construction. Selenium also provides some functionalities to make this simpler and more declarative using annotations. This is shown in <a href="#using-annotations-webelements">Listing 82</a>. We annotate fields with the corresponding element selectors and call <code>PageFactory.initElements</code> will handle their creation and assignment.</p>
</div>
<div id="using-annotations-webelements" class="listingblock">
<div class="title">Listing 82. Using annotations to make the code simpler.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">InformationPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-n">WebDriver</span> <span class="tok-n">driver</span><span class="tok-o">;</span>

    <span class="tok-nd">@FindBy</span><span class="tok-o">(</span><span class="tok-n">id</span> <span class="tok-o">=</span> <span class="tok-s">&quot;titre&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">private</span> <span class="tok-n">WebElement</span> <span class="tok-n">titleInput</span><span class="tok-o">;</span>

    <span class="tok-nd">@FindBy</span><span class="tok-o">(</span><span class="tok-n">css</span> <span class="tok-o">=</span><span class="tok-s">&quot;p-button[label=Next]&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">private</span> <span class="tok-n">WebElement</span> <span class="tok-n">nextButton</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">InformationPage</span><span class="tok-o">(</span><span class="tok-n">WebDriver</span> <span class="tok-n">driver</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Objects</span><span class="tok-o">.</span><span class="tok-na">requireNonNull</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">);</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">driver</span> <span class="tok-o">=</span> <span class="tok-n">driver</span><span class="tok-o">;</span>
        <span class="tok-n">PageFactory</span><span class="tok-o">.</span><span class="tok-na">initElements</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">title</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">titleInput</span><span class="tok-o">.</span><span class="tok-na">getText</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">nextExpectingErrors</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">nextButton</span><span class="tok-o">.</span><span class="tok-na">click</span><span class="tok-o">();</span>
        <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the user specifies the initial information of the meeting the application shows a page where she can select the initial options for the time slots. This page is shown in <a href="#simba-date-options">Figure 23</a>. This page shows a calendar component where the user can create the time slots. It has also a switch the user can activate to enter a URL to an <em>iCalendar</em> feed so she can check her own time occupation. The user can move to the next stop at any time since it is not mandatory to set these initial options for the poll.</p>
</div>
<div id="simba-date-options" class="imageblock text-center">
<div class="content">
<img src="images/simba-date-options.png" alt="Date options" width="600">
</div>
<div class="title">Figure 23. Page to select date options. The user may select time slots using the calendar component/widget. Optionally she can add her own ICS calendar to see her own time occupation.</div>
</div>
<div class="paragraph">
<p>This page is particularly challenging for testing. On the one hand, the interaction with the calendar is rather complex. Users should click, drag and release the mouse to create an event in the calendar. Furthermore, users can even edit the events they have already created. On the other hand, fetching the iCalendar feed is an asynchronous operation which posses timing problems.</p>
</div>
<div class="paragraph">
<p>We should make page object models as simple as possible, since they must be updated each time the GUI changes. So, we should not aim at implementing all the calendar functionalities, besides, this a third party component that we may change at any time and we are not interested in testing it. At this point we assume it works correctly.</p>
</div>
<div class="paragraph">
<p>For the asynchronous operations we have not better solution than to wait until its result become visible. But also, we must set a reasonable timeout for the wait, so in case the operation fails and never sends back the results the test can also fail. These timeouts are often sources of flaky tests as we saw in previous sections so they must be handled with care.</p>
</div>
<div class="paragraph">
<p><a href="#simba-date-options-model">Listing 83</a> shows how we can model this page. The purpose of this page is to select the initial time slot proposals. This is achieved with <code>addOption</code>. The method takes only the start and end <code>LocalDateTime</code> instances to create the slot. <code>LocalDateTime</code> is a class included in the <code>java.time</code> package. Inside, the method should interact with the calendar component to click in the right places. This may be hard. Since this is an Angular application we can also interact directly with the JavaScript code, which breaks a bit the encapsulation but might be simpler. There is no easy solution for this. However, implementing <code>addOption</code> hides all this complexity form the tests and makes the operation reusable. On its side, the <code>options</code> method returns the time slots we added to the calendar. <code>Slot</code> is a simple data class we created to represent a pair of start and end <code>LocalDateTime</code>.</p>
</div>
<div id="simba-date-options-model" class="listingblock">
<div class="title">Listing 83. A model for the time slots selection page.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DateSelectionPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">DateSelectionPage</span><span class="tok-o">(</span><span class="tok-n">WebDriver</span> <span class="tok-n">driver</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasICS</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">DateSelectionPage</span> <span class="tok-nf">setHasICS</span><span class="tok-o">(</span><span class="tok-kt">boolean</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isICSVisible</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">ICS</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">DateSelectionPage</span> <span class="tok-nf">typeICS</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">DateSelectionPage</span> <span class="tok-nf">addOption</span><span class="tok-o">(</span><span class="tok-n">LocalDateTime</span> <span class="tok-n">start</span><span class="tok-o">,</span> <span class="tok-n">LocalDateTime</span> <span class="tok-n">end</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Slot</span><span class="tok-o">&gt;</span> <span class="tok-nf">options</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Slot</span><span class="tok-o">&gt;</span> <span class="tok-nf">ICSEvents</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">SummaryPage</span> <span class="tok-nf">next</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">back</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the user wants to consult her iCalendar, she must activate the switch, then a text box appears and she should enter the right URL there. Then, the events are fetched and shown in the calendar. All these operations are encapsulated in <code>setHasICS</code> to activate or deactivate the switch, <code>isICSVisible</code> to know if the text box is visible, <code>ICS</code> to get the value specified for the iCalendar URL, <code>typeICS</code> to set the value and <code>ICSEvents</code> to consult the events displayed in the calendar. Typing the iCalendar URL needs the text box to be visible. While the operation seems immediate after we activate the switch we have to be sure that the web element is visible. We can instruct the driver to wait for such things, <a href="#waiting-for-visibility">Listing 84</a> shows how we can do that.</p>
</div>
<div id="waiting-for-visibility" class="listingblock">
<div class="title">Listing 84. A snippet of code showing how we can wait for an element to be visible.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">timeout</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="tok-n">WebDriverWait</span> <span class="tok-n">wait</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WebDriverWait</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">,</span> <span class="tok-n">timeout</span><span class="tok-o">);</span>
<span class="tok-n">WebElement</span> <span class="tok-n">element</span> <span class="tok-o">=</span> <span class="tok-n">driver</span><span class="tok-o">.</span><span class="tok-na">findElement</span><span class="tok-o">(</span><span class="tok-n">By</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">(</span><span class="tok-s">&quot;ics&quot;</span><span class="tok-o">));</span>
<span class="tok-n">ExpectedCondition</span><span class="tok-o">&lt;</span><span class="tok-n">Webelement</span><span class="tok-o">&gt;</span> <span class="tok-n">condition</span> <span class="tok-o">=</span> <span class="tok-n">ExpectedConditions</span><span class="tok-o">.</span><span class="tok-na">visibilityOf</span><span class="tok-o">(</span><span class="tok-n">element</span><span class="tok-o">),</span> <span class="tok-n">timeout</span><span class="tok-o">);</span>
<span class="tok-n">wait</span><span class="tok-o">.</span><span class="tok-na">until</span><span class="tok-o">(</span><span class="tok-n">condition</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the class is similar to the previous model: it has methods to access the information and method to go to the previous and next steps. When creating page object models it might be a good idea to have a base class, in which we can put all the common actions, for example, navigation methods, the waiting code and default timeouts. Then all the models we write can extend this base class.</p>
</div>
<div class="paragraph">
<p>After the poll has been created, the application displays a summary page shown in <a href="#simba-summary-page">Figure 24</a>.</p>
</div>
<div id="simba-summary-page" class="imageblock text-center">
<div class="content">
<img src="images/simba-summary-page.png" alt="Summary page" width="600">
</div>
<div class="title">Figure 24. Poll summary page with links to a page for the participants, an admin page to modify and close the poll and links to a shared pad and a chatroom provided by external services.</div>
</div>
<div class="paragraph">
<p>The model is simple, it just provides access to the URLs and method to navigate to the administration and participation pages. The chatroom and pad URLs are provided by third party services. We may opt not to create page object models for them or to create very simple classes to query the content of the pages to see if the information is correct, but nothing more since we do not want to test external components.</p>
</div>
<div id="simba-summary-page-model" class="listingblock">
<div class="title">Listing 85. A model for the summary page.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SummaryPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">SummaryPage</span><span class="tok-o">(</span><span class="tok-n">WebDriver</span> <span class="tok-n">driver</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">urls</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">participationURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">adminURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">chatRoomURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">padURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">ParticipationPage</span> <span class="tok-nf">navigateParticipationURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">AdminPage</span> <span class="tok-nf">navigateAdminPage</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">DateSelectionPage</span> <span class="tok-nf">back</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The poll administration page is shown in <a href="#simba-admin-page">Figure 25</a>. It shows the title, the place, if there is a meal planned for the meeting, comments from the participants, each option, and buttons to select the final option and close the poll. It also has links to create a new poll, to modify the existing poll, to go to the chatroom, the pad and even to share the poll. The model is shown in <a href="#simba-admin-page-model">Listing 86</a>. It is similar to the models before. The new aspect here is that we have modeled each option visual section as a different page object. This reduces the complexity of the <code>AdminPage</code> code.</p>
</div>
<div id="simba-admin-page" class="imageblock text-center">
<div class="content">
<img src="images/simba-admin-page.png" alt="Admin page" width="600">
</div>
<div class="title">Figure 25. Poll administration page. It shows the information about the meeting, all the time slots proposed and comments sent by the participants. The administrator may select one of the options to close the poll. She can also edit the poll and create a new one.</div>
</div>
<div id="simba-admin-page-model" class="listingblock">
<div class="title">Listing 86. A model for the admin page.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AdminPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">AdminPage</span><span class="tok-o">(</span><span class="tok-n">WebDriver</span> <span class="tok-n">driver</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">createNew</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">InformationPage</span> <span class="tok-nf">modify</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">title</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">place</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasMeal</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">comments</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">OptionPanel</span><span class="tok-o">&gt;</span> <span class="tok-nf">options</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">chatRoomURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">padURL</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">urlToShare</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>OptionPanel</code> class is shown in <a href="#simba-option-panel-model">Listing 87</a>. It contains information about the start and end times and a method to select the option.</p>
</div>
<div id="simba-option-panel-model" class="listingblock">
<div class="title">Listing 87. A model to represent each option and interact with it.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">class</span> <span class="tok-nc">OptionPanel</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-n">LocalDateTime</span> <span class="tok-nf">startsAt</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">LocalDateTime</span> <span class="tok-nf">endsAt</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">AdminPage</span> <span class="tok-nf">select</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-o">...</span> <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the models in place we can start writing test cases. <a href="#test-mandatory-fields">Listing 88</a> shows a test case that checks if the application shows an error when the user forgets the title of the meeting.</p>
</div>
<div id="test-mandatory-fields" class="listingblock">
<div class="title">Listing 88. A test case checking that an error is shown if the user forgets the title.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kt">void</span> <span class="tok-nf">testNoTitleShowsAnError</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">navigate</span><span class="tok-o">(</span><span class="tok-n">CREATE_URL</span><span class="tok-o">);</span>
    <span class="tok-n">InformationPage</span> <span class="tok-n">page</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">InformationPage</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">);</span>
    <span class="tok-n">page</span><span class="tok-o">.</span><span class="tok-na">typeDescription</span><span class="tok-o">(</span><span class="tok-s">&quot;We shall discuss very important matters while having a nice meal.&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">typePlace</span><span class="tok-o">(</span><span class="tok-s">&quot;Very interesting place&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">setHasMeal</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">nextExpectingErrors</span><span class="tok-o">()</span>
    <span class="tok-o">;</span>
    <span class="tok-n">assertFalse</span><span class="tok-o">(</span><span class="tok-n">page</span><span class="tok-o">.</span><span class="tok-na">errors</span><span class="tok-o">().</span><span class="tok-na">isEmpty</span><span class="tok-o">());</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#test-option-admin">Listing 89</a> shows a test case verifying that the admin page displays the option selected during the creation of the poll. It is already a long test case that would be more complex without page objects.</p>
</div>
<div id="test-option-admin" class="listingblock">
<div class="title">Listing 89. A test case checking the right option is shown in the poll administration page.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kt">void</span> <span class="tok-nf">getTheOptions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">navigate</span><span class="tok-o">(</span><span class="tok-n">CREATE_URL</span><span class="tok-o">);</span>

    <span class="tok-c1">// Meeting information</span>
    <span class="tok-n">InformationPage</span> <span class="tok-n">information</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">InformationPage</span><span class="tok-o">(</span><span class="tok-n">driver</span><span class="tok-o">);</span>
    <span class="tok-n">information</span><span class="tok-o">.</span><span class="tok-na">typeTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Meeting&quot;</span><span class="tok-o">).</span><span class="tok-na">typePlace</span><span class="tok-o">(</span><span class="tok-s">&quot;Place&quot;</span><span class="tok-o">);</span>

    <span class="tok-c1">//Selecting options</span>
    <span class="tok-n">DateSelectionPage</span> <span class="tok-n">dateSelection</span> <span class="tok-o">=</span> <span class="tok-n">information</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
    <span class="tok-n">LocalDate</span> <span class="tok-n">nextWorkingDate</span> <span class="tok-o">=</span> <span class="tok-n">DateUtils</span><span class="tok-o">.</span><span class="tok-na">nextWorkingDay</span><span class="tok-o">();</span>
    <span class="tok-n">LocalDateTime</span> <span class="tok-n">meetingStartsAt</span> <span class="tok-o">=</span> <span class="tok-n">LocalDateTime</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-n">nextWorkingDate</span><span class="tok-o">,</span> <span class="tok-n">LocalTime</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">));</span>
    <span class="tok-n">LocalDateTime</span> <span class="tok-n">meetingEndsAt</span> <span class="tok-o">=</span> <span class="tok-n">LocalDateTime</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-n">nextWorkingDate</span><span class="tok-o">,</span> <span class="tok-n">LocalTime</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">));</span>
    <span class="tok-n">dateSelection</span><span class="tok-o">.</span><span class="tok-na">addOption</span><span class="tok-o">(</span><span class="tok-n">meetingStartsAt</span><span class="tok-o">,</span> <span class="tok-n">meetingEndsAt</span><span class="tok-o">);</span>

    <span class="tok-c1">// Navigating to the admin page</span>
    <span class="tok-n">SummaryPage</span> <span class="tok-n">summaryPage</span> <span class="tok-o">=</span> <span class="tok-n">dateSelection</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
    <span class="tok-n">AdminPage</span> <span class="tok-n">admin</span> <span class="tok-o">=</span> <span class="tok-n">summaryPage</span><span class="tok-o">.</span><span class="tok-na">navigateAdminPage</span><span class="tok-o">();</span>

    <span class="tok-c1">// Getting the list of options</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">OptionPanel</span><span class="tok-o">&gt;</span> <span class="tok-n">options</span> <span class="tok-o">=</span> <span class="tok-n">admin</span><span class="tok-o">.</span><span class="tok-na">options</span><span class="tok-o">();</span>

    <span class="tok-c1">// Verifying that the option is displayed correctly</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">(),</span> <span class="tok-s">&quot;Only one option must be available&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">OptionPanel</span> <span class="tok-n">option</span> <span class="tok-o">=</span> <span class="tok-n">options</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">meetingStartsAt</span><span class="tok-o">,</span> <span class="tok-n">option</span><span class="tok-o">.</span><span class="tok-na">startsAt</span><span class="tok-o">(),</span> <span class="tok-s">&quot;Incorrect starting date/time&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-n">meetingEndsAt</span><span class="tok-o">,</span> <span class="tok-n">option</span><span class="tok-o">.</span><span class="tok-na">endsAt</span><span class="tok-o">(),</span> <span class="tok-s">&quot;Incorrect ending date/time&quot;</span><span class="tok-o">);</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with any solution the <em>Page Object Mode</em> design pattern may not fit every scenario. Its misuse may bring more harm than good. It is usually argued that page object models are hard to maintain and are not well documented <a href="#bahmutov2019stop">(85)</a>. Like any other form of testing, GUI tests are subject to code smells, so we need to watch for code repetition, insufficient abstractions, and hard-to-understand code.</p>
</div>
<div class="paragraph">
<p>If a GUI has too much logic embedded, then implementing Page Object Model is challenging as the application becomes less testable. Development patterns like <em>Model-View-Controller</em>, <em>Model-View-Presenter</em> and <em>Model-View-ViewModel</em> or <em>Passive View</em> propose ways to organize the application code so the GUI has less logic and, as a result, it becomes easier to test. Also, interacting with the <em>Controller</em>, <em>Presenter</em> or the <em>ViewModel</em> can be easier than interacting directly with the visual elements <a href="#fowler2006passive">(86)</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fully_automated_gui_testing">5.2. Fully automated GUI testing</h3>
<div class="paragraph">
<p>As said before, a GUI test initializes the system under test, performs a series of GUI actions and then it checks if the GUI state is correct. If we can automatically discover which actions can be done at any instant during the execution of a program and if we can automatically compare application states, then we can automatically generate GUI tests. In fact, if we consider the set of GUI/user actions as the input domain, we can fuzz graphical applications by generating random action sequences.</p>
</div>
<div class="paragraph">
<p><a href="https://testar.org/">Test*</a> (reads as Testar) is a research tool implementing an automated GUI random testing process. The general workflow is shown in <a href="#testar">Figure 26</a>.</p>
</div>
<div id="testar" class="imageblock text-center">
<div class="content">
<img src="images/testar.png" alt="TESTAR" width="800">
</div>
<div class="title">Figure 26. Test*  testing process. Taken form <a href="https://testar.org/wp-content/uploads/2015/07/testar_thumb.png" class="bare">https://testar.org/wp-content/uploads/2015/07/testar_thumb.png</a></div>
</div>
<div class="paragraph">
<p>The process starts the <em>System Under Test</em> (SUT) and optionally instruments its code to obtain more information during the execution of user actions. Then, it scans the GUI to obtain sthe state, conformed by the widget tree and all their properties. Test* uses the accessibility API of the underlying operating system. This API provides direct access to the entire widget tree, their properties such as: their position, size, whether the widget is enabled or focused, and further attributes like text, title or any associated value. For example <a href="#accessibility-calculator">Figure 27</a> shows the set of properties the accessibility API provides for a button of the Calculator application in MacOS. Using the accessibility API, Test* can target any graphical application that respects the accessibility conventions.</p>
</div>
<div id="accessibility-calculator" class="imageblock text-center">
<div class="content">
<img src="images/accessibility-calculator.png" alt="Accessibility inspector" width="500">
</div>
<div class="title">Figure 27. Widget information provided by the accessibility API in MacOS.</div>
</div>
<div class="paragraph">
<p>By inspecting the GUI state ,the tool is able to derive a set of possible actions. The tool automatically skips actions that are not meaningful like clicking on buttons that are hidden by other windows. The tool can also be configured with custom, more complex actions, targeting personalized widgets, and even actions to avoid, like closing the main window.</p>
</div>
<div class="paragraph">
<p>At each step, the tool randomly selects one of the identified actions. While this selection is random, the tool implements more intelligent mechanisms to identify action that are likely to trigger failures, such as actions that not executed often during the process. This action selection step can be customized as well. After the action has been selected, the state is updated and the process continues until some desired stopping conditions are met.</p>
</div>
<div class="paragraph">
<p>Each state reached by Test* is inspected for failures. By default, the tool checks implicit oracles similar to those we discussed for fuzzing like: the presence of application crashed and hangs. The tool also allows to specify other oracles like detecting error pop-ups from their messages or more complex assertions.</p>
</div>
<div class="paragraph">
<p>If a crash is found, then the whole action sequence to that point is stored with screenshots of the failure and the intermediate steps. Test* has been able to find actual critical failures in industry-level applications <a href="#rueda2015testar">(87)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="andreessen2011why"></a> Andreessen, M. (2011). Why software is eating the world. Wall Street Journal, 20(2011), C2.</p>
</li>
<li>
<p><a id="wikipedia2020bug"></a> Wikipedia. Software Bug. <a href="https://en.wikipedia.org/wiki/Software_bug" class="bare">https://en.wikipedia.org/wiki/Software_bug</a>, Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="ghahrai2018error"></a> Ghahrai A. (2018). Error, Fault and Failure in Software Testing. <a href="https://www.testingexcellence.com/error-fault-failure-software-testing/" class="bare">https://www.testingexcellence.com/error-fault-failure-software-testing/</a> Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="amman2017introduction"></a> Ammann, P., &amp; Offutt, J. (2016). Introduction to software testing. Cambridge University Press.</p>
</li>
<li>
<p><a id="mancoridis2018slides"></a> Mancoridis S. Slides of his V&amp;V course <a href="https://www.cs.drexel.edu/~spiros/teaching/SE320/slides/introduction.pdf)" class="bare">https://www.cs.drexel.edu/~spiros/teaching/SE320/slides/introduction.pdf)</a>) Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="moller1993empirical"></a> Moller, K-H., and Daniel J. Paulish. (1993). An empirical investigation of software fault distribution. Proceedings First International Software Metrics Symposium. IEEE (1993).</p>
</li>
<li>
<p><a id="fruhlinger2017what"></a> Fruhlinger J. (2017). What is the Heartbleed bug, how does it work and how was it fixed?. CSO (2017) <a href="https://www.csoonline.com/article/3223203/vulnerabilities/what-is-the-heartbleed-bug-how-does-it-work-and-how-was-it-fixed.html" class="bare">https://www.csoonline.com/article/3223203/vulnerabilities/what-is-the-heartbleed-bug-how-does-it-work-and-how-was-it-fixed.html</a>. Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="slabodking1998software"></a> Slabodking G. (1998). Software glitches leave Navy Smart Ship dead in the water. GCN (1998) <a href="https://gcn.com/Articles/1998/07/13/Software-glitches-leave-Navy-Smart-Ship-dead-in-the-water.aspx" class="bare">https://gcn.com/Articles/1998/07/13/Software-glitches-leave-Navy-Smart-Ship-dead-in-the-water.aspx</a> Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="arnold2000patriot"></a> Arnold D. (2000). The Patriot Missile Failure. <a href="http://www-users.math.umn.edu/~arnold/disasters/patriot.html" class="bare">http://www-users.math.umn.edu/~arnold/disasters/patriot.html</a> Last accessed 17/03/2020.</p>
</li>
<li>
<p><a id="hansell1994glitch"></a> Hansell S. (1994). Glitch Makes Teller Machines Take Twice What They Give. <a href="https://www.nytimes.com/1994/02/18/business/glitch-makes-teller-machines-take-twice-what-they-give.html" class="bare">https://www.nytimes.com/1994/02/18/business/glitch-makes-teller-machines-take-twice-what-they-give.html</a>. Last accessed: 10/09/2018.</p>
</li>
<li>
<p><a id="jezequel1997design"></a> JÃ©zÃ©quel, J-M., and Bertrand Meyer. (1997). Design by contract: The lessons of Ariane. Computer 30.1 (1997): 129-130.</p>
</li>
<li>
<p><a id="ceguerra2001software"></a> Ceguerra A. (2001). Software Bug Report: Mars Climate Orbiter Assignment 1 for Verification. <a href="http://courses.engr.uky.edu/ideawiki/data/media/classes/06c/585/mars_climate_orbiter.pdf" class="bare">http://courses.engr.uky.edu/ideawiki/data/media/classes/06c/585/mars_climate_orbiter.pdf</a>. Last accessed: 17/03/2020</p>
</li>
<li>
<p><a id="johnson2012curiosity"></a> Johnson P. (2012). Curiosity about lines of code. <a href="https://www.itworld.com/article/2725085/big-data/curiosity-about-lines-of-code.html" class="bare">https://www.itworld.com/article/2725085/big-data/curiosity-about-lines-of-code.html</a>. Last accessed: 12/09/2018.</p>
</li>
<li>
<p><a id="turing1936computable"></a> Turing, A. M. (1936). On computable numbers, with an application to the Entscheidungsproblem. J. of Math, 58(345-363), 5.</p>
</li>
<li>
<p><a id="wikimedia2020lines"></a> Lines of Code Linux Kernel.svg. <a href="https://commons.wikimedia.org/wiki/File:Lines_of_Code_Linux_Kernel.svg" class="bare">https://commons.wikimedia.org/wiki/File:Lines_of_Code_Linux_Kernel.svg</a>. Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="opensignal2015android"></a> OpenSignal. (2015). Android Fragmentation. <a href="https://www.opensignal.com/sites/opensignal-com/files/data/reports/global/data-2015-08/2015_08_fragmentation_report.pdf" class="bare">https://www.opensignal.com/sites/opensignal-com/files/data/reports/global/data-2015-08/2015_08_fragmentation_report.pdf</a>). Last accessed: 17/03/2020.</p>
</li>
<li>
<p><a id="trikha2020inevitable"></a> Trikha R. (2020, Jul 2<sup>nd</sup>). The Inevitable Return of COBOL Published by Ritika Trikha <a href="https://blog.hackerrank.com/the-inevitable-return-of-cobol/" class="bare">https://blog.hackerrank.com/the-inevitable-return-of-cobol/</a>. Last accessed: 06/07/2020.</p>
</li>
<li>
<p><a id="cnbc2017banks"></a> CNBC, Reuters (2017, Apr 11<sup>th</sup>) Banks scramble to fix old systems as IT âcowboysâ ride into sunset <a href="https://www.cnbc.com/2017/04/11/banks-scramble-to-fix-old-systems-as-it-cowboys-ride-into-sunset.html" class="bare">https://www.cnbc.com/2017/04/11/banks-scramble-to-fix-old-systems-as-it-cowboys-ride-into-sunset.html</a>. Last accessed: 06/07/2020.</p>
</li>
<li>
<p><a id="leswing2020bnew"></a> Leswing K., CNBC (2020 Apr 6<sup>th</sup>) New Jersey needs volunteers who know COBOL, a 60-year-old programming language <a href="https://www.cnbc.com/2020/04/06/new-jersey-seeks-cobol-programmers-to-fix-unemployment-system.html" class="bare">https://www.cnbc.com/2020/04/06/new-jersey-seeks-cobol-programmers-to-fix-unemployment-system.html</a>. Last accessed: 06/07/2020.</p>
</li>
<li>
<p><a id="mittal2016survey"></a> Mittal, S. (2016). A survey of techniques for approximate computing. ACM Computing Surveys (CSUR), 48(4), 1-33.</p>
</li>
<li>
<p><a id="hardesty2010when"></a> Hardesty L. (2010). When good enough is better. MIT News Office. <a href="https://news.mit.edu/2010/situationally-award-0513" class="bare">https://news.mit.edu/2010/situationally-award-0513</a> Last accessed: 28/10/2020.</p>
</li>
<li>
<p><a id="misailovic2010quality"></a> Misailovic, S., Sidiroglou, S., Hoffmann, H., &amp; Rinard, M. (2010, May). Quality of service profiling. In Proceedings of the 32nd ACM/IEEE International Conference on Software Engineering-Volume 1 (pp. 25-34).</p>
</li>
<li>
<p><a id="meyer2008seven"></a> Meyer, B. (2008). Seven principles of software testing. Computer, 41(8), 99-101. <a href="https://doi.org/10.1109/MC.2008.306" class="bare">https://doi.org/10.1109/MC.2008.306</a> Also available here: <a href="http://se.inf.ethz.ch/old/people/meyer/publications/testing/principles.pdf" class="bare">http://se.inf.ethz.ch/old/people/meyer/publications/testing/principles.pdf</a></p>
</li>
<li>
<p><a id="netflix2011"></a> The Netflix Simian Army. (2011). <a href="https://netflixtechblog.com/the-netflix-simian-army-16e57fbab116" class="bare">https://netflixtechblog.com/the-netflix-simian-army-16e57fbab116</a> Last accessed: 01/05/2020</p>
</li>
<li>
<p><a id="fowler2006continuous"></a> Continuous Integration. (2006). <a href="https://martinfowler.com/articles/continuousIntegration.html" class="bare">https://martinfowler.com/articles/continuousIntegration.html</a> Last accessed: 01/05/2020</p>
</li>
<li>
<p><a id="thoughtworksintegration"></a> Continuous Integration. <a href="https://www.thoughtworks.com/continuous-integration" class="bare">https://www.thoughtworks.com/continuous-integration</a> Last accessed: 01/05/2020</p>
</li>
<li>
<p><a id="spinellis2006code"></a> Spinellis, D. (2006). Code quality: the open source perspective. Adobe Press.</p>
</li>
<li>
<p><a id="fowler2019is"></a> Fowler M. (May 2019). Is High Quality Software Worth the Cost? <a href="https://martinfowler.com/articles/is-quality-worth-cost.html" class="bare">https://martinfowler.com/articles/is-quality-worth-cost.html</a> Last accessed: 22/04/2020</p>
</li>
<li>
<p><a id="boehm1976quantitative"></a> Boehm, B. W., Brown, J. R., &amp; Lipow, M. (1976, October). Quantitative evaluation of software quality. In Proceedings of the 2nd international conference on Software engineering (pp. 592-605). IEEE Computer Society Press. <a href="https://dl.acm.org/citation.cfm?id=807736" class="bare">https://dl.acm.org/citation.cfm?id=807736</a></p>
</li>
<li>
<p><a id="iso2011square"></a> ISO/IEC 25010:2011 Systems and software engineering â Systems and software Quality Requirements and Evaluation (SQuaRE) â System and software quality models. <a href="https://www.iso.org/standard/35733.html" class="bare">https://www.iso.org/standard/35733.html</a> Last accessed: 22/04/2020</p>
</li>
<li>
<p><a id="googlestyle"></a> Google Java Style Guide <a href="https://google.github.io/styleguide/javaguide.html" class="bare">https://google.github.io/styleguide/javaguide.html</a> Last accessed: 28/10/2020</p>
</li>
<li>
<p><a id="oracle1997java"></a> Oracle (1997). Java Code Conventions <a href="https://www.oracle.com/technetwork/java/codeconventions-150003.pdf" class="bare">https://www.oracle.com/technetwork/java/codeconventions-150003.pdf</a> Last accessed: 28/04/2020</p>
</li>
<li>
<p><a id="microsoft2008naming"></a> Microsoft (2008). Names of Classes, Structs, and Interfaces <a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-classes-structs-and-interfaces" class="bare">https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-classes-structs-and-interfaces</a> Last accessed: 28/04/2020</p>
</li>
<li>
<p><a id="vanrossum2001style"></a> van Rossum G. (2001). Style Guide for Python Code <a href="https://www.python.org/dev/peps/pep-0008/" class="bare">https://www.python.org/dev/peps/pep-0008/</a> Last accessed: 29/04/2020</p>
</li>
<li>
<p><a id="wikipedia2020indentation"></a> Wikipedia. Indentation style. <a href="https://en.wikipedia.org/wiki/Indentation_style" class="bare">https://en.wikipedia.org/wiki/Indentation_style</a> Last accessed: 30/04/2020</p>
</li>
<li>
<p><a id="microsoft2018secure"></a> Microsoft (2018). Secure coding guidelines. <a href="https://docs.microsoft.com/en-us/dotnet/standard/security/secure-coding-guidelines" class="bare">https://docs.microsoft.com/en-us/dotnet/standard/security/secure-coding-guidelines</a> Last accessed: 30/04/2020</p>
</li>
<li>
<p><a id="google2020java"></a> Google. Google Java Style Guide. <a href="https://google.github.io/styleguide/javaguide.html" class="bare">https://google.github.io/styleguide/javaguide.html</a> Last accessed: 30/04/2020</p>
</li>
<li>
<p><a id="fowler2006codesmell"></a> Forwler. M. (2006). CodeSmell <a href="https://martinfowler.com/bliki/CodeSmell.html" class="bare">https://martinfowler.com/bliki/CodeSmell.html</a> Last accessed: 01/05/2020</p>
</li>
<li>
<p><a id="source2020smells"></a> Source Making. Code Smells <a href="https://sourcemaking.com/refactoring/smells" class="bare">https://sourcemaking.com/refactoring/smells</a> Last accessed: 01/05/2020</p>
</li>
<li>
<p><a id="source2020anti"></a> Source Making. AntiPatterns. <a href="https://sourcemaking.com/antipatterns" class="bare">https://sourcemaking.com/antipatterns</a> Last accessed: 30/04/2020</p>
</li>
<li>
<p><a id="glover2006monitoring"></a> Glover A. (2006). Monitoring Cyclomatic Complexity. <a href="https://www.ibm.com/developerworks/library/j-cq03316/index.html" class="bare">https://www.ibm.com/developerworks/library/j-cq03316/index.html</a> Last accessed: 05/05/2020</p>
</li>
<li>
<p><a id="mcloone2012code"></a> McLoone J. (2012). Code Length Measured in 14 Languages <a href="https://blog.wolfram.com/2012/11/14/code-length-measured-in-14-languages/" class="bare">https://blog.wolfram.com/2012/11/14/code-length-measured-in-14-languages/</a> Last accessed: 15/06/2020</p>
</li>
<li>
<p><a id="mccabe1976complexity"></a> McCabe, T. J. (1976). A Complexity Measure. IEEE Transaction on Software Engineering, vol SE-2(4).</p>
</li>
<li>
<p><a id="hummel2014mccabe"></a> Hummel B. (2014) McCabe&#8217;s Cyclomatic Complexity and Why We Don&#8217;t Use It. <a href="https://www.cqse.eu/en/news/blog/mccabe-cyclomatic-complexity/" class="bare">https://www.cqse.eu/en/news/blog/mccabe-cyclomatic-complexity/</a> Last accessed: 17/06/2020</p>
</li>
<li>
<p><a id="chidamber1994metrics"></a>  Chidamber, S. R., &amp; Kemerer, C. F. (1994). A metrics suite for object oriented design. IEEE Transactions on software engineering, 20(6), 476-493. Online: <a href="http://www.pitt.edu/~ckemerer/CK%20research%20papers/MetricForOOD_ChidamberKemerer94.pdf" class="bare">http://www.pitt.edu/~ckemerer/CK%20research%20papers/MetricForOOD_ChidamberKemerer94.pdf</a> Last accessed: 18/06/2020</p>
</li>
<li>
<p><a id="fowler2001reducing"></a> Fowler, M. (2001). Reducing Coupling. IEEE Softw., 18, 102-104. Online: <a href="https://martinfowler.com/ieeeSoftware/coupling.pdf" class="bare">https://martinfowler.com/ieeeSoftware/coupling.pdf</a> Last accessed 18/06/2020</p>
</li>
<li>
<p><a id="ujhazi2010new"></a> Ujhazi, B., Ferenc, R., Poshyvanyk, D., &amp; Gyimothy, T. (2010, September). New conceptual coupling and cohesion metrics for object-oriented systems. In 2010 10th IEEE Working Conference on Source Code Analysis and Manipulation (pp. 33-42). IEEE.</p>
</li>
<li>
<p><a id="appleton_demeter"></a> Appleton B. Introducing Demeter and its Laws. <a href="http://www.bradapp.com/docs/demeter-intro.html" class="bare">http://www.bradapp.com/docs/demeter-intro.html</a> Last accessed 18/06/2020</p>
</li>
<li>
<p><a id="martin2006agile"></a>  Martin, R. C., &amp; Martin, M. (2006). Agile principles, patterns, and practices in C# (Robert C. Martin). Prentice Hall PTR. Online: <a href="https://ivanderevianko.com/wp-content/uploads/2013/10/Agile-Principles-Patterns-and-Practices-in-C.pdf" class="bare">https://ivanderevianko.com/wp-content/uploads/2013/10/Agile-Principles-Patterns-and-Practices-in-C.pdf</a> Last accessed: 19/06/2020</p>
</li>
<li>
<p><a id="martin2014single"></a> Martin, R.  (2014) The Single Responsibility Principle <a href="https://blog.cleancoder.com/uncle-bob/2014/05/08/SingleReponsibilityPrinciple.html" class="bare">https://blog.cleancoder.com/uncle-bob/2014/05/08/SingleReponsibilityPrinciple.html</a> Last accessed: 19/06/2020</p>
</li>
<li>
<p><a id="bieman1995cohesion"></a> Bieman, J. M., &amp; Kang, B. K. (1995). Cohesion and reuse in an object-oriented system. ACM SIGSOFT Software Engineering Notes, 20(SI), 259-262.</p>
</li>
<li>
<p><a id="gamma1994design"></a>  Gamma, E., Helm, R., Johnson, R., &amp; Vlissides, J. (1994). Design Patterns Elements of reusable object-oriented sofware. Addison Wesley.</p>
</li>
<li>
<p><a id="sadowski2018modern"></a> Sadowski, C., SÃ¶derberg, E., Church, L., Sipko, M., &amp; Bacchelli, A. (2018, May). Modern code review: a case study at google. In Proceedings of the 40th International Conference on Software Engineering: Software Engineering in Practice (pp. 181-190).</p>
</li>
<li>
<p><a id="aniche-software"></a> Aniche M. and others, The Testing Pyramid. Software Testing from Theory to Practice. <a href="https://sttp.site/chapters/pragmatic-testing/testing-pyramid.html" class="bare">https://sttp.site/chapters/pragmatic-testing/testing-pyramid.html</a> Last accessed: 01/09/2020</p>
</li>
<li>
<p><a id="garousi2018smells"></a> Garousi, V., and KÃ¼Ã§Ã¼k, B. (2018). Smells in software test code: A survey of knowledge in industry and academia. Journal of Systems and Software, 138, 52-81. <a href="https://doi.org/10.1016/j.jss.2017.12.013" class="bare">https://doi.org/10.1016/j.jss.2017.12.013</a></p>
</li>
<li>
<p><a id="meszaros2003test"></a> Meszaros G., Smith S.M., Andrea J. (2003) The Test Automation Manifesto. In: Maurer F., Wells D. (eds) Extreme Programming and Agile Methods - XP/Agile Universe 2003. XP/Agile Universe 2003. Lecture Notes in Computer Science, vol 2753. Springer, Berlin, Heidelberg. <a href="https://doi.org/10.1007/978-3-540-45122-8_9" class="bare">https://doi.org/10.1007/978-3-540-45122-8_9</a> Available online at: <a href="http://xunitpatterns.com/~gerard/xpau2003-test-automation-manifesto-paper.pdf" class="bare">http://xunitpatterns.com/~gerard/xpau2003-test-automation-manifesto-paper.pdf</a></p>
</li>
<li>
<p><a id="xunitpatterns-assertion"></a> xUnitPatterns.com Assertion Roulette <a href="http://xunitpatterns.com/Assertion%20Roulette.html" class="bare">http://xunitpatterns.com/Assertion%20Roulette.html</a> Last accessed: 07/09/2020</p>
</li>
<li>
<p><a id="micco2016flaky"></a> Micco J. (2016) Flaky Tests at Google and How We Mitigate Them <a href="https://testing.googleblog.com/2016/05/flaky-tests-at-google-and-how-we.html" class="bare">https://testing.googleblog.com/2016/05/flaky-tests-at-google-and-how-we.html</a> Last accessed: 10/09/2020</p>
</li>
<li>
<p><a id="li2016test"></a> Li, N., &amp; Offutt, J. (2016). Test oracle strategies for model-based testing. IEEE Transactions on Software Engineering, 43(4), 372-395.</p>
</li>
<li>
<p><a id="comar2012formalization"></a> Comar, C., Guitton, J., Hainque, O., &amp; Quinot, T. (2012, February). Formalization and comparison of MCDC and object branch coverage criteria.</p>
</li>
<li>
<p><a id="demillo1978hints"></a> DeMillo, R. A., Lipton, R. J., &amp; Sayward, F. G. (1978). Hints on test data selection: Help for the practicing programmer. Computer, 11(4), 34-41.</p>
</li>
<li>
<p><a id="coles2016pit"></a> Coles, H., Laurent, T., Henard, C., Papadakis, M., &amp; Ventresque, A. (2016, July). Pit: a practical mutation testing tool for java. In Proceedings of the 25th International Symposium on Software Testing and Analysis (pp. 449-452).</p>
</li>
<li>
<p><a id="coles2018making"></a> Coles, H. (2018, October). Making Mutants Work For You or how I learned to stop worrying and love equivalent mutants, Paris JUG October 24th 2018</p>
</li>
<li>
<p><a id="deng2013empirical"></a> Deng, L., Offutt, J., &amp; Li, N. (2013, March). Empirical evaluation of the statement deletion mutation operator. In 2013 IEEE Sixth International Conference on Software Testing, Verification and Validation (pp. 84-93). IEEE.</p>
</li>
<li>
<p><a id="untch1993mutation"></a> Untch, R. H., Offutt, A. J., &amp; Harrold, M. J. (1993, July). Mutation analysis using mutant schemata. In Proceedings of the 1993 ACM SIGSOFT international symposium on Software testing and analysis (pp. 139-148).</p>
</li>
<li>
<p><a id="arguelles2020code"></a> Arguelles, C., IvankoviÄ, M., Bender, A., (2020, August) Code Coverage Best Practices. Available at <a href="https://testing.googleblog.com/2020/08/code-coverage-best-practices.html" class="bare">https://testing.googleblog.com/2020/08/code-coverage-best-practices.html</a> Last accessed: 12/11/202</p>
</li>
<li>
<p><a id="ivankovic2019code"></a> IvankoviÄ, M., PetroviÄ, G., Just, R., &amp; Fraser, G. (2019, August). Code coverage at Google. In Proceedings of the 2019 27th ACM Joint Meeting on European Software Engineering Conference and Symposium on the Foundations of Software Engineering (pp. 955-963).</p>
</li>
<li>
<p><a id="massol2013tip"></a> Massol, V., (2013) Tip: Find out max Clover TPC for Maven modules Available at: <a href="https://massol.myxwiki.org/xwiki/bin/view/Blog/MaxCloverTPCTip" class="bare">https://massol.myxwiki.org/xwiki/bin/view/Blog/MaxCloverTPCTip</a> Last accessed: 12/11/2020</p>
</li>
<li>
<p><a id="petrovic2018state"></a> PetroviÄ, G., &amp; IvankoviÄ, M. (2018, May). State of mutation testing at google. In Proceedings of the 40th international conference on software engineering: Software engineering in practice (pp. 163-171).</p>
</li>
<li>
<p><a id="freeman2007everything"></a> Freeman S. (2007, April) Test Smell: Everything is mocked Available online: <a href="http://www.mockobjects.com/2007/04/test-smell-everything-is-mocked.html" class="bare">http://www.mockobjects.com/2007/04/test-smell-everything-is-mocked.html</a> Last accessed: 23/11/2020</p>
</li>
<li>
<p><a id="day2014available"></a> Day B. (2014) Better Unit Tests through Design Patterns: Repository, Adapter, Mocks, and moreâ¦. Available online: <a href="https://www.benday.com/wp-content/uploads/2014/08/benday-agile-2014-unit-testing-v2.pdf" class="bare">https://www.benday.com/wp-content/uploads/2014/08/benday-agile-2014-unit-testing-v2.pdf</a> Last accessed: 23/11/2020</p>
</li>
<li>
<p><a id="miller2008patterns"></a> Miller J. (2008) Patterns in Practice. Design For Testability. Available online: <a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2008/december/patterns-in-practice-design-for-testability" class="bare">https://docs.microsoft.com/en-us/archive/msdn-magazine/2008/december/patterns-in-practice-design-for-testability</a> Last accessed: 23/11/2020</p>
</li>
<li>
<p><a id="moore2019designing"></a> Moore J. (2019, September) Designing for testability. Available online: <a href="https://jenniferplusplus.com/designing-for-testability/" class="bare">https://jenniferplusplus.com/designing-for-testability/</a> Last accessed: 23/11/2020</p>
</li>
<li>
<p><a id="source2020design"></a> Source Making. Design patterns <a href="https://sourcemaking.com/refactoring/smells" class="bare">https://sourcemaking.com/refactoring/smells</a> Last accessed: 23/11/2020</p>
</li>
<li>
<p><a id="beck2003test"></a> Beck, K. (2003). Test-driven development: by example. Addison-Wesley Professional.</p>
</li>
<li>
<p><a id="li2018why"></a> Li, C. (2018, May) Why TDD is Bad (and How to Improve Your Process) Available online: <a href="https://medium.com/@charleeli/why-tdd-is-bad-and-how-to-improve-your-process-d4b867274255" class="bare">https://medium.com/@charleeli/why-tdd-is-bad-and-how-to-improve-your-process-d4b867274255</a> Last accessed: 24/11/2020</p>
</li>
<li>
<p><a id="fox2019test"></a> Fox, C. (2019, November) Test-Driven Development is Fundamentally Wrong. Available online: <a href="https://hackernoon.com/test-driven-development-is-fundamentally-wrong-hor3z4d" class="bare">https://hackernoon.com/test-driven-development-is-fundamentally-wrong-hor3z4d</a> Last accessed: 24/11/2020</p>
</li>
<li>
<p><a id="schranz2014case"></a> Schranz, T. (2014, January) A Case against Test-Driven Development. Available online: <a href="https://medium.com/product-love/a-case-against-test-driven-development-b230ebecee64" class="bare">https://medium.com/product-love/a-case-against-test-driven-development-b230ebecee64</a> Last accessed: 24/11/2020</p>
</li>
<li>
<p><a id="gunnerson2017notdd"></a> Gunnerson, E. (2017, November) #NoTDD Available online: <a href="https://docs.microsoft.com/en-us/archive/blogs/ericgu/notdd" class="bare">https://docs.microsoft.com/en-us/archive/blogs/ericgu/notdd</a> Last accessed: 24/11/2020</p>
</li>
<li>
<p><a id="fowler2014is"></a> Forwler, M. (2014), Is TDD dead? Available online: <a href="https://martinfowler.com/articles/is-tdd-dead/" class="bare">https://martinfowler.com/articles/is-tdd-dead/</a> Last accessed: 24/11/2020</p>
</li>
<li>
<p><a id="zeller2019fuzzing"></a> Zeller, A., Gopinath, R., BÃ¶hme, M., Fraser, G., &amp; Holler, C. (2019). The fuzzing book.</p>
</li>
<li>
<p><a id="hamidy2020differential"></a> Hamidy, G. (2020). Differential Fuzzing the WebAssembly <a href="https://aaltodoc.aalto.fi/handle/123456789/46101" class="bare">https://aaltodoc.aalto.fi/handle/123456789/46101</a> Last accessed 28/12/2020</p>
</li>
<li>
<p><a id="nilizadeh2019diffuzz"></a> Nilizadeh, S., Noller, Y., &amp; Pasareanu, C. S. (2019, May). DifFuzz: differential fuzzing for side-channel analysis. In 2019 IEEE/ACM 41st International Conference on Software Engineering (ICSE) (pp. 176-187). IEEE.</p>
</li>
<li>
<p><a id="moroz2019afl"></a> Moroz, M. (2019) AFL Technical details <a href="https://github.com/google/AFL/blob/master/docs/technical_details.txt" class="bare">https://github.com/google/AFL/blob/master/docs/technical_details.txt</a> Last accessed: 28/12/2020</p>
</li>
<li>
<p><a id="zalewski2015aflfuzz"></a>  Zalewski M. (2015) afl-fuzz: making up grammar with a dictionary in hand <a href="https://lcamtuf.blogspot.com/2015/01/afl-fuzz-making-up-grammar-with.html" class="bare">https://lcamtuf.blogspot.com/2015/01/afl-fuzz-making-up-grammar-with.html</a> Last accessed: 28/12/2020</p>
</li>
<li>
<p><a id="fowler2013page"></a> Fowler, M. (2013) Page Object <a href="https://martinfowler.com/bliki/PageObject.html" class="bare">https://martinfowler.com/bliki/PageObject.html</a> Last accessed: 02/01/2021</p>
</li>
<li>
<p><a id="bahmutov2019stop"></a> Bahmutov, G. (2019) Stop using Page Objects and Start using App Actions <a href="https://www.cypress.io/blog/2019/01/03/stop-using-page-objects-and-start-using-app-actions/#page-objects-problems" class="bare">https://www.cypress.io/blog/2019/01/03/stop-using-page-objects-and-start-using-app-actions/#page-objects-problems</a> Last accessed: 03/01/2021</p>
</li>
<li>
<p><a id="fowler2006passive"></a> Fowler, M. (2006) Passive View <a href="https://martinfowler.com/eaaDev/PassiveScreen.html" class="bare">https://martinfowler.com/eaaDev/PassiveScreen.html</a> Last accessed: 03/01/2021</p>
</li>
<li>
<p><a id="rueda2015testar"></a> Rueda, U., Vos, T. E., Almenar, F., MartÃ­nez, M. O., &amp; Esparcia-AlcÃ¡zar, A. I. (2015). TESTAR: from academic prototype towards an industry-ready tool for automated testing at the user interface level. Actas de las XX Jornadas de IngenierÃ­a del Software y Bases de Datos (JISBD 2015), 236-245.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-09 12:21:09 +0100
</div>
</div>
<style>
pre.pygments .hll { background-color: #49483e }
pre.pygments  { background: #272822; color: #f8f8f2 }
pre.pygments .tok-c { color: #75715e } /* Comment */
pre.pygments .tok-err { color: #960050; background-color: #1e0010 } /* Error */
pre.pygments .tok-k { color: #66d9ef } /* Keyword */
pre.pygments .tok-l { color: #ae81ff } /* Literal */
pre.pygments .tok-n { color: #f8f8f2 } /* Name */
pre.pygments .tok-o { color: #f92672 } /* Operator */
pre.pygments .tok-p { color: #f8f8f2 } /* Punctuation */
pre.pygments .tok-ch { color: #75715e } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #75715e } /* Comment.Multiline */
pre.pygments .tok-cp { color: #75715e } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #75715e } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #75715e } /* Comment.Single */
pre.pygments .tok-cs { color: #75715e } /* Comment.Special */
pre.pygments .tok-gd { color: #f92672 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gi { color: #a6e22e } /* Generic.Inserted */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #75715e } /* Generic.Subheading */
pre.pygments .tok-kc { color: #66d9ef } /* Keyword.Constant */
pre.pygments .tok-kd { color: #66d9ef } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #f92672 } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #66d9ef } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #66d9ef } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #66d9ef } /* Keyword.Type */
pre.pygments .tok-ld { color: #e6db74 } /* Literal.Date */
pre.pygments .tok-m { color: #ae81ff } /* Literal.Number */
pre.pygments .tok-s { color: #e6db74 } /* Literal.String */
pre.pygments .tok-na { color: #a6e22e } /* Name.Attribute */
pre.pygments .tok-nb { color: #f8f8f2 } /* Name.Builtin */
pre.pygments .tok-nc { color: #a6e22e } /* Name.Class */
pre.pygments .tok-no { color: #66d9ef } /* Name.Constant */
pre.pygments .tok-nd { color: #a6e22e } /* Name.Decorator */
pre.pygments .tok-ni { color: #f8f8f2 } /* Name.Entity */
pre.pygments .tok-ne { color: #a6e22e } /* Name.Exception */
pre.pygments .tok-nf { color: #a6e22e } /* Name.Function */
pre.pygments .tok-nl { color: #f8f8f2 } /* Name.Label */
pre.pygments .tok-nn { color: #f8f8f2 } /* Name.Namespace */
pre.pygments .tok-nx { color: #a6e22e } /* Name.Other */
pre.pygments .tok-py { color: #f8f8f2 } /* Name.Property */
pre.pygments .tok-nt { color: #f92672 } /* Name.Tag */
pre.pygments .tok-nv { color: #f8f8f2 } /* Name.Variable */
pre.pygments .tok-ow { color: #f92672 } /* Operator.Word */
pre.pygments .tok-w { color: #f8f8f2 } /* Text.Whitespace */
pre.pygments .tok-mb { color: #ae81ff } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #ae81ff } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #ae81ff } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #ae81ff } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #ae81ff } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #e6db74 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #e6db74 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #e6db74 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #e6db74 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #e6db74 } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #e6db74 } /* Literal.String.Double */
pre.pygments .tok-se { color: #ae81ff } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #e6db74 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #e6db74 } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #e6db74 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #e6db74 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #e6db74 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #e6db74 } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #a6e22e } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #f8f8f2 } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #f8f8f2 } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #f8f8f2 } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #f8f8f2 } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #ae81ff } /* Literal.Number.Integer.Long */
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>